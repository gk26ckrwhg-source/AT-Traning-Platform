<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ATFX PnL Calculator — Combined (editable)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" rel="stylesheet" />
  <style>
        /* small helpers to keep chooser visually pleasant */
        .hide { display: none; }
        .viewer { width: 100%; height: 100vh; }
        iframe#frame { width: 100%; height: calc(100vh - 56px); border: none; }
        .region { cursor: pointer; }
        .toolbar { display: flex; gap: 12px; align-items: center; padding: 8px; background:#fff; box-shadow:0 1px 4px rgba(0,0,0,.06); }
        .pill { padding:4px 8px; background: #eef2ff; border-radius:999px; }

        /* --- Styles from provided designer HTML (keeps visual parity) --- */
        :root {
            --text: #0f172a;
            --muted: #475569;
            --card: #ffffff;
            --bg: #f7fafc;
            --brand-1: #d42710;
            --brand-2: #f2f2ec;
            --brand-3: #ec3920;
            --soft-1: #fbedeb;
            --soft-2: #fefefd;
            --soft-3: #fef5f3;
            --radius: 20px;
            --shadow: 0 12px 36px rgba(15, 23, 42, 0.08);
            --fs-base: 17px; /* larger */
            --fs-lg: 22px;
            --fs-xl: 28px;
        }
        * { box-sizing: border-box; }
        html, body { height: 100%; margin: 0; }
        body {
            color: var(--text);
            font-size: var(--fs-base);
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, 'PingFang SC', 'Microsoft YaHei', 'Noto Sans CJK', sans-serif;
            background: radial-gradient(1200px 800px at 10% -10%, var(--soft-1), transparent 60%),
                                    var(--bg);
            min-height: 100dvh;
            overflow-x: hidden;
        }

        .wrap { display: grid; place-items: center; min-height: 100dvh; padding: 32px; }
        .shell { width: min(1240px, 100%); display: grid; gap: 20px; }

        /* Header */
        .hero {
            background: var(--card);
            border: 1px solid rgba(2,6,23,0.06);
            border-radius: var(--radius);
            padding: 22px 24px; display:flex; align-items:center; justify-content:space-between; gap:20px;
            box-shadow: var(--shadow);
        }
        .brandbox { display:flex; align-items:center; gap:20px; min-height: 84px; }
        .logo { width: clamp(72px, 8vw, 96px); height: clamp(72px, 8vw, 96px); border-radius: 0; display:grid; place-items:center; overflow: visible; }
        /* Remove any box/background around logo */
        .logo::before { display:none; content:none; }
        .logo img { width: 100%; height: 100%; object-fit: contain; filter: drop-shadow(0 4px 12px rgba(0,0,0,.08)); }

        .title h1 { margin:0; font-size: var(--fs-lg); letter-spacing:.2px; }
        .title p { margin:6px 0 0; color: var(--muted); font-size: 14.5px; }

        .actions { display:flex; align-items:center; gap:10px; }
        .seg { background:#eef2f7; border-radius: 999px; padding: 5px; display:flex; gap:6px; border:1px solid rgba(2,6,23,0.06); }
        .seg button { border:0; background:transparent; padding:8px 12px; border-radius:999px; font-size:14px; color:#334155; cursor:pointer; }
        .seg button.active { background:white; color:#0f172a; box-shadow: 0 2px 6px rgba(0,0,0,.06); }

        /* Card */
        .card { background: var(--card); border: 1px solid rgba(2,6,23,0.06); border-radius: var(--radius); box-shadow: var(--shadow); overflow: hidden; }
        .lead { padding: 26px 26px 0 26px; }
        .lead h2 { margin:0 0 8px; font-size: var(--fs-xl); }
        .lead p { margin:0; color: var(--muted); font-size: 15px; }

        .grid { display:grid; gap:20px; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); padding: 22px; }

        button.region {
            position: relative; isolation: isolate; background: linear-gradient(180deg, #ffffff, #fbfdff);
            border: 1px solid rgba(2,6,23,0.08); color: var(--text); border-radius: 18px; padding: 22px; text-align: left; cursor: pointer; transition: transform .18s ease, border-color .18s ease, box-shadow .18s ease; overflow:hidden; min-height: 120px;
        }
        button.region:hover { transform: translateY(-3px); border-color: color-mix(in oklab, var(--brand-1) 18%, #cbd5e1 82%); box-shadow: 0 14px 32px rgba(15, 23, 42, .12); }
        button.region:focus-visible { outline: 3px solid color-mix(in oklab, var(--brand-2) 55%, transparent); outline-offset: 2px; }
        button.region .title { font-weight: 700; font-size: 20px; display:flex; align-items:center; gap:10px; }
        button.region .sub { color: var(--muted); font-size: 14px; margin-top: 10px; }
        button.region .chip { font-size: 12px; padding: 4px 8px; border-radius: 999px; border: 1px solid rgba(2,6,23,0.08); background: #f8fafc; }
        button.region .swirl { position:absolute; inset:-40%; background: radial-gradient(340px 200px at var(--x) var(--y), color-mix(in oklab, var(--brand-1) 20%, transparent), transparent 60%); opacity:0; transition: opacity .2s ease; z-index:-1; }
        button.region:hover .swirl { opacity: 1; }

        .ops { display:flex; align-items:center; gap:12px; padding: 6px 26px 26px; color: var(--muted); font-size: 15px; }
        .ops label { display:flex; align-items:center; gap:8px; cursor: pointer; }

        /* Viewer */
        .viewer { height: 100dvh; display: grid; grid-template-rows: auto 1fr; }
        .toolbar { background: #ffffff; border-bottom: 1px solid rgba(2,6,23,0.06); padding: 12px; display:flex; align-items:center; gap:12px; position: sticky; top:0; z-index: 5; }
        .toolbar button { background: #f1f5f9; color: #0f172a; border: 1px solid rgba(2,6,23,0.08); border-radius: 10px; padding: 10px 14px; cursor: pointer; }
        .toolbar .pill { font-size: 14px; color: #334155; }
        iframe { width: 100%; height: calc(100dvh - 56px); border: 0; background: white; }
        .hide { display: none !important; }
        /* --- end designer styles --- */
  </style>
</head>
<body class="bg-gray-50 min-h-screen">

<!--
  IMPORTANT: This combined file uses <template id="page-..."> blocks below to safely hold the
  full regional HTML documents (including <script> and <style> tags). To inline a regional
  calculator, open the regional HTML file and paste its entire content (starting with <!DOCTYPE html> or <html>)
  into the matching <template> block below between the comment markers.

  After pasting, save this file and open it in a browser. Click a region to load the calculator
  into the iframe via srcdoc (isolated execution).
-->

<div id="chooser" class="wrap" role="application" aria-label="Region selection">
    <div class="shell">
      <div class="hero">
        <div class="brandbox">
          <div class="logo"><img alt="logo" src="data:image/png;base64,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"/></div>
          <div class="title">
            <h1 data-i18n="title">ATFX PnL Calculator</h1>
            <p data-i18n="subtitle">Select your region to open the corresponding P&L / Margin calculator.</p>
          </div>
        </div>
        <div class="actions">
          <div class="seg" role="tablist" aria-label="Language">
            <button id="lang-en" class="active" data-lang="en" role="tab">EN</button>
            <button id="lang-zh" data-lang="zh" role="tab">中文</button>
          </div>
        </div>
      </div>

      <section class="card" aria-labelledby="pick">
        <div class="lead">
          <h2 id="pick" data-i18n="pick">Choose your region</h2>
        </div>
        <div class="grid">
          <button class="region" data-region="cn" aria-label="China Mainland">
            <div class="swirl"></div>
            <div class="title"><span class="flag"><img src="data:image/png;base64,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" alt="CN" style="height:1.25em;width:auto;vertical-align:-0.2em;" /></span> <span data-i18n="cn_title">China Mainland</span> <span class="chip">CN</span></div>
            <div class="sub" data-i18n="cn_sub">For China Mainland product/contracts.</div>
          </button>
          <button class="region" data-region="sea" aria-label="Southeast Asia">
            <div class="swirl"></div>
            <div class="title"><span class="flag">🌏</span> <span data-i18n="sea_title">Southeast Asia</span> <span class="chip">SEA</span></div>
            <div class="sub" data-i18n="sea_sub">For SEA region product/contracts.</div>
          </button>
          <button class="region" data-region="latam" aria-label="Latin America">
            <div class="swirl"></div>
            <div class="title"><span class="flag">🌎</span> <span data-i18n="latam_title">Latin America</span> <span class="chip">LATAM</span></div>
            <div class="sub" data-i18n="latam_sub">For LATAM region product/contracts.</div>
          </button>
          <button class="region" data-region="uae" aria-label="Middle East / UAE">
            <div class="swirl"></div>
            <div class="title"><span class="flag">🕌</span> <span data-i18n="uae_title">Middle East / UAE</span> <span class="chip">UAE</span></div>
            <div class="sub" data-i18n="uae_sub">For UAE / MENA region product/contracts.</div>
          </button>
        </div>
        <div class="ops">
          <label><input type="checkbox" id="remember"/> <span data-i18n="remember">Remember my region</span></label>
        </div>
      </section>
    </div>
  </div>

<!-- Language toggle script for the chooser -->
<script>
    (function(){
        const translations = {
            en: {
                title: 'PnL Calculator',
                subtitle: 'Choose your region',
                region_cn: 'China Mainland',
                region_sea: 'Southeast Asia',
                region_latam: 'Latin America',
                region_uae: 'UAE / MENA',
                code_cn: 'CN',
                code_sea: 'SEA',
                code_latam: 'LATAM',
                code_uae: 'UAE',
                remember: 'Remember my region'
            },
            zh: {
                title: '盈亏计算器',
                subtitle: '请选择您的地区',
                region_cn: '中国大陆',
                region_sea: '东南亚',
                region_latam: '拉丁美洲',
                region_uae: '阿联酋/中东及北非',
                code_cn: 'CN',
                code_sea: 'SEA',
                code_latam: 'LATAM',
                code_uae: 'UAE',
                remember: '记住我的地区'
            }
        };

        const setLang = (lang) => {
            // update html lang
            try { document.documentElement.lang = (lang === 'zh' ? 'zh' : 'en'); } catch(e){}

            // update all elements with data-i18n
            document.querySelectorAll('[data-i18n]').forEach(el =>{
                const key = el.getAttribute('data-i18n');
                if (translations[lang] && translations[lang][key]) el.textContent = translations[lang][key];
            });

            // update toggle active state
            document.getElementById('lang-en').classList.toggle('active', lang === 'en');
            document.getElementById('lang-zh').classList.toggle('active', lang === 'zh');

            // persist choice
            try { localStorage.setItem('chooserLang', lang); } catch(e){}
        };

        // attach handlers
        document.getElementById('lang-en').addEventListener('click', () => setLang('en'));
        document.getElementById('lang-zh').addEventListener('click', () => setLang('zh'));

        // initialize from storage or default
        const saved = (function(){ try { return localStorage.getItem('chooserLang'); } catch(e){ return null; } })();
        setLang(saved === 'zh' ? 'zh' : 'en');
    })();
</script>


<!-- Viewer (iframe) -->
<div id="viewer" class="viewer hide">
  <div class="toolbar">
    <button id="back" class="px-3 py-1 bg-gray-100 rounded">← Back</button>
    <span class="pill" id="current"> </span>
  </div>
  <iframe id="frame" title="PnL Calculator"></iframe>
</div>

<!-- Template placeholders for each regional HTML. Paste full HTML inside each template. -->
<template id="page-cn">
<html lang="en"><head><meta charset="utf-8"/><meta content="width=device-width, initial-scale=1.0" name="viewport"/><title>PnL Calculator</title><script src="https://cdn.tailwindcss.com"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" rel="stylesheet"/><style>.bg-custom {
            background: linear-gradient(rgba(255, 255, 255, 0.85), rgba(255, 255, 255, 0.85)), 
                        url('https://images.unsplash.com/photo-1611974789855-9c2a0a7236a3?ixlib=rb-4.0.3');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }</style><!-- 产品数据 --><script>const productsData = [
  {
    "product": "EURUSD",
    "name": "欧元/美元",
    "contractSize": 100000,
    "pipValuePerLot": "10 美元",
    "leverage400": "250 USD",
    "leverage200": "500 USD",
    "leverage100": "1000 USD",
    "baseCurrency": "EUR",
    "pricingCurrency": "USD",
    "marginType": "Fixed"
  },
  {
    "product": "USDJPY",
    "name": "美元/日元",
    "contractSize": 100000,
    "pipValuePerLot": "1000 日元",
    "leverage400": "250 USD",
    "leverage200": "500 USD",
    "leverage100": "1000 USD",
    "baseCurrency": "USD",
    "pricingCurrency": "JPY",
    "marginType": "Fixed"
  },
  {
    "product": "GBPUSD",
    "name": "英镑/美元",
    "contractSize": 100000,
    "pipValuePerLot": "10 美元",
    "leverage400": "250 USD",
    "leverage200": "500 USD",
    "leverage100": "1000 USD",
    "baseCurrency": "GBP",
    "pricingCurrency": "USD",
    "marginType": "Fixed"
  },
  {
    "product": "USDCHF",
    "name": "美元/瑞士法郎",
    "contractSize": 100000,
    "pipValuePerLot": "10 瑞郎",
    "leverage400": "250 USD",
    "leverage200": "500 USD",
    "leverage100": "1000 USD",
    "baseCurrency": "USD",
    "pricingCurrency": "CHF",
    "marginType": "Fixed"
  },
  {
    "product": "AUDUSD",
    "name": "澳元/美元",
    "contractSize": 100000,
    "pipValuePerLot": "10 美元",
    "leverage400": "250 USD",
    "leverage200": "500 USD",
    "leverage100": "1000 USD",
    "baseCurrency": "AUD",
    "pricingCurrency": "USD",
    "marginType": "Fixed"
  },
  {
    "product": "NZDUSD",
    "name": "纽元/美元",
    "contractSize": 100000,
    "pipValuePerLot": "10 美元",
    "leverage400": "250 USD",
    "leverage200": "500 USD",
    "leverage100": "1000 USD",
    "baseCurrency": "NZD",
    "pricingCurrency": "USD",
    "marginType": "Fixed"
  },
  {
    "product": "USDCAD",
    "name": "美元/加元",
    "contractSize": 100000,
    "pipValuePerLot": "10 加元",
    "leverage400": "250 USD",
    "leverage200": "500 USD",
    "leverage100": "1000 USD",
    "baseCurrency": "USD",
    "pricingCurrency": "CAD",
    "marginType": "Fixed"
  },
  {
    "product": "AUDCAD",
    "name": "澳元/加元",
    "contractSize": 100000,
    "pipValuePerLot": "10 加元",
    "leverage400": "250 USD",
    "leverage200": "500 USD",
    "leverage100": "1000 USD",
    "baseCurrency": "AUD",
    "pricingCurrency": "CAD",
    "marginType": "Fixed"
  },
  {
    "product": "AUDCHF",
    "name": "澳元/瑞士法郎",
    "contractSize": 100000,
    "pipValuePerLot": "10 瑞郎",
    "leverage400": "250 USD",
    "leverage200": "500 USD",
    "leverage100": "1000 USD",
    "baseCurrency": "AUD",
    "pricingCurrency": "CHF",
    "marginType": "Fixed"
  },
  {
    "product": "AUDJPY",
    "name": "澳元/日元",
    "contractSize": 100000,
    "pipValuePerLot": "1000 日元",
    "leverage400": "250 USD",
    "leverage200": "500 USD",
    "leverage100": "1000 USD",
    "baseCurrency": "AUD",
    "pricingCurrency": "JPY",
    "marginType": "Fixed"
  },
  {
    "product": "AUDNZD",
    "name": "澳元/纽元",
    "contractSize": 100000,
    "pipValuePerLot": "10 纽元",
    "leverage400": "250 USD",
    "leverage200": "500 USD",
    "leverage100": "1000 USD",
    "baseCurrency": "AUD",
    "pricingCurrency": "NZD",
    "marginType": "Fixed"
  },
  {
    "product": "CADCHF",
    "name": "加元/瑞士法郎",
    "contractSize": 100000,
    "pipValuePerLot": "10 瑞郎",
    "leverage400": "250 USD",
    "leverage200": "500 USD",
    "leverage100": "1000 USD",
    "baseCurrency": "CAD",
    "pricingCurrency": "CHF",
    "marginType": "Fixed"
  },
  {
    "product": "CADJPY",
    "name": "加元/日元",
    "contractSize": 100000,
    "pipValuePerLot": "1000 日元",
    "leverage400": "250 USD",
    "leverage200": "500 USD",
    "leverage100": "1000 USD",
    "baseCurrency": "CAD",
    "pricingCurrency": "JPY",
    "marginType": "Fixed"
  },
  {
    "product": "CHFJPY",
    "name": "瑞士法郎/日元",
    "contractSize": 100000,
    "pipValuePerLot": "1000 日元",
    "leverage400": "250 USD",
    "leverage200": "500 USD",
    "leverage100": "1000 USD",
    "baseCurrency": "CHF",
    "pricingCurrency": "JPY",
    "marginType": "Fixed"
  },
  {
    "product": "EURAUD",
    "name": "欧元/澳元",
    "contractSize": 100000,
    "pipValuePerLot": "10 澳元",
    "leverage400": "250 USD",
    "leverage200": "500 USD",
    "leverage100": "1000 USD",
    "baseCurrency": "EUR",
    "pricingCurrency": "AUD",
    "marginType": "Fixed"
  },
  {
    "product": "EURCAD",
    "name": "欧元/加元",
    "contractSize": 100000,
    "pipValuePerLot": "10 加元",
    "leverage400": "250 USD",
    "leverage200": "500 USD",
    "leverage100": "1000 USD",
    "baseCurrency": "EUR",
    "pricingCurrency": "CAD",
    "marginType": "Fixed"
  },
  {
    "product": "EURCHF",
    "name": "欧元/瑞士法郎",
    "contractSize": 100000,
    "pipValuePerLot": "10 瑞郎",
    "leverage400": "250 USD",
    "leverage200": "500 USD",
    "leverage100": "1000 USD",
    "baseCurrency": "EUR",
    "pricingCurrency": "CHF",
    "marginType": "Fixed"
  },
  {
    "product": "EURGBP",
    "name": "欧元/英镑",
    "contractSize": 100000,
    "pipValuePerLot": "10 英镑",
    "leverage400": "250 USD",
    "leverage200": "500 USD",
    "leverage100": "1000 USD",
    "baseCurrency": "EUR",
    "pricingCurrency": "GBP",
    "marginType": "Fixed"
  },
  {
    "product": "EURJPY",
    "name": "欧元/日元",
    "contractSize": 100000,
    "pipValuePerLot": "1000 日元",
    "leverage400": "250 USD",
    "leverage200": "500 USD",
    "leverage100": "1000 USD",
    "baseCurrency": "EUR",
    "pricingCurrency": "JPY",
    "marginType": "Fixed"
  },
  {
    "product": "EURNZD",
    "name": "欧元/纽元",
    "contractSize": 100000,
    "pipValuePerLot": "10 纽元",
    "leverage400": "250 USD",
    "leverage200": "500 USD",
    "leverage100": "1000 USD",
    "baseCurrency": "EUR",
    "pricingCurrency": "NZD",
    "marginType": "Fixed"
  },
  {
    "product": "GBPAUD",
    "name": "英镑/澳元",
    "contractSize": 100000,
    "pipValuePerLot": "10 澳元",
    "leverage400": "250 USD",
    "leverage200": "500 USD",
    "leverage100": "1000 USD",
    "baseCurrency": "GBP",
    "pricingCurrency": "AUD",
    "marginType": "Fixed"
  },
  {
    "product": "GBPCAD",
    "name": "英镑/加元",
    "contractSize": 100000,
    "pipValuePerLot": "10 加元",
    "leverage400": "250 USD",
    "leverage200": "500 USD",
    "leverage100": "1000 USD",
    "baseCurrency": "GBP",
    "pricingCurrency": "CAD",
    "marginType": "Fixed"
  },
  {
    "product": "GBPCHF",
    "name": "英镑/瑞士法郎",
    "contractSize": 100000,
    "pipValuePerLot": "10 瑞郎",
    "leverage400": "250 USD",
    "leverage200": "500 USD",
    "leverage100": "1000 USD",
    "baseCurrency": "GBP",
    "pricingCurrency": "CHF",
    "marginType": "Fixed"
  },
  {
    "product": "GBPJPY",
    "name": "英镑/日元",
    "contractSize": 100000,
    "pipValuePerLot": "1000 日元",
    "leverage400": "250 USD",
    "leverage200": "500 USD",
    "leverage100": "1000 USD",
    "baseCurrency": "GBP",
    "pricingCurrency": "JPY",
    "marginType": "Fixed"
  },
  {
    "product": "GBPNZD",
    "name": "英镑/纽元",
    "contractSize": 100000,
    "pipValuePerLot": "10 纽元",
    "leverage400": "250 USD",
    "leverage200": "500 USD",
    "leverage100": "1000 USD",
    "baseCurrency": "GBP",
    "pricingCurrency": "NZD",
    "marginType": "Fixed"
  },
  {
    "product": "NZDCAD",
    "name": "纽元/加元",
    "contractSize": 100000,
    "pipValuePerLot": "10 加元",
    "leverage400": "250 USD",
    "leverage200": "500 USD",
    "leverage100": "1000 USD",
    "baseCurrency": "NZD",
    "pricingCurrency": "CAD",
    "marginType": "Fixed"
  },
  {
    "product": "NZDCHF",
    "name": "纽元/瑞士法郎",
    "contractSize": 100000,
    "pipValuePerLot": "10 瑞郎",
    "leverage400": "250 USD",
    "leverage200": "500 USD",
    "leverage100": "1000 USD",
    "baseCurrency": "NZD",
    "pricingCurrency": "CHF",
    "marginType": "Fixed"
  },
  {
    "product": "NZDJPY",
    "name": "纽元/日元",
    "contractSize": 100000,
    "pipValuePerLot": "1000 日元",
    "leverage400": "250 USD",
    "leverage200": "500 USD",
    "leverage100": "1000 USD",
    "baseCurrency": "NZD",
    "pricingCurrency": "JPY",
    "marginType": "Fixed"
  },
  {
    "product": "EURHUF",
    "name": "欧元/匈牙利福林",
    "contractSize": 100000,
    "pipValuePerLot": "1000 匈牙利福林",
    "leverage400": "2000 EUR",
    "leverage200": "2000 EUR",
    "leverage100": "4000 EUR",
    "baseCurrency": "EUR",
    "pricingCurrency": "HUF",
    "marginType": "Fixed"
  },
  {
    "product": "EURPLN",
    "name": "欧元/波兰兹罗提",
    "contractSize": 100000,
    "pipValuePerLot": "10 波兰兹罗提",
    "leverage400": "2000 EUR",
    "leverage200": "2000 EUR",
    "leverage100": "4000 EUR",
    "baseCurrency": "EUR",
    "pricingCurrency": "PLN",
    "marginType": "Fixed"
  },
  {
    "product": "USDCNH",
    "name": "美元/离岸人民币",
    "contractSize": 100000,
    "pipValuePerLot": "10 离岸人民币",
    "leverage400": "2000 USD",
    "leverage200": "2000 USD",
    "leverage100": "4000 USD",
    "baseCurrency": "USD",
    "pricingCurrency": "CNH",
    "marginType": "Fixed"
  },
  {
    "product": "USDHKD",
    "name": "美元/港元",
    "contractSize": 100000,
    "pipValuePerLot": "10 港元",
    "leverage400": "2000 USD",
    "leverage200": "2000 USD",
    "leverage100": "4000 USD",
    "baseCurrency": "USD",
    "pricingCurrency": "HKD",
    "marginType": "Fixed"
  },
  {
    "product": "USDSGD",
    "name": "美元/新加坡元",
    "contractSize": 100000,
    "pipValuePerLot": "10 新加坡元",
    "leverage400": "2000 USD",
    "leverage200": "2000 USD",
    "leverage100": "4000 USD",
    "baseCurrency": "USD",
    "pricingCurrency": "SGD",
    "marginType": "Fixed"
  },
  {
    "product": "USDCZK",
    "name": "美元/捷克克朗",
    "contractSize": 100000,
    "pipValuePerLot": "1000 捷克克朗",
    "leverage400": "2000 USD",
    "leverage200": "2000 USD",
    "leverage100": "4000 USD",
    "baseCurrency": "USD",
    "pricingCurrency": "CZK",
    "marginType": "Fixed"
  },
  {
    "product": "USDDKK",
    "name": "美元/丹麦克朗",
    "contractSize": 100000,
    "pipValuePerLot": "10 丹麦克朗",
    "leverage400": "2000 USD",
    "leverage200": "2000 USD",
    "leverage100": "4000 USD",
    "baseCurrency": "USD",
    "pricingCurrency": "DKK",
    "marginType": "Fixed"
  },
  {
    "product": "USDHUF",
    "name": "美元/匈牙利福林",
    "contractSize": 100000,
    "pipValuePerLot": "1000 匈牙利福林",
    "leverage400": "2000 USD",
    "leverage200": "2000 USD",
    "leverage100": "4000 USD",
    "baseCurrency": "USD",
    "pricingCurrency": "HUF",
    "marginType": "Fixed"
  },
  {
    "product": "USDMXN",
    "name": "美元/墨西哥比绍",
    "contractSize": 100000,
    "pipValuePerLot": "10 墨西哥比绍",
    "leverage400": "2000 USD",
    "leverage200": "2000 USD",
    "leverage100": "4000 USD",
    "baseCurrency": "USD",
    "pricingCurrency": "MXN",
    "marginType": "Fixed"
  },
  {
    "product": "USDNOK",
    "name": "美元/挪威克朗",
    "contractSize": 100000,
    "pipValuePerLot": "10 挪威克朗",
    "leverage400": "2000 USD",
    "leverage200": "2000 USD",
    "leverage100": "4000 USD",
    "baseCurrency": "USD",
    "pricingCurrency": "NOK",
    "marginType": "Fixed"
  },
  {
    "product": "USDPLN",
    "name": "美元/波兰兹罗提",
    "contractSize": 100000,
    "pipValuePerLot": "10 波兰兹罗提",
    "leverage400": "2000 USD",
    "leverage200": "2000 USD",
    "leverage100": "4000 USD",
    "baseCurrency": "USD",
    "pricingCurrency": "PLN",
    "marginType": "Fixed"
  },
  {
    "product": "USDSEK",
    "name": "美元/瑞典克朗",
    "contractSize": 100000,
    "pipValuePerLot": "10 瑞典克朗",
    "leverage400": "2000 USD",
    "leverage200": "2000 USD",
    "leverage100": "4000 USD",
    "baseCurrency": "USD",
    "pricingCurrency": "SEK",
    "marginType": "Fixed"
  },
  {
    "product": "USDZAR",
    "name": "美元/南非兰特",
    "contractSize": 100000,
    "pipValuePerLot": "10 南非兰特",
    "leverage400": "2000 USD",
    "leverage200": "2000 USD",
    "leverage100": "4000 USD",
    "baseCurrency": "USD",
    "pricingCurrency": "ZAR",
    "marginType": "Fixed"
  },
  {
    "product": "XAUUSD",
    "name": "黄金/美元",
    "contractSize": 100,
    "pipValuePerLot": "10 美元",
    "leverage400": "250 USD",
    "leverage200": "500 USD",
    "leverage100": "1000 USD",
    "baseCurrency": "",
    "pricingCurrency": "USD",
    "marginType": "Fixed"
  },
  {
    "product": "XAUEUR",
    "name": "黄金/欧元",
    "contractSize": 100,
    "pipValuePerLot": "10 欧元",
    "leverage400": "250 EUR",
    "leverage200": "500 EUR",
    "leverage100": "1000 EUR",
    "baseCurrency": "",
    "pricingCurrency": "EUR",
    "marginType": "Fixed"
  },
  {
    "product": "XAGUSD",
    "name": "白银/美元",
    "contractSize": 5000,
    "pipValuePerLot": "50 美元",
    "leverage400": "1500 USD",
    "leverage200": "1500 USD",
    "leverage100": "3000 USD",
    "baseCurrency": "",
    "pricingCurrency": "USD",
    "marginType": "Fixed"
  },
  {
    "product": "RKGCNH",
    "name": "黄金(克)/人民币",
    "contractSize": 1000,
    "pipValuePerLot": "10 人民币",
    "leverage400": "1000 USD",
    "leverage200": "1000 USD",
    "leverage100": "1000 USD",
    "baseCurrency": "",
    "pricingCurrency": "CNH",
    "marginType": "Fixed"
  },
  {
    "product": "GOLD_MMMYY",
    "name": "黄金期货合约(CFD)",
    "contractSize": 100,
    "pipValuePerLot": "10 美元",
    "leverage400": "8000 USD",
    "leverage200": "8000 USD",
    "leverage100": "8000 USD",
    "baseCurrency": "",
    "pricingCurrency": "USD",
    "marginType": "Fixed"
  },
  {
    "product": "XPTUSD",
    "name": "鉑金/美元",
    "contractSize": 100,
    "pipValuePerLot": "10 美元",
    "leverage400": "1:100",
    "leverage200": "1:100",
    "leverage100": "1:100",
    "baseCurrency": "",
    "pricingCurrency": "USD",
    "marginType": "Floating"
  },
  {
    "product": "XPDUSD",
    "name": "鈀金/美元",
    "contractSize": 100,
    "pipValuePerLot": "10 美元",
    "leverage400": "1:100",
    "leverage200": "1:100",
    "leverage100": "1:100",
    "baseCurrency": "",
    "pricingCurrency": "USD",
    "marginType": "Floating"
  },
  {
    "product": "USOIL.MMMYY",
    "name": "美国原油期货合约(CFD)",
    "contractSize": 1000,
    "pipValuePerLot": "10 美元",
    "leverage400": "500 USD",
    "leverage200": "500 USD",
    "leverage100": "500 USD",
    "baseCurrency": "",
    "pricingCurrency": "USD",
    "marginType": "Fixed"
  },
  {
    "product": "UKOIL.MMMYY",
    "name": "英国原油期货合约(CFD)",
    "contractSize": 1000,
    "pipValuePerLot": "10 美元",
    "leverage400": "500 USD",
    "leverage200": "500 USD",
    "leverage100": "500 USD",
    "baseCurrency": "",
    "pricingCurrency": "USD",
    "marginType": "Fixed"
  },
  {
    "product": "NGAS.MMMYY",
    "name": "美国天然气期货合约(CFD)",
    "contractSize": 10000,
    "pipValuePerLot": "10 美元",
    "leverage400": "1:50",
    "leverage200": "1:50",
    "leverage100": "1:50",
    "baseCurrency": "",
    "pricingCurrency": "USD",
    "marginType": "Floating"
  },
  {
    "product": "HG_MMMYY",
    "name": "銅期货合约(CFD)",
    "contractSize": 25000,
    "pipValuePerLot": "25 美元",
    "leverage400": "1:50",
    "leverage200": "1:50",
    "leverage100": "1:50",
    "baseCurrency": "",
    "pricingCurrency": "USD",
    "marginType": "Floating"
  },
  {
    "product": "CHI50",
    "name": "富时中国A50指数现货(CFD)",
    "contractSize": 10,
    "pipValuePerLot": "10 美元",
    "leverage400": "1:100",
    "leverage200": "1:100",
    "leverage100": "1:100",
    "baseCurrency": "",
    "pricingCurrency": "USD",
    "marginType": "Floating"
  },
  {
    "product": "HK50",
    "name": "香港恒生50指数现货(CFD)",
    "contractSize": 50,
    "pipValuePerLot": "50 港元",
    "leverage400": "1:100",
    "leverage200": "1:100",
    "leverage100": "1:100",
    "baseCurrency": "",
    "pricingCurrency": "HKD",
    "marginType": "Floating"
  },
  {
    "product": "HKCH50",
    "name": "香港恒生国企H股指数现货(CFD)",
    "contractSize": 50,
    "pipValuePerLot": "50 港元",
    "leverage400": "1:100",
    "leverage200": "1:100",
    "leverage100": "1:100",
    "baseCurrency": "",
    "pricingCurrency": "HKD",
    "marginType": "Floating"
  },
  {
    "product": "AUS200",
    "name": "澳大利亚标准普尔/ASX指数现货(CFD)",
    "contractSize": 20,
    "pipValuePerLot": "20 澳元",
    "leverage400": "1:100",
    "leverage200": "1:100",
    "leverage100": "1:100",
    "baseCurrency": "",
    "pricingCurrency": "AUD",
    "marginType": "Floating"
  },
  {
    "product": "EU50",
    "name": "欧洲STOXX 50指数现货(CFD)",
    "contractSize": 30,
    "pipValuePerLot": "30 欧元",
    "leverage400": "1:100",
    "leverage200": "1:100",
    "leverage100": "1:100",
    "baseCurrency": "",
    "pricingCurrency": "EUR",
    "marginType": "Floating"
  },
  {
    "product": "ESP35",
    "name": "西班牙IBEX 35指数现货(CFD)",
    "contractSize": 10,
    "pipValuePerLot": "10 欧元",
    "leverage400": "1:100",
    "leverage200": "1:100",
    "leverage100": "1:100",
    "baseCurrency": "",
    "pricingCurrency": "EUR",
    "marginType": "Floating"
  },
  {
    "product": "FRA40",
    "name": "法国CAC 40指数现货(CFD)",
    "contractSize": 20,
    "pipValuePerLot": "20 欧元",
    "leverage400": "1:100",
    "leverage200": "1:100",
    "leverage100": "1:100",
    "baseCurrency": "",
    "pricingCurrency": "EUR",
    "marginType": "Floating"
  },
  {
    "product": "GER30",
    "name": "德国DAX 30指数现货(CFD)",
    "contractSize": 10,
    "pipValuePerLot": "10 欧元",
    "leverage400": "1:100",
    "leverage200": "1:100",
    "leverage100": "1:100",
    "baseCurrency": "",
    "pricingCurrency": "EUR",
    "marginType": "Floating"
  },
  {
    "product": "IT40",
    "name": "意大利MIB 40指数现货(CFD)",
    "contractSize": 10,
    "pipValuePerLot": "10 欧元",
    "leverage400": "1:100",
    "leverage200": "1:100",
    "leverage100": "1:100",
    "baseCurrency": "",
    "pricingCurrency": "EUR",
    "marginType": "Floating"
  },
  {
    "product": "JP225",
    "name": "日本日经225指数现货(CFD)",
    "contractSize": 10,
    "pipValuePerLot": "10美元",
    "leverage400": "1:100",
    "leverage200": "1:100",
    "leverage100": "1:100",
    "baseCurrency": "",
    "pricingCurrency": "USD",
    "marginType": "Floating"
  },
  {
    "product": "UK100",
    "name": "英国富时100指数现货(CFD)",
    "contractSize": 10,
    "pipValuePerLot": "10 英镑",
    "leverage400": "1:100",
    "leverage200": "1:100",
    "leverage100": "1:100",
    "baseCurrency": "",
    "pricingCurrency": "GBP",
    "marginType": "Floating"
  },
  {
    "product": "US30",
    "name": "美国道琼斯30指数现货(CFD)",
    "contractSize": 10,
    "pipValuePerLot": "10 美元",
    "leverage400": "1:100",
    "leverage200": "1:100",
    "leverage100": "1:100",
    "baseCurrency": "",
    "pricingCurrency": "USD",
    "marginType": "Floating"
  },
  {
    "product": "NAS100",
    "name": "美国纳斯达克100指数现货(CFD)",
    "contractSize": 20,
    "pipValuePerLot": "20 美元",
    "leverage400": "1:100",
    "leverage200": "1:100",
    "leverage100": "1:100",
    "baseCurrency": "",
    "pricingCurrency": "USD",
    "marginType": "Floating"
  },
  {
    "product": "SPX500",
    "name": "美国标准普尔500指数现货(CFD)",
    "contractSize": 50,
    "pipValuePerLot": "50 美元",
    "leverage400": "1:100",
    "leverage200": "1:100",
    "leverage100": "1:100",
    "baseCurrency": "",
    "pricingCurrency": "USD",
    "marginType": "Floating"
  },
  {
    "product": "US2000",
    "name": "美国羅素2000指數现货(CFD)",
    "contractSize": 50,
    "pipValuePerLot": "50 美元",
    "leverage400": "1:100",
    "leverage200": "1:100",
    "leverage100": "1:100",
    "baseCurrency": "",
    "pricingCurrency": "USD",
    "marginType": "Floating"
  },
  {
    "product": "USDX_MMMYY",
    "name": "美元指数期货合约(CFD)",
    "contractSize": 1000,
    "pipValuePerLot": "10 美元",
    "leverage400": "1:50",
    "leverage200": "1:50",
    "leverage100": "1:50",
    "baseCurrency": "",
    "pricingCurrency": "USD",
    "marginType": "Floating"
  }
];</script></head><body class="min-h-screen bg-custom"><div class="container mx-auto px-4 py-8 max-w-6xl"><!-- 页面标题 --><div class="text-center mb-8"><h1 class="text-4xl font-bold text-gray-800 mb-2"><i class="fas fa-calculator text-blue-600 mr-3"></i>PnL Calculator</h1><p class="text-gray-600 text-lg">Calculate Profits, Losses and Margin Precisely</p></div><!-- 主要内容区域 --><div class="bg-white rounded-2xl shadow-xl overflow-hidden"><!-- 表单区域 --><div class="p-8"><form class="space-y-6" id="pnlForm"><!-- 计算选项 --><div class="grid grid-cols-1 md:grid-cols-2 gap-6"><!-- 多订单选项 --><div class="flex items-center"><input class="w-5 h-5 text-blue-600 focus:ring-blue-500 border-gray-300 rounded" id="multipleOrders" type="checkbox"/><label class="ml-2 text-gray-700 font-medium" for="multipleOrders">Calculate Multiple Orders</label></div><!-- 仓位计算选项 --><div class="flex items-center"><input class="w-5 h-5 text-blue-600 focus:ring-blue-500 border-gray-300 rounded" id="positionCalculation" type="checkbox"/><label class="ml-2 text-gray-700 font-medium" for="positionCalculation">Include Position Calculations</label></div></div><!-- 余额输入框 (默认隐藏) --><div class="hidden" id="balanceContainer"><label class="block text-gray-700 font-semibold mb-2" for="balance"><i class="fas fa-wallet text-green-600 mr-2"></i>Account Balance (USD)</label><input class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" id="balance" min="0" placeholder="0.00" step="0.01" type="number"/></div><div class="hidden" id="globalCommissionContainer"><label class="block text-gray-700 font-semibold mb-2" for="globalCommissionRate"><i class="fas fa-receipt text-blue-600 mr-2"></i>Commission per lot</label><input class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" id="globalCommissionRate" placeholder="e.g., 7" step="any" type="number"/><p class="text-gray-500 text-sm mt-1">Commission per order = Lots × Commission per lot</p></div><!-- 订单管理按钮 (默认隐藏) --><div class="hidden" id="orderManagement"><div class="flex justify-between items-center"><h3 class="text-lg font-semibold text-gray-800"><i class="fas fa-list-alt text-blue-600 mr-2"></i>Order List</h3><button class="bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-lg transition-all" id="addOrderBtn" type="button"><i class="fas fa-plus mr-1"></i>Add Order</button></div></div><!-- 订单容器 --><div id="ordersContainer"><!-- 默认订单表单 --><div class="order-form bg-gray-50 p-6 rounded-xl mb-6" data-order-id="1"><div class="flex justify-between items-center mb-4"><h4 class="font-semibold text-gray-800">Order #1</h4><button class="remove-order-btn text-red-500 hover:text-red-700 transition-colors hidden" data-order-id="1" type="button"><i class="fas fa-trash"></i>Remove</button></div><!-- 产品搜索和选择 --><div class="relative mb-6"><label class="block text-gray-700 font-semibold mb-2" for="productSearch_1"><i class="fas fa-search text-blue-600 mr-2"></i>Product Search</label><div class="relative"><input class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" id="productSearch_1" placeholder="Search by product code or name..." type="text"/><div class="absolute w-full bg-white rounded-lg shadow-lg mt-1 z-10 max-h-60 overflow-y-auto hidden" id="searchResults_1"><!-- 搜索结果将动态显示在这里 --></div></div><div class="mt-2 p-3 bg-blue-50 rounded-lg hidden" id="selectedProduct_1"><div class="flex justify-between items-center"><div><span class="font-bold text-blue-800" id="productCode_1"></span><span class="text-gray-600 ml-2" id="productName_1"></span></div><button class="clear-product-btn text-red-500 hover:text-red-700" data-order-id="1" type="button"><i class="fas fa-times"></i></button></div></div></div><!-- 产品信息显示 --><div class="grid grid-cols-1 md:grid-cols-3 gap-4 p-4 bg-white rounded-lg hidden mb-6" id="productInfo_1"><div><p class="text-sm text-gray-600">Contract Size</p><p class="font-semibold" id="contractSize_1"></p></div><div><p class="text-sm text-gray-600">Pip Value per Lot</p><p class="font-semibold" id="pipValue_1"></p></div><div><p class="text-sm text-gray-600">Pricing Currency</p><p class="font-semibold" id="pricingCurrency_1"></p></div><div><p class="text-sm text-gray-600">Base Currency</p><p class="font-semibold" id="baseCurrency_1"></p></div><div><p class="text-sm text-gray-600">Margin Type</p><p class="font-semibold capitalize" id="marginType_1"></p></div><div><p class="text-sm text-gray-600">Margin per Lot (for selected leverage)</p><p class="font-semibold" id="perLotMargin_1"></p></div></div><!-- 交易详情 --><div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"><div><label class="block text-gray-700 font-semibold mb-2" for="tradeType_1"><i class="fas fa-exchange-alt text-green-600 mr-2"></i>Trade Type</label><select class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" disabled="" id="tradeType_1"><option value="buy">Buy</option><option value="sell">Sell</option></select></div><div><label class="block text-gray-700 font-semibold mb-2" for="leverage_1"><i class="fas fa-percentage text-purple-600 mr-2"></i>Select Leverage</label><select class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all leverage-select" disabled="" id="leverage_1"><option value="400">1:400</option><option value="200">1:200</option><option value="100">1:100</option></select></div></div><div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6"><div><label class="block text-gray-700 font-semibold mb-2" for="lots_1"><i class="fas fa-layer-group text-orange-600 mr-2"></i>Lots</label><input class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" disabled="" id="lots_1" min="0.01" placeholder="0.01" step="0.01" type="number"/></div><div><label class="block text-gray-700 font-semibold mb-2" for="openPrice_1"><i class="fas fa-arrow-up text-green-600 mr-2"></i>Open Price</label><input class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" disabled="" id="openPrice_1" min="0" placeholder="0.00000" step="0.00001" type="number"/></div><div><label class="block text-gray-700 font-semibold mb-2" for="closePrice_1"><i class="fas fa-arrow-down text-red-600 mr-2"></i>Close Price</label><input class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" disabled="" id="closePrice_1" min="0" placeholder="0.00000" step="0.00001" type="number"/></div></div><!-- 汇率输入 --><div class="mb-4 hidden" id="exchangeRateContainer_1"><label class="block text-gray-700 font-semibold mb-2" for="exchangeRate_1"><i class="fas fa-money-bill-wave text-teal-600 mr-2"></i>Exchange Rate Required</label><input class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" id="exchangeRate_1" min="0.00001" placeholder="Enter exchange rate" step="0.00001" type="number"/><p class="text-xs text-amber-600 mt-1 font-medium" id="exchangeRateHint_1">Please enter the exchange rate</p></div><!-- EURUSD汇率输入 (仅特定产品显示) --><div class="hidden" id="eurusdRateContainer_1"><label class="block text-gray-700 font-semibold mb-2" for="eurusdRate_1"><i class="fas fa-money-bill-wave text-purple-600 mr-2"></i>EURUSD Exchange Rate Required</label><input class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all" id="eurusdRate_1" min="0.00001" placeholder="Enter EURUSD rate" step="0.00001" type="number"/><p class="text-xs text-amber-600 mt-1 font-medium">Please enter the EURUSD exchange rate for margin conversion to USD</p></div></div></div><!-- 计算按钮 --><div class="text-center"><button class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg transition-all transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed" disabled="" id="calculateBtn" type="button"><i class="fas fa-calculator mr-2"></i>Calculate PnL &amp; Margin</button></div></form></div><!-- 结果显示区域 --><div class="bg-gradient-to-r from-blue-600 to-indigo-700 text-white p-8 hidden" id="resultsSection"><h2 class="text-2xl font-bold mb-6 text-center"><i class="fas fa-chart-line mr-2"></i>Calculation Results</h2><!-- 汇率提示 --><div class="bg-yellow-500 bg-opacity-20 rounded-xl p-4 backdrop-blur-sm mb-6 hidden" id="exchangeRateNote"><p class="text-sm flex items-center"><i class="fas fa-info-circle mr-2"></i>Please be advised that due to exchange rate fluctuations, the final amount may differ slightly from the actual order total.</p></div><!-- 对冲仓位提示 --><div class="bg-yellow-500 bg-opacity-20 rounded-xl p-4 backdrop-blur-sm mb-6 hidden" id="hedgeNotice"><h3 class="text-lg font-semibold flex items-center"><i class="fas fa-info-circle mr-2"></i>Hedge Position Detected</h3><p class="text-sm mt-2" id="hedgeDetails"></p></div><!-- 多订单汇总结果 --><div class="bg-white bg-opacity-10 rounded-xl p-6 backdrop-blur-sm mb-8 hidden" id="summaryResults"><h3 class="text-lg font-semibold mb-4"><i class="fas fa-calculator-alt mr-2"></i>Total Summary</h3><div class="grid grid-cols-1 md:grid-cols-3 gap-6"><!-- Total PnL (excl. commission) --><div><div class="text-sm opacity-80">Total PnL (excl. commission)</div><div class="text-3xl font-bold" id="totalPnLNoCommissionInUSD"></div></div><!-- Total PnL (incl. commission) --><div><div class="text-sm opacity-80">Total PnL (incl. commission)</div><div class="text-3xl font-bold" id="totalPnLWithCommissionInUSD"></div></div><!-- Total Margin in USD --><div><p class="text-sm opacity-80">Total Margin in USD</p><p class="text-3xl font-bold" id="totalMarginInUSD"></p></div></div></div><!-- 单个订单结果 --><div class="space-y-6" id="individualResults"><!-- 单个结果将动态插入到这里 --></div><!-- 仓位计算结果 (默认隐藏) --><div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-8 hidden" id="positionResults"><div class="bg-white bg-opacity-10 rounded-xl p-6 backdrop-blur-sm"><h3 class="text-lg font-semibold mb-4"><i class="fas fa-money-check-alt mr-2"></i>Equity</h3><div class="text-3xl font-bold" id="equity"></div><div class="text-sm opacity-80 mt-1">Balance + Total PnL</div></div><div class="bg-white bg-opacity-10 rounded-xl p-6 backdrop-blur-sm"><h3 class="text-lg font-semibold mb-4"><i class="fas fa-wallet mr-2"></i>Free Margin</h3><div class="text-3xl font-bold" id="freeMargin"></div><div class="text-sm opacity-80 mt-1">Equity - Total Margin</div></div><div class="bg-white bg-opacity-10 rounded-xl p-6 backdrop-blur-sm"><h3 class="text-lg font-semibold mb-4"><i class="fas fa-percent mr-2"></i>Margin Ratio</h3><div class="text-3xl font-bold" id="marginRatio"></div><div class="text-sm opacity-80 mt-1">Equity / Total Margin × 100%</div></div></div><!-- 详细计算过程 --><div class="mt-8 bg-white bg-opacity-10 rounded-xl p-6 backdrop-blur-sm"><h3 class="text-lg font-semibold mb-4"><i class="fas fa-calculator mr-2"></i>Calculation Details</h3><div class="space-y-4 text-sm" id="calculationDetails"><!-- 计算过程将动态显示在这里 --></div></div></div></div><!-- 最近计算历史 --><div class="mt-8 bg-white rounded-2xl shadow-xl overflow-hidden"><div class="p-6 border-b border-gray-200"><h2 class="text-xl font-bold text-gray-800"><i class="fas fa-history text-blue-600 mr-2"></i>Recent Calculations</h2></div><div class="p-6 max-h-60 overflow-y-auto" id="historyList"><p class="text-gray-500 text-center italic" id="noHistory">No calculation history yet</p><!-- 历史记录将动态显示在这里 --></div></div><!-- 页脚 --><div class="mt-8 text-center text-gray-600 py-4"><p>This page is developed by ATFX HKCS Team</p></div></div><script>// 全局变量
        let calculationHistory = [];
        let orderCount = 1;
        let currentLeverage = "400"; // 默认杠杆
        
        // 需要EURUSD汇率的产品列表
        const productsNeedingEurusd = ['EURHUF', 'EURPLN', 'XAUEUR'];
            // Futures Products (hedged portion margin = 50%)
            const futuresProducts = ['GOLD_MMMYY','HG_MMMYY','USOIL.MMMYY','UKOIL.MMMYY','NGAS.MMMYY','USDX_MMMYY'];
            // Products whose hedged portion keeps 50% margin
            const fiftyPercentHedgeProducts = ['GOLD_MMMYY','HG_MMMYY','USOIL.MMMYY','UKOIL.MMMYY','NGAS.MMMYY','USDX_MMMYY'];
        
        // 页面加载后初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 绑定事件监听器
            document.getElementById('addOrderBtn').addEventListener('click', addNewOrder);
            document.getElementById('calculateBtn').addEventListener('click', calculateAllOrders);
            document.getElementById('positionCalculation').addEventListener('change', togglePositionCalculation);
            document.getElementById('multipleOrders').addEventListener('change', toggleMultipleOrders);
            
            // 初始化杠杆同步
            document.addEventListener('change', function(e) {
                if (e.target.classList.contains('leverage-select') && !e.target.disabled) {
                    syncLeverageAcrossOrders(e.target.value);
                }
            });
            
            // 初始化第一个订单
            initOrderEvents(1);
            
            // 为删除按钮添加事件委托
            document.getElementById('ordersContainer').addEventListener('click', function(e) {
                if (e.target.closest('.remove-order-btn')) {
                    const btn = e.target.closest('.remove-order-btn');
                    const orderId = parseInt(btn.getAttribute('data-order-id'));
                    removeOrder(orderId);
                }
            });
            
            // 添加输入事件监听器以更新计算按钮状态
            document.addEventListener('input', updateCalculateButtonState);
            document.addEventListener('change', updateCalculateButtonState);
        });
        
        // 在所有订单间同步杠杆
        function syncLeverageAcrossOrders(leverageValue) {
            currentLeverage = leverageValue;
            
            // 更新所有杠杆下拉框
            const leverageSelects = document.querySelectorAll('.leverage-select');
            leverageSelects.forEach(select =>{
                // 如果选择框已设置为此值或禁用，则跳过
                if (select.value !== leverageValue && !select.disabled) {
                    select.value = leverageValue;
                    
                    // 更新此订单的每手保证金显示
                    const orderId = select.id.split('_')[1];
                    updatePerLotMargin(orderId);
                }
            });
        }
        
        // 切换多订单功能
        function toggleMultipleOrders() {
            const multipleOrdersEnabled = this.checked;
            const orderManagement = document.getElementById('orderManagement');
            const removeButtons = document.querySelectorAll('.remove-order-btn');
            
            if (multipleOrdersEnabled) {
                orderManagement.classList.remove('hidden');
                // 显示所有订单的删除按钮，除非只有一个订单
                if (removeButtons.length >1) {
                    removeButtons.forEach(btn =>btn.classList.remove('hidden'));
                } else if (removeButtons.length === 1) {
                    removeButtons[0].classList.add('hidden');
                }
            } else {
                orderManagement.classList.add('hidden');
                // 隐藏所有删除按钮
                removeButtons.forEach(btn =>btn.classList.add('hidden'));
                
                // 移除额外订单，只保留第一个
                const orderForms = document.querySelectorAll('.order-form');
                if (orderForms.length >1) {
                    for (let i = orderForms.length - 1; i >0; i--) {
                        orderForms[i].remove();
                    }
                    orderCount = 1;
                }
            }
            
            updateCalculateButtonState();
        }
        
        // 切换仓位计算部分
        function togglePositionCalculation() {
            const balanceContainer = document.getElementById('balanceContainer');
            if (this.checked) {
                balanceContainer.classList.remove('hidden');
            } else {
                balanceContainer.classList.add('hidden');
            }
            const globalCommission = document.getElementById('globalCommissionContainer');
            if (globalCommission) { if (this.checked) globalCommission.classList.remove('hidden'); else globalCommission.classList.add('hidden'); }
            updateCalculateButtonState();
        }
        
        // 添加新订单表单
	function addNewOrder() {
    	// Keep numbering contiguous after deletions: next order is (current forms count + 1)
    	orderCount = document.querySelectorAll('.order-form').length + 1;
    	const ordersContainer = document.getElementById('ordersContainer');

            
            // 克隆第一个订单表单
            const firstOrder = document.querySelector('.order-form');
            const newOrder = firstOrder.cloneNode(true);
            
            // 更新新订单的ID和属性
            newOrder.setAttribute('data-order-id', orderCount);
            newOrder.querySelector('h4').textContent = `Order #${orderCount}`;
            newOrder.querySelector('.remove-order-btn').setAttribute('data-order-id', orderCount);
            
            // 如果启用了多订单，显示删除按钮
            if (document.getElementById('multipleOrders').checked) {
                newOrder.querySelector('.remove-order-btn').classList.remove('hidden');
            }
            
            // 更新新订单中所有元素的ID
            const elements = newOrder.querySelectorAll('[id]');
            elements.forEach(element =>{
                const id = element.getAttribute('id');
                if (id) {
                    const newId = id.replace(/_\d+$/, `_${orderCount}`);
                    element.setAttribute('id', newId);
                }
            });
            
            // 更新label的for属性
            const labels = newOrder.querySelectorAll('label[for]');
            labels.forEach(label =>{
                const forAttr = label.getAttribute('for');
                if (forAttr) {
                    const newFor = forAttr.replace(/_\d+$/, `_${orderCount}`);
                    label.setAttribute('for', newFor);
                }
            });
            
            // 设置杠杆以匹配当前选择
            const leverageSelect = newOrder.querySelector('.leverage-select');
            leverageSelect.value = currentLeverage;
            
            // 重置表单值
            newOrder.querySelector(`[id^="selectedProduct_"]`).classList.add('hidden');
            newOrder.querySelector(`[id^="productInfo_"]`).classList.add('hidden');
            newOrder.querySelector(`[id^="exchangeRateContainer_"]`).classList.add('hidden');
            newOrder.querySelector(`[id^="eurusdRateContainer_"]`).classList.add('hidden');
            
            // 将新订单添加到容器
            ordersContainer.appendChild(newOrder);
            
            // 初始化新订单的事件
            initOrderEvents(orderCount);
            
            // 重置新订单的表单字段
            resetOrderForm(orderCount);
            
            updateCalculateButtonState();
        }
        
        // 初始化订单表单的事件
        function initOrderEvents(orderId) {
    // limit queries within the current order form and add null-safety
    const orderRoot = document.querySelector(`.order-form[data-order-id="${orderId}"]`);
    if (!orderRoot) return;

    // product search input
    const searchInput = orderRoot.querySelector(`#productSearch_${orderId}`);
    if (!searchInput) return;
    const newSearchInput = searchInput.cloneNode(true);
    searchInput.parentNode.replaceChild(newSearchInput, searchInput);
    newSearchInput.addEventListener('input', function() {
        handleProductSearch(orderId, this.value);
    });

    // clear selected product
    const clearBtn = orderRoot.querySelector(`.clear-product-btn[data-order-id="${orderId}"]`);
    if (clearBtn) {
        const newClearBtn = clearBtn.cloneNode(true);
        clearBtn.parentNode.replaceChild(newClearBtn, clearBtn);
        newClearBtn.addEventListener('click', function() {
            clearSelectedProduct(orderId);
            updateCalculateButtonState();
        });
    }

    // click outside to hide search results (scoped)
    document.addEventListener('click', function(e) {
        const searchBox = orderRoot.querySelector(`#productSearch_${orderId}`);
        const container = searchBox ? searchBox.closest('.relative') : null;
        if (container && !container.contains(e.target)) {
            const list = document.getElementById(`searchResults_${orderId}`);
            if (list) list.classList.add('hidden');
        }
    });
}

        
        // 移除订单
        function removeOrder(orderId) {
            const orderForm = document.querySelector(`.order-form[data-order-id="${orderId}"]`);
            if (orderForm) {
                orderForm.remove();
                
                // 如果启用了多订单，更新订单编号
                if (document.getElementById('multipleOrders').checked) {
                    const remainingOrders = Array.from(document.querySelectorAll('.order-form'));
                    remainingOrders.forEach((order, index) =>{
                        const newOrderId = index + 1;
                        const oldOrderId = order.getAttribute('data-order-id');
                        
                        // 如果已具有正确ID，则跳过
                        if (parseInt(oldOrderId) === newOrderId) return;
                        
                        // 更新数据属性
                        order.setAttribute('data-order-id', newOrderId);
                        
                        // 更新标题
                        order.querySelector('h4').textContent = `Order #${newOrderId}`;
                        
                        // 更新删除按钮
                        const removeBtn = order.querySelector('.remove-order-btn');
                        if (removeBtn) {
                            removeBtn.setAttribute('data-order-id', newOrderId);
                        }
                        
                        // 更新订单中所有元素的ID
                        const elements = order.querySelectorAll('[id]');
                        elements.forEach(element =>{
                            const id = element.getAttribute('id');
                            if (id) {
                                const newId = id.replace(`_${oldOrderId}`, `_${newOrderId}`);
                                element.setAttribute('id', newId);
                            }
                        });
                        
                        // 更新label的for属性
                        const labels = order.querySelectorAll('label[for]');
                        labels.forEach(label =>{
                            const forAttr = label.getAttribute('for');
                            if (forAttr) {
                                const newFor = forAttr.replace(`_${oldOrderId}`, `_${newOrderId}`);
                                label.setAttribute('for', newFor);
                            }
                        });
                        
                        // 使用新ID重新初始化此订单的事件
                        initOrderEvents(newOrderId);
                    });
                    
                    orderCount = remainingOrders.length;
                    
                    // 如果只剩下一个订单，隐藏删除按钮
                    if (remainingOrders.length === 1) {
                        remainingOrders[0].querySelector('.remove-order-btn').classList.add('hidden');
                    }
                }
                
                updateCalculateButtonState();
            }
        }
        
        // 重置订单表单
        function resetOrderForm(orderId) {
            document.getElementById(`productSearch_${orderId}`).value = '';
            document.getElementById(`tradeType_${orderId}`).disabled = true;
            document.getElementById(`leverage_${orderId}`).disabled = true;
            document.getElementById(`lots_${orderId}`).disabled = true;
            document.getElementById(`openPrice_${orderId}`).disabled = true;
            document.getElementById(`closePrice_${orderId}`).disabled = true;
            document.getElementById(`lots_${orderId}`).value = '';
            document.getElementById(`openPrice_${orderId}`).value = '';
            document.getElementById(`closePrice_${orderId}`).value = '';
            document.getElementById(`exchangeRate_${orderId}`).value = '';
            document.getElementById(`eurusdRate_${orderId}`).value = '';
        }
        
        // 处理特定订单的产品搜索
        function handleProductSearch(orderId, searchTerm) {
            const resultsContainer = document.getElementById(`searchResults_${orderId}`);
            resultsContainer.innerHTML = '';
            
            if (searchTerm.length< 1) {
                resultsContainer.classList.add('hidden');
                return;
            }
            
            // 搜索匹配的产品
            const matchingProducts = productsData.filter(product =>{
                return product.product.toLowerCase().includes(searchTerm.toLowerCase()) || 
                       product.name.toLowerCase().includes(searchTerm.toLowerCase());
            });
            
            if (matchingProducts.length === 0) {
                resultsContainer.innerHTML = '<div class="p-3 text-gray-500">No matching products found</div>';
                resultsContainer.classList.remove('hidden');
                return;
            }
            
            // 显示搜索结果
            matchingProducts.forEach(product =>{
                const resultItem = document.createElement('div');
                resultItem.className = 'p-3 hover:bg-blue-50 cursor-pointer transition-colors border-b border-gray-100';
                resultItem.innerHTML = `<div class="font-semibold text-gray-800">${product.product}</div><div class="text-sm text-gray-600">${product.name}</div><div class="text-xs text-gray-500 mt-1">Margin Type: ${product.marginType} | Margin per lot at 1:400 leverage: ${product.leverage400}</div>`;
                resultItem.addEventListener('click', () =>{
                    selectProduct(orderId, product);
                    updateCalculateButtonState();
                });
                resultsContainer.appendChild(resultItem);
            });
            
            resultsContainer.classList.remove('hidden');
        }
        
        // 为特定订单选择产品
        function selectProduct(orderId, product) {
            // 更新UI
            document.getElementById(`productCode_${orderId}`).textContent = product.product;
            document.getElementById(`productName_${orderId}`).textContent = product.name;
            document.getElementById(`selectedProduct_${orderId}`).classList.remove('hidden');
            document.getElementById(`searchResults_${orderId}`).classList.add('hidden');
            document.getElementById(`productSearch_${orderId}`).value = '';
            
            // 在元素上存储产品数据供以后使用
            document.getElementById(`selectedProduct_${orderId}`).setAttribute('data-product', JSON.stringify(product));
            
            // 显示产品信息
            document.getElementById(`contractSize_${orderId}`).textContent = product.contractSize.toLocaleString();
            document.getElementById(`pipValue_${orderId}`).textContent = product.pipValuePerLot;
            document.getElementById(`pricingCurrency_${orderId}`).textContent = product.pricingCurrency;
            document.getElementById(`baseCurrency_${orderId}`).textContent = product.baseCurrency || '-';
            document.getElementById(`marginType_${orderId}`).textContent = product.marginType;
            
            // 根据当前杠杆更新每手保证金
            updatePerLotMargin(orderId);
            
            document.getElementById(`productInfo_${orderId}`).classList.remove('hidden');
            
            // 确定是否显示汇率输入
            const pricingCurrency = product.pricingCurrency;
            const exchangeRateContainer = document.getElementById(`exchangeRateContainer_${orderId}`);
            const exchangeRateHint = document.getElementById(`exchangeRateHint_${orderId}`);
            
            if (pricingCurrency !== 'USD') {
                exchangeRateContainer.classList.remove('hidden');
                exchangeRateHint.textContent = `Required: 1 ${pricingCurrency} = ? USD`;
                document.getElementById(`exchangeRate_${orderId}`).setAttribute('placeholder', `1 ${pricingCurrency} = X USD`);
            } else {
                exchangeRateContainer.classList.add('hidden');
            }
            
            // 对于特定产品，显示EURUSD汇率输入
            const eurusdRateContainer = document.getElementById(`eurusdRateContainer_${orderId}`);
            if (productsNeedingEurusd.includes(product.product)) {
                eurusdRateContainer.classList.remove('hidden');
            } else {
                eurusdRateContainer.classList.add('hidden');
            }
            
            // 启用表单字段
            document.getElementById(`tradeType_${orderId}`).disabled = false;
            document.getElementById(`leverage_${orderId}`).disabled = false;
            document.getElementById(`lots_${orderId}`).disabled = false;
            document.getElementById(`openPrice_${orderId}`).disabled = false;
            document.getElementById(`closePrice_${orderId}`).disabled = false;
        }
        
        // 清除特定订单的选定产品
        function clearSelectedProduct(orderId) {
            document.getElementById(`selectedProduct_${orderId}`).classList.add('hidden');
            document.getElementById(`productInfo_${orderId}`).classList.add('hidden');
            document.getElementById(`exchangeRateContainer_${orderId}`).classList.add('hidden');
            document.getElementById(`eurusdRateContainer_${orderId}`).classList.add('hidden');
            
            // 禁用表单字段
            document.getElementById(`tradeType_${orderId}`).disabled = true;
            document.getElementById(`leverage_${orderId}`).disabled = true;
            document.getElementById(`lots_${orderId}`).disabled = true;
            document.getElementById(`openPrice_${orderId}`).disabled = true;
            document.getElementById(`closePrice_${orderId}`).disabled = true;
        }
        
        // 当杠杆变化时更新"每手保证金"显示
        function updatePerLotMargin(orderId) {
            const productElement = document.getElementById(`selectedProduct_${orderId}`);
            if (!productElement || productElement.classList.contains('hidden')) return;
            
            const product = JSON.parse(productElement.getAttribute('data-product'));
            const selectedLeverage = document.getElementById(`leverage_${orderId}`).value;
            let perLotMargin = '';
            
            switch(selectedLeverage) {
                case '400':
                    perLotMargin = product.leverage400;
                    break;
                case '200':
                    perLotMargin = product.leverage200;
                    break;
                case '100':
                    perLotMargin = product.leverage100;
                    break;
            }
            
            document.getElementById(`perLotMargin_${orderId}`).textContent = perLotMargin;
        }
        
        // 根据表单有效性更新计算按钮状态
        function updateCalculateButtonState() {
            const calculateBtn = document.getElementById('calculateBtn');
            const orderForms = document.querySelectorAll('.order-form');
            let allOrdersValid = true;
            
            // 检查每个订单的有效数据
            orderForms.forEach(orderForm =>{
                const orderId = orderForm.getAttribute('data-order-id');
                const productSelected = !document.getElementById(`selectedProduct_${orderId}`).classList.contains('hidden');
                
                // 检查是否选择了产品
                if (!productSelected) {
                    allOrdersValid = false;
                    return; // 退出当前订单的循环
                }
                
                // 获取产品数据
                const productElement = document.getElementById(`selectedProduct_${orderId}`);
                const product = JSON.parse(productElement.getAttribute('data-product'));
                
                // 获取表单值
                const lotsInput = document.getElementById(`lots_${orderId}`);
                const openPriceInput = document.getElementById(`openPrice_${orderId}`);
                const closePriceInput = document.getElementById(`closePrice_${orderId}`);
                
                // 检查必填字段是否有值
                if (!lotsInput.value || !openPriceInput.value || !closePriceInput.value) {
                    allOrdersValid = false;
                    return;
                }
                
                // 验证数值
                const lotsNum = parseFloat(lotsInput.value);
                const openPriceNum = parseFloat(openPriceInput.value);
                const closePriceNum = parseFloat(closePriceInput.value);
                
                if (isNaN(lotsNum) || isNaN(openPriceNum) || isNaN(closePriceNum) || 
                    lotsNum<= 0 || openPriceNum<= 0 || closePriceNum<= 0) {
                    allOrdersValid = false;
                    return;
                }
                
                // 检查是否需要汇率且有效
                if (product.pricingCurrency !== 'USD') {
                    const exchangeRateInput = document.getElementById(`exchangeRate_${orderId}`);
                    if (!exchangeRateInput.value) {
                        allOrdersValid = false;
                        return;
                    }
                    
                    const exchangeRateNum = parseFloat(exchangeRateInput.value);
                    if (isNaN(exchangeRateNum) || exchangeRateNum<= 0) {
                        allOrdersValid = false;
                        return;
                    }
                }
                
                // 对于特定产品，检查EURUSD汇率是否有效
                if (productsNeedingEurusd.includes(product.product)) {
                    const eurusdRateInput = document.getElementById(`eurusdRate_${orderId}`);
                    if (!eurusdRateInput.value) {
                        allOrdersValid = false;
                        return;
                    }
                    
                    const eurusdRateNum = parseFloat(eurusdRateInput.value);
                    if (isNaN(eurusdRateNum) || eurusdRateNum<= 0) {
                        allOrdersValid = false;
                        return;
                    }
                }
            });
            
            // 如果启用了仓位计算，检查账户余额
            const positionCalculationEnabled = document.getElementById('positionCalculation').checked;
            if (positionCalculationEnabled) {
                const balanceInput = document.getElementById('balance');
                if (!balanceInput.value) {
                    allOrdersValid = false;
                } else {
                    const balanceNum = parseFloat(balanceInput.value);
                    if (isNaN(balanceNum) || balanceNum<= 0) {
                        allOrdersValid = false;
                    }
                }
            }
            
            // 更新按钮状态
            calculateBtn.disabled = !allOrdersValid;
        }
        
        // 使用对冲仓位逻辑计算所有订单
        function calculateAllOrders() {
            const orderForms = document.querySelectorAll('.order-form');
            const multipleOrdersEnabled = document.getElementById('multipleOrders').checked;
            const positionCalculationEnabled = document.getElementById('positionCalculation').checked;
            
            // 检查是否有任何订单使用汇率转换
            let usesExchangeRate = false;
            
            // 首先，计算所有单个订单
            let allOrderResults = [];
            orderForms.forEach(orderForm =>{
                const orderId = parseInt(orderForm.getAttribute('data-order-id'));
                const result = calculateSingleOrder(orderId);
                
                if (result) {
                    allOrderResults.push(result);
                    
                    // 检查此订单是否使用汇率
                    if (result.product.pricingCurrency !== 'USD' || 
                        productsNeedingEurusd.includes(result.product.product)) {
                        usesExchangeRate = true;
                    }
                }
            });
            
            // 按产品分组订单以进行对冲计算
            const products = {};
            allOrderResults.forEach(order =>{
                const productCode = order.product.product;
                if (!products[productCode]) {
                    products[productCode] = {
                        product: order.product,
                        buyOrders: [],
                        sellOrders: [],
                        totalBuyLots: 0,
                        totalSellLots: 0
                    };
                }
                
                if (order.tradeType === 'buy') {
                    products[productCode].buyOrders.push(order);
                    products[productCode].totalBuyLots += order.lots;
                } else {
                    products[productCode].sellOrders.push(order);
                    products[productCode].totalSellLots += order.lots;
                }
            });
            
            // 计算对冲仓位并调整保证金
            let hasHedgePositions = false;
            let hedgeDetails = [];
            
            Object.values(products).forEach(productData =>{
                // 检查此产品是否同时有买入和卖出订单
                if (productData.totalBuyLots >0 && productData.totalSellLots >0) {
                    hasHedgePositions = true;
                    
                    // 计算对冲金额（买入和卖出的最小值）
                    const hedgedLots = Math.min(productData.totalBuyLots, productData.totalSellLots);
                    const remainingBuyLots = productData.totalBuyLots - hedgedLots;
                    const remainingSellLots = productData.totalSellLots - hedgedLots;
                    
                    // 添加到对冲详情
                    hedgeDetails.push(`${productData.product.product}: ${hedgedLots} lots hedged (${productData.totalBuyLots} buy / ${productData.totalSellLots} sell)`);
                    
                    // 计算此产品的每手保证金
                    const leverage = productData.buyOrders.length >0 
                        ? productData.buyOrders[0].selectedLeverage 
                        : productData.sellOrders[0].selectedLeverage;
                    
                    const perLotMarginMatch = productData.product[`leverage${leverage}`].match(/^(\d+\.?\d*) ([A-Z]{3})$/);
                    if (perLotMarginMatch) {
                        const perLotMarginAmount = parseFloat(perLotMarginMatch[1]);
                        const marginCurrency = perLotMarginMatch[2];

                        // For hedged lots we will keep 50% of each order's own per-lot USD margin.
                        let remainingBuyToAllocate = remainingBuyLots;
                        productData.buyOrders.forEach(order =>{
                            order.originalMarginInUSD = order.marginInUSD;
                            const perLotUSD = (order.lots > 0) ? (order.originalMarginInUSD / order.lots) : 0;

                            let hedgedInThisOrder = 0;
                            if (remainingBuyToAllocate <= 0) {
                                hedgedInThisOrder = order.lots;
                            } else {
                                hedgedInThisOrder = Math.max(0, order.lots - remainingBuyToAllocate);
                            }

                            const nonHedgedLots = order.lots - hedgedInThisOrder;
                            // non-hedged portion uses order's per-lot; hedged portion keeps 50% of this order's per-lot
                            order.marginInUSD = nonHedgedLots * perLotUSD + hedgedInThisOrder * (0.5 * perLotUSD);
                            order.isHedged = hedgedInThisOrder > 0;
                            order.hedgedLots = hedgedInThisOrder;

                            if (remainingBuyToAllocate > 0) remainingBuyToAllocate -= (order.lots - hedgedInThisOrder);
                        });

                        // 调整卖出订单的保证金 — hedged lots use averageHedgedPerLotUSD per lot
                        let remainingSellToAllocate = remainingSellLots;
                        productData.sellOrders.forEach(order =>{
                            order.originalMarginInUSD = order.marginInUSD;
                            const perLotUSD = (order.lots > 0) ? (order.originalMarginInUSD / order.lots) : 0;

                            let hedgedInThisOrder = 0;
                            if (remainingSellToAllocate <= 0) {
                                hedgedInThisOrder = order.lots;
                            } else {
                                hedgedInThisOrder = Math.max(0, order.lots - remainingSellToAllocate);
                            }

                            const nonHedgedLots = order.lots - hedgedInThisOrder;
                            order.marginInUSD = nonHedgedLots * perLotUSD + hedgedInThisOrder * (0.5 * perLotUSD);
                            order.isHedged = hedgedInThisOrder > 0;
                            order.hedgedLots = hedgedInThisOrder;

                            if (remainingSellToAllocate > 0) remainingSellToAllocate -= (order.lots - hedgedInThisOrder);
                        });
                    } else {
                        // Floating-margin products: for hedged lots we will keep 50% of each order's own per-lot USD margin.

                        let remainingBuyToAllocate = remainingBuyLots;
                        productData.buyOrders.forEach(order =>{
                            order.originalMarginInUSD = order.marginInUSD;
                            const perLotUSD = (order.lots > 0) ? (order.originalMarginInUSD / order.lots) : 0;

                            let hedgedInThisOrder = 0;
                            if (remainingBuyToAllocate <= 0) {
                                hedgedInThisOrder = order.lots;
                            } else {
                                hedgedInThisOrder = Math.max(0, order.lots - remainingBuyToAllocate);
                            }

                            const nonHedgedLots = order.lots - hedgedInThisOrder;
                            // non-hedged portion uses order's per-lot; hedged portion keeps 50% of this order's per-lot
                            order.marginInUSD = nonHedgedLots * perLotUSD + hedgedInThisOrder * (0.5 * perLotUSD);
                            order.isHedged = hedgedInThisOrder > 0;
                            order.hedgedLots = hedgedInThisOrder;

                            if (remainingBuyToAllocate > 0) remainingBuyToAllocate -= (order.lots - hedgedInThisOrder);
                        });

                        // Adjust sell orders similarly
                        let remainingSellToAllocate = remainingSellLots;
                        productData.sellOrders.forEach(order =>{
                            order.originalMarginInUSD = order.marginInUSD;
                            const perLotUSD = (order.lots > 0) ? (order.originalMarginInUSD / order.lots) : 0;

                            let hedgedInThisOrder = 0;
                            if (remainingSellToAllocate <= 0) {
                                hedgedInThisOrder = order.lots;
                            } else {
                                hedgedInThisOrder = Math.max(0, order.lots - remainingSellToAllocate);
                            }

                            const nonHedgedLots = order.lots - hedgedInThisOrder;
                            order.marginInUSD = nonHedgedLots * perLotUSD + hedgedInThisOrder * (0.5 * perLotUSD);
                            order.isHedged = hedgedInThisOrder > 0;
                            order.hedgedLots = hedgedInThisOrder;

                            if (remainingSellToAllocate > 0) remainingSellToAllocate -= (order.lots - hedgedInThisOrder);
                        });
                    }
                } else {
                    // 此产品没有对冲
                    [...productData.buyOrders, ...productData.sellOrders].forEach(order =>{
                        order.isHedged = false;
                        order.hedgedLots = 0;
                        order.originalMarginInUSD = order.marginInUSD;
                    });
                }
            });
            
            // 使用调整后的保证金计算总计
            let totalPnLInUSD = 0;
            let totalMarginInUSD = 0;
            let totalOriginalMarginInUSD = 0;
            
            allOrderResults.forEach(order =>{
                totalPnLInUSD += order.pnlInUSD;
                totalMarginInUSD += order.marginInUSD;
                totalOriginalMarginInUSD += order.originalMarginInUSD;
            });
            
            // Preserve total PnL before commission and prepare after-commission value
            const totalPnLNoCommissionInUSD = totalPnLInUSD;
            let totalPnLWithCommissionInUSD = totalPnLInUSD;
            
            
            // 显示包含对冲信息的结果
            
            // Deduct commissions using global commission rate and attach per-order commission to details
            const positionOn = document.getElementById('positionCalculation').checked;
            const globalRateEl = document.getElementById('globalCommissionRate');
            const globalRate = globalRateEl ? (parseFloat(globalRateEl.value) || 0) : 0;
            let totalCommissionUSD = 0;
            if (positionOn) {
                allOrderResults.forEach(order =>{
                    const commissionUSD = (parseFloat(order.lots) || 0) * globalRate;
                    order.commissionUSD = commissionUSD;
                    totalCommissionUSD += commissionUSD;
                });
                totalPnLInUSD -= totalCommissionUSD;
                totalPnLWithCommissionInUSD = totalPnLInUSD;
            } else {
                allOrderResults.forEach(order =>{ order.commissionUSD = 0; });
            }
            displayResults(
                allOrderResults, 
                totalPnLInUSD, 
                totalMarginInUSD, 
                totalOriginalMarginInUSD,
                multipleOrdersEnabled, 
                positionCalculationEnabled,
                hasHedgePositions,
                hedgeDetails,
                usesExchangeRate,
                totalPnLNoCommissionInUSD,
                totalPnLWithCommissionInUSD
            );
            
            // 添加到历史记录
            addToHistory(allOrderResults, totalPnLInUSD, totalMarginInUSD, positionCalculationEnabled);
        }
        
        // 计算单个订单
        function calculateSingleOrder(orderId) {
            const productElement = document.getElementById(`selectedProduct_${orderId}`);
            if (!productElement || productElement.classList.contains('hidden')) return null;
            
            const product = JSON.parse(productElement.getAttribute('data-product'));
            
            // 获取表单值
            const tradeType = document.getElementById(`tradeType_${orderId}`).value;
            const selectedLeverage = document.getElementById(`leverage_${orderId}`).value;
            const lots = parseFloat(document.getElementById(`lots_${orderId}`).value);
            const openPrice = parseFloat(document.getElementById(`openPrice_${orderId}`).value);
            const closePrice = parseFloat(document.getElementById(`closePrice_${orderId}`).value);
            const contractSize = product.contractSize;
            const pricingCurrency = product.pricingCurrency;
            
            // 输入验证
            if (isNaN(lots) || isNaN(openPrice) || isNaN(closePrice) || lots<= 0 || openPrice<= 0 || closePrice<= 0) {
                alert(`Please enter valid positive numbers for Order #${orderId}`);
                return null;
            }
            
            // 汇率处理
            let exchangeRate = 1.0;
            if (pricingCurrency !== 'USD') {
                exchangeRate = parseFloat(document.getElementById(`exchangeRate_${orderId}`).value) || 0;
                if (exchangeRate<= 0) {
                    alert(`Please enter a valid exchange rate for Order #${orderId}`);
                    return null;
                }
            }
            
            // 对于特定产品，获取EURUSD汇率
            let eurusdRate = 1.0;
            if (productsNeedingEurusd.includes(product.product)) {
                eurusdRate = parseFloat(document.getElementById(`eurusdRate_${orderId}`).value) || 0;
                if (eurusdRate<= 0) {
                    alert(`Please enter a valid EURUSD exchange rate for Order #${orderId}`);
                    return null;
                }
            }
            
            // 盈亏计算
            const priceChange = closePrice - openPrice;
            const directionFactor = tradeType === 'buy' ? 1 : -1;
            const pnl = priceChange * contractSize * lots * directionFactor;
            let pnlInUSD = pnl;
if (pricingCurrency === 'USD') {
  pnlInUSD = pnl;
} else if (pricingCurrency === 'EUR' && productsNeedingEurusd.includes(product.product) && eurusdRate > 0) {
  pnlInUSD = pnl * eurusdRate;
} else {
  pnlInUSD = pnl * exchangeRate;
}
            const pnlCurrency = product.pipValuePerLot.match(/[A-Z]{3}$/)?.[0] || pricingCurrency;
            
            // 基于保证金类型的保证金计算
            let marginRequired = 0;
            let marginCurrency = '';
            let marginCalculationDesc = '';
            const perLotMarginValue = product[`leverage${selectedLeverage}`];
            
            if (product.marginType === 'Fixed') {
                const fixedMarginMatch = perLotMarginValue.match(/^(\d+\.?\d*) ([A-Z]{3})$/);
                if (!fixedMarginMatch) {
                    alert(`Invalid fixed margin format for ${product.product} (${perLotMarginValue})`);
                    return null;
                }
                const perLotMarginAmount = parseFloat(fixedMarginMatch[1]);
                marginCurrency = fixedMarginMatch[2];
                marginRequired = perLotMarginAmount * lots;
                marginCalculationDesc = `Fixed margin per lot (${perLotMarginAmount} ${marginCurrency}) × number of lots (${lots})`;
            
            } else if (product.marginType === 'Floating') {
                const leverageRatioMatch = perLotMarginValue.match(/^1:(\d+)$/);
                if (!leverageRatioMatch) {
                    alert(`Invalid leverage format for floating margin product ${product.product} (${perLotMarginValue})`);
                    return null;
                }
                const leverageRatio = parseInt(leverageRatioMatch[1]);
                marginCurrency = pricingCurrency;
                marginRequired = (openPrice * lots * contractSize) / leverageRatio;
                marginCalculationDesc = `Open price (${openPrice}) × lots (${lots}) × contract size (${contractSize.toLocaleString()}) ÷ leverage ratio (1:${leverageRatio})`;
            
            } else {
                alert(`Unknown margin type: ${product.marginType} (Product: ${product.product})`);
                return null;
            }
            
            // 保证金美元转换 - 对于EUR保证金产品，使用EURUSD汇率
            let marginInUSD = marginRequired;
if (marginCurrency === 'USD') {
  marginInUSD = marginRequired;
} else if (marginCurrency === 'EUR' && productsNeedingEurusd.includes(product.product) && eurusdRate > 0) {
  marginInUSD = marginRequired * eurusdRate;
} else {
  // Fallback to general exchangeRate for all non-USD (including EUR non-whitelist)
  marginInUSD = marginRequired * exchangeRate;
}
            
            // 盈亏百分比计算
            const pnlPercentage = (pnl / marginRequired) * 100;
            
            return {
                orderId,
                product,
                tradeType,
                selectedLeverage,
                lots,
                openPrice,
                closePrice,
                pnl,
                pnlCurrency,
                pnlInUSD,
                marginRequired,
                marginCurrency,
                marginInUSD,
                pnlPercentage,
                marginCalculationDesc,
                exchangeRate,
                eurusdRate: productsNeedingEurusd.includes(product.product) ? eurusdRate : null
            };
        }
        
        // 显示所有结果
        function displayResults(
            orderResults, 
            totalPnLInUSD, 
            totalMarginInUSD,
            totalOriginalMarginInUSD,
            multipleOrdersEnabled, 
            positionCalculationEnabled,
            hasHedgePositions,
            hedgeDetails,
            usesExchangeRate
        , totalPnLNoCommissionInUSD, totalPnLWithCommissionInUSD) {
            const resultsSection = document.getElementById('resultsSection');
            const individualResults = document.getElementById('individualResults');
            const summaryResults = document.getElementById('summaryResults');
            const calculationDetails = document.getElementById('calculationDetails');
            const hedgeNotice = document.getElementById('hedgeNotice');
            const hedgeDetailsEl = document.getElementById('hedgeDetails');
            const exchangeRateNote = document.getElementById('exchangeRateNote');
            
            // 清除先前的结果
            individualResults.innerHTML = '';
            calculationDetails.innerHTML = '';
            
            // 显示或隐藏汇率提示
            if (usesExchangeRate) {
                exchangeRateNote.classList.remove('hidden');
            } else {
                exchangeRateNote.classList.add('hidden');
            }
            
            // 显示或隐藏对冲提示
            if (hasHedgePositions) {
                hedgeNotice.classList.remove('hidden');
                hedgeDetailsEl.innerHTML = `Hedged positions detected: ${hedgeDetails.join('; ')}.`;
            } else {
                hedgeNotice.classList.add('hidden');
            }
            
            // 为多订单显示汇总
            if (multipleOrdersEnabled && orderResults.length >1) {
                summaryResults.classList.remove('hidden');
                
                const elNo = document.getElementById('totalPnLNoCommissionInUSD');
                const elWith = document.getElementById('totalPnLWithCommissionInUSD');
                if (elNo)  elNo.textContent  = `${(totalPnLNoCommissionInUSD ?? totalPnLInUSD).toFixed(2)} USD`;
                if (elWith) elWith.textContent = `${(totalPnLWithCommissionInUSD ?? totalPnLInUSD).toFixed(2)} USD`;
              
                
                // 如果有对冲，显示原始与调整后的保证金
                if (hasHedgePositions) {
                    document.getElementById('totalMarginInUSD').innerHTML = `
                        ${totalMarginInUSD.toFixed(2)} USD<div class="text-sm opacity-80">(Original: ${totalOriginalMarginInUSD.toFixed(2)} USD)</div>`;
                } else {
                    document.getElementById('totalMarginInUSD').textContent = `${totalMarginInUSD.toFixed(2)} USD`;
                }
            } else {
                summaryResults.classList.add('hidden');
            }
            
            // 显示单个订单结果
            orderResults.forEach(result =>{
                // 创建单个结果卡片
                const resultCard = document.createElement('div');
                resultCard.className = 'bg-white bg-opacity-10 rounded-xl p-6 backdrop-blur-sm';
                
                const isProfit = result.pnl >= 0;
                const pnlClass = isProfit ? 'text-green-400' : 'text-red-400';
                const pnlIcon = isProfit ? 'fas fa-arrow-up' : 'fas fa-arrow-down';
                
                // 准备包含对冲信息的保证金显示（如适用）
                let marginDisplay = `${result.marginInUSD.toFixed(2)} USD`;
                if (result.isHedged && result.hedgedLots >0) {
                    marginDisplay += `<div class="text-sm opacity-80">(Original: ${result.originalMarginInUSD.toFixed(2)} USD)</div><div class="text-xs bg-yellow-500 bg-opacity-20 px-2 py-1 rounded mt-1"><i class="fas fa-info-circle mr-1"></i>${result.hedgedLots} lots hedged ${futuresProducts.includes(result.product.product) ? '(hedged portion margin = 50%)' : '(margin reduced to 50%)'}</div>`;
                } else {
                    marginDisplay += `<div class="text-sm opacity-80">(${result.marginRequired.toFixed(2)} ${result.marginCurrency})</div>`;
                }
                
                resultCard.innerHTML = `<div class="flex justify-between items-center mb-4"><h3 class="text-lg font-semibold">${multipleOrdersEnabled ? `Order #${result.orderId}: ` : ''}${result.product.product} - ${result.product.name}</h3><span class="text-sm font-medium px-3 py-1 rounded-full ${isProfit ? 'bg-green-500 bg-opacity-20' : 'bg-red-500 bg-opacity-20'}">${result.tradeType === 'buy' ? 'Buy' : 'Sell'} | ${result.lots} lots | Leverage: 1:${result.selectedLeverage}</span></div><div class="grid grid-cols-1 md:grid-cols-2 gap-6"><div><h4 class="text-sm opacity-80 mb-1">Profit/Loss</h4><div class="font-bold text-xl ${pnlClass}"><i class="${pnlIcon} mr-1"></i>${result.pnlInUSD.toFixed(2)} USD</div><div class="text-sm opacity-80">(${result.pnl.toFixed(2)} ${result.pnlCurrency})</div><div class="text-xs opacity-80 mt-1">(Relative to margin: ${result.pnlPercentage.toFixed(2)}%)</div><div class="text-xs opacity-80 mt-1">Commission (USD): ${ (result.commissionUSD || 0).toFixed(2) }</div></div><div><h4 class="text-sm opacity-80 mb-1">Used Margin</h4><div class="font-bold text-xl">${marginDisplay}</div><div class="text-xs opacity-80 mt-1">${result.marginCalculationDesc}</div></div></div>`;
                
                individualResults.appendChild(resultCard);
                
                // 添加到计算详情
                const product = result.product;
                let hedgeInfo = '';
                if (result.isHedged && result.hedgedLots >0) {
                    hedgeInfo = `
                        ${futuresProducts.includes(product.product) ? `<div><strong>Hedged:</strong>${result.hedgedLots} lots (hedged portion margin = 50%)</div>` : `<div><strong>Hedged:</strong>${result.hedgedLots} lots (margin reduced to 50%)</div>`}<div><strong>Original Margin:</strong>${result.originalMarginInUSD.toFixed(2)} USD</div>`;
                }
                
                let exchangeRateInfo = '';
                if (product.pricingCurrency !== 'USD') {
                    exchangeRateInfo = `<div><strong>Exchange Rate Used:</strong>1 ${product.pricingCurrency} = ${result.exchangeRate} USD</div>`;
                }
                
                // 添加EURUSD汇率信息（如适用）
                let eurusdRateInfo = '';
                if (productsNeedingEurusd.includes(product.product)) {
                    eurusdRateInfo = `<div><strong>EURUSD Rate Used:</strong>${result.eurusdRate}</div>`;
                }
                
                let orderDetails = `<div class="p-3 bg-white bg-opacity-5 rounded-lg"><div class="font-medium mb-2">${multipleOrdersEnabled ? `Order #${result.orderId}: ` : ''}${product.product} - ${product.name}</div><div class="grid grid-cols-1 md:grid-cols-2 gap-x-4 gap-y-1 text-xs"><div><strong>Trade:</strong>${result.tradeType === 'buy' ? 'Buy' : 'Sell'} | ${result.lots} lots</div><div><strong>Leverage:</strong>1:${result.selectedLeverage}</div><div><strong>Open Price:</strong>${result.openPrice}</div><div><strong>Close Price:</strong>${result.closePrice}</div><div><strong>Price Change:</strong>${(result.closePrice - result.openPrice).toFixed(5)}</div><div><strong>Contract Size:</strong>${product.contractSize.toLocaleString()}</div><div><strong>PnL:</strong>${result.pnl.toFixed(2)} ${result.pnlCurrency} (${result.pnlInUSD.toFixed(2)} USD)</div><div><strong>Used Margin:</strong>${result.marginInUSD.toFixed(2)} USD (${result.marginRequired.toFixed(2)} ${result.marginCurrency})</div>${positionCalculationEnabled ? `<div><strong>Commission Deducted:</strong>$${(result.commissionUSD || 0).toFixed(2)}</div>` : ''}
                            ${exchangeRateInfo}
                            ${eurusdRateInfo}
                            ${hedgeInfo}</div></div>`;
                
                calculationDetails.innerHTML += orderDetails;
            });
            
            // 为多订单添加汇总计算
            if (multipleOrdersEnabled && orderResults.length >1) {
                let hedgeSummary = '';
                if (hasHedgePositions) {
                    hedgeSummary = `<div><strong>Original Total Margin:</strong>${totalOriginalMarginInUSD.toFixed(2)} USD</div><div><strong>Margin Reduction Due to Hedging:</strong>${(totalOriginalMarginInUSD - totalMarginInUSD).toFixed(2)} USD</div>`;
                }
                
                calculationDetails.innerHTML += `<div class="p-3 bg-white bg-opacity-10 rounded-lg mt-4"><div class="font-medium mb-2">Total Summary</div><div class="grid grid-cols-1 md:grid-cols-2 gap-x-4 gap-y-1 text-xs"><div><strong>Total PnL in USD:</strong>${totalPnLInUSD.toFixed(2)} USD</div><div><strong>Total Margin in USD:</strong>${totalMarginInUSD.toFixed(2)} USD</div><div><strong>Total Orders:</strong>${orderResults.length}</div><div><strong>Used Leverage:</strong>1:${currentLeverage}</div>${hedgeSummary}</div></div>`;
            }
            
            // 如果启用，计算并显示仓位指标
            const positionResults = document.getElementById('positionResults');
            if (positionCalculationEnabled) {
                const balance = parseFloat(document.getElementById('balance').value) || 0;
                const equity = balance + totalPnLInUSD;
                const freeMargin = equity - totalMarginInUSD;
                const marginRatio = (equity / totalMarginInUSD) * 100;
                
                document.getElementById('equity').textContent = `${equity.toFixed(2)} USD`;
                document.getElementById('freeMargin').textContent = `${freeMargin.toFixed(2)} USD`;
                document.getElementById('marginRatio').textContent = `${marginRatio.toFixed(2)}%`;
                
                positionResults.classList.remove('hidden');
                
                // 将仓位详情添加到计算详情
                calculationDetails.innerHTML += `<div class="p-3 bg-white bg-opacity-10 rounded-lg mt-4"><div class="font-medium mb-2">Position Calculations</div><div class="grid grid-cols-1 md:grid-cols-3 gap-x-4 gap-y-1 text-xs"><div><strong>Balance:</strong>${balance.toFixed(2)} USD</div><div><strong>Equity:</strong>${equity.toFixed(2)} USD (Balance + Total PnL)</div><div><strong>Free Margin:</strong>${freeMargin.toFixed(2)} USD (Equity - Total Margin)</div><div><strong>Margin Ratio:</strong>${marginRatio.toFixed(2)}% (Equity / Total Margin × 100%)</div></div></div>`;
            } else {
                positionResults.classList.add('hidden');
            }
            
            // 显示结果部分
            resultsSection.classList.remove('hidden');
        }
        
        // 添加到历史记录
        function addToHistory(orderResults, totalPnLInUSD, totalMarginInUSD, positionCalculationEnabled) {
            let balance = null;
            let equity = null;
            let freeMargin = null;
            let marginRatio = null;
            
            if (positionCalculationEnabled) {
                balance = parseFloat(document.getElementById('balance').value) || 0;
                equity = balance + totalPnLInUSD;
                freeMargin = equity - totalMarginInUSD;
                marginRatio = (equity / totalMarginInUSD) * 100;
            }
            
            const historyItem = {
                orders: orderResults,
                totalPnLInUSD,
                totalMarginInUSD,
                positionCalculation: positionCalculationEnabled,
                balance,
                equity,
                freeMargin,
                marginRatio,
                leverage: currentLeverage,
                timestamp: new Date()
            };
            
            calculationHistory.unshift(historyItem);
            if (calculationHistory.length >5) {
                calculationHistory.pop();
            }
            
            updateHistoryDisplay();
        }
        
        // 更新历史记录显示
        function updateHistoryDisplay() {
            const historyList = document.getElementById('historyList');
            const noHistory = document.getElementById('noHistory');
            
            if (calculationHistory.length === 0) {
                noHistory.classList.remove('hidden');
                historyList.innerHTML = '';
                return;
            }
            
            noHistory.classList.add('hidden');
            historyList.innerHTML = '';
            
            calculationHistory.forEach((item, index) =>{
                const historyItem = document.createElement('div');
                historyItem.className = 'p-4 border-b border-gray-100 hover:bg-gray-50 transition-colors';
                
                const isProfit = item.totalPnLInUSD >= 0;
                const pnlClass = isProfit ? 'text-green-600' : 'text-red-600';
                const pnlIcon = isProfit ? 'fas fa-arrow-up' : 'fas fa-arrow-down';
                
                // 创建订单摘要文本
                let orderSummary = '';
                if (item.orders.length === 1) {
                    const order = item.orders[0];
                    orderSummary = `${order.product.product} (${order.lots} lots)`;
                } else {
                    orderSummary = `${item.orders.length} orders`;
                }
                
                // 检查是否有对冲订单
                const hasHedgedOrders = item.orders.some(order =>order.isHedged);
                const hedgeIndicator = hasHedgedOrders ? 
                    '<span class="inline-block text-xs bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded ml-2">Hedged</span>' : '';
                
                // 格式化时间戳
                const formattedTime = item.timestamp.toLocaleString();
                
                // 仓位详情
                let positionDetails = '';
                if (item.positionCalculation) {
                    positionDetails = `<div class="text-xs text-gray-500 mt-1">Equity: ${item.equity.toFixed(2)} USD | Margin Ratio: ${item.marginRatio.toFixed(2)}%</div>`;
                }
                
                historyItem.innerHTML = `<div class="flex justify-between items-start"><div><div class="font-medium">${formattedTime}</div><div class="text-sm text-gray-600 mt-1">${orderSummary} ${hedgeIndicator}</div></div><div class="text-right"><div class="font-medium ${pnlClass}"><i class="${pnlIcon}"></i>${item.totalPnLInUSD.toFixed(2)} USD</div><div class="text-xs text-gray-500 mt-1">Margin: ${item.totalMarginInUSD.toFixed(2)} USD</div></div></div>${positionDetails}
                `;
                
                historyList.appendChild(historyItem);
            });
        }</script></body>
</template>

<template id="page-sea">
<html lang="en"><head><meta charset="utf-8"/><meta content="width=device-width, initial-scale=1.0" name="viewport"/><title>PnL Calculator</title><script src="https://cdn.tailwindcss.com"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" rel="stylesheet"/><style>.bg-custom {
            background: linear-gradient(rgba(255, 255, 255, 0.85), rgba(255, 255, 255, 0.85)), 
                        url('https://images.unsplash.com/photo-1611974789855-9c2a0a7236a3?ixlib=rb-4.0.3');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }</style><!-- 产品数据 --><script>const productsData = [
    {
        "product": "EURUSD",
        "name": "Euro/US Dollar",
        "contractSize": 100000,
        "pipValuePerLot": "10 USD",
        "leverage400": "250 USD",
        "leverage200": "500 USD",
        "leverage100": "1000 USD",
        "baseCurrency": "EUR",
        "pricingCurrency": "USD",
        "marginType": "Fixed"
    },
    {
        "product": "USDJPY",
        "name": "US Dollar/Japanese Yen",
        "contractSize": 100000,
        "pipValuePerLot": "1000 JPY",
        "leverage400": "250 USD",
        "leverage200": "500 USD",
        "leverage100": "1000 USD",
        "baseCurrency": "USD",
        "pricingCurrency": "JPY",
        "marginType": "Fixed"
    },
    {
        "product": "GBPUSD",
        "name": "Great British Pound/US Dollar",
        "contractSize": 100000,
        "pipValuePerLot": "10 USD",
        "leverage400": "250 USD",
        "leverage200": "500 USD",
        "leverage100": "1000 USD",
        "baseCurrency": "GBP",
        "pricingCurrency": "USD",
        "marginType": "Fixed"
    },
    {
        "product": "USDCHF",
        "name": "US Dollar/Swiss Franc",
        "contractSize": 100000,
        "pipValuePerLot": "10 CHF",
        "leverage400": "250 USD",
        "leverage200": "500 USD",
        "leverage100": "1000 USD",
        "baseCurrency": "USD",
        "pricingCurrency": "CHF",
        "marginType": "Fixed"
    },
    {
        "product": "AUDUSD",
        "name": "Australian Dollar/US Dollar",
        "contractSize": 100000,
        "pipValuePerLot": "10 USD",
        "leverage400": "250 USD",
        "leverage200": "500 USD",
        "leverage100": "1000 USD",
        "baseCurrency": "AUD",
        "pricingCurrency": "USD",
        "marginType": "Fixed"
    },
    {
        "product": "NZDUSD",
        "name": "New Zealand Dollar/US Dollar",
        "contractSize": 100000,
        "pipValuePerLot": "10 USD",
        "leverage400": "250 USD",
        "leverage200": "500 USD",
        "leverage100": "1000 USD",
        "baseCurrency": "NZD",
        "pricingCurrency": "USD",
        "marginType": "Fixed"
    },
    {
        "product": "USDCAD",
        "name": "US Dollar/Canadian Dollar",
        "contractSize": 100000,
        "pipValuePerLot": "10 CAD",
        "leverage400": "250 USD",
        "leverage200": "500 USD",
        "leverage100": "1000 USD",
        "baseCurrency": "USD",
        "pricingCurrency": "CAD",
        "marginType": "Fixed"
    },
    {
        "product": "AUDCAD",
        "name": "Australian Dollar/Canadian Dollar",
        "contractSize": 100000,
        "pipValuePerLot": "10 CAD",
        "leverage400": "250 USD",
        "leverage200": "500 USD",
        "leverage100": "1000 USD",
        "baseCurrency": "AUD",
        "pricingCurrency": "CAD",
        "marginType": "Fixed"
    },
    {
        "product": "AUDCHF",
        "name": "Australian Dollar/Swiss Franc",
        "contractSize": 100000,
        "pipValuePerLot": "10 CHF",
        "leverage400": "250 USD",
        "leverage200": "500 USD",
        "leverage100": "1000 USD",
        "baseCurrency": "AUD",
        "pricingCurrency": "CHF",
        "marginType": "Fixed"
    },
    {
        "product": "AUDJPY",
        "name": "Australian Dollar/Japanese Yen",
        "contractSize": 100000,
        "pipValuePerLot": "1000 JPY",
        "leverage400": "250 USD",
        "leverage200": "500 USD",
        "leverage100": "1000 USD",
        "baseCurrency": "AUD",
        "pricingCurrency": "JPY",
        "marginType": "Fixed"
    },
    {
        "product": "AUDNZD",
        "name": "Australian Dollar/New Zealand Dollar",
        "contractSize": 100000,
        "pipValuePerLot": "10 NZD",
        "leverage400": "250 USD",
        "leverage200": "500 USD",
        "leverage100": "1000 USD",
        "baseCurrency": "AUD",
        "pricingCurrency": "NZD",
        "marginType": "Fixed"
    },
    {
        "product": "CADCHF",
        "name": "Canadian Dollar/Swiss Franc",
        "contractSize": 100000,
        "pipValuePerLot": "10 CHF",
        "leverage400": "250 USD",
        "leverage200": "500 USD",
        "leverage100": "1000 USD",
        "baseCurrency": "CAD",
        "pricingCurrency": "CHF",
        "marginType": "Fixed"
    },
    {
        "product": "CADJPY",
        "name": "Canadian Dollar/Japanese Yen",
        "contractSize": 100000,
        "pipValuePerLot": "1000 JPY",
        "leverage400": "250 USD",
        "leverage200": "500 USD",
        "leverage100": "1000 USD",
        "baseCurrency": "CAD",
        "pricingCurrency": "JPY",
        "marginType": "Fixed"
    },
    {
        "product": "CHFJPY",
        "name": "Swiss Franc/Japanese Yen",
        "contractSize": 100000,
        "pipValuePerLot": "1000 JPY",
        "leverage400": "250 USD",
        "leverage200": "500 USD",
        "leverage100": "1000 USD",
        "baseCurrency": "CHF",
        "pricingCurrency": "JPY",
        "marginType": "Fixed"
    },
    {
        "product": "EURAUD",
        "name": "Euro/Australian Dollar",
        "contractSize": 100000,
        "pipValuePerLot": "10 AUD",
        "leverage400": "250 USD",
        "leverage200": "500 USD",
        "leverage100": "1000 USD",
        "baseCurrency": "EUR",
        "pricingCurrency": "AUD",
        "marginType": "Fixed"
    },
    {
        "product": "EURCAD",
        "name": "Euro/Canadian Dollar",
        "contractSize": 100000,
        "pipValuePerLot": "10 CAD",
        "leverage400": "250 USD",
        "leverage200": "500 USD",
        "leverage100": "1000 USD",
        "baseCurrency": "EUR",
        "pricingCurrency": "CAD",
        "marginType": "Fixed"
    },
    {
        "product": "EURCHF",
        "name": "Euro/Swiss Franc",
        "contractSize": 100000,
        "pipValuePerLot": "10 CHF",
        "leverage400": "250 USD",
        "leverage200": "500 USD",
        "leverage100": "1000 USD",
        "baseCurrency": "EUR",
        "pricingCurrency": "CHF",
        "marginType": "Fixed"
    },
    {
        "product": "EURGBP",
        "name": "Euro/Great British Pound",
        "contractSize": 100000,
        "pipValuePerLot": "10 GBP",
        "leverage400": "250 USD",
        "leverage200": "500 USD",
        "leverage100": "1000 USD",
        "baseCurrency": "EUR",
        "pricingCurrency": "GBP",
        "marginType": "Fixed"
    },
    {
        "product": "EURJPY",
        "name": "Euro/Japanese Yen",
        "contractSize": 100000,
        "pipValuePerLot": "1000 JPY",
        "leverage400": "250 USD",
        "leverage200": "500 USD",
        "leverage100": "1000 USD",
        "baseCurrency": "EUR",
        "pricingCurrency": "JPY",
        "marginType": "Fixed"
    },
    {
        "product": "EURNZD",
        "name": "Euro/New Zealand Dollar",
        "contractSize": 100000,
        "pipValuePerLot": "10 NZD",
        "leverage400": "250 USD",
        "leverage200": "500 USD",
        "leverage100": "1000 USD",
        "baseCurrency": "EUR",
        "pricingCurrency": "NZD",
        "marginType": "Fixed"
    },
    {
        "product": "GBPAUD",
        "name": "Great British Pound/Australian Dollar",
        "contractSize": 100000,
        "pipValuePerLot": "10 AUD",
        "leverage400": "250 USD",
        "leverage200": "500 USD",
        "leverage100": "1000 USD",
        "baseCurrency": "GBP",
        "pricingCurrency": "AUD",
        "marginType": "Fixed"
    },
    {
        "product": "GBPCAD",
        "name": "Great British Pound/Canadian Dollar",
        "contractSize": 100000,
        "pipValuePerLot": "10 CAD",
        "leverage400": "250 USD",
        "leverage200": "500 USD",
        "leverage100": "1000 USD",
        "baseCurrency": "GBP",
        "pricingCurrency": "CAD",
        "marginType": "Fixed"
    },
    {
        "product": "GBPCHF",
        "name": "Great British Pound/Swiss Franc",
        "contractSize": 100000,
        "pipValuePerLot": "10 CHF",
        "leverage400": "250 USD",
        "leverage200": "500 USD",
        "leverage100": "1000 USD",
        "baseCurrency": "GBP",
        "pricingCurrency": "CHF",
        "marginType": "Fixed"
    },
    {
        "product": "GBPJPY",
        "name": "Great British Pound/Japanese Yen",
        "contractSize": 100000,
        "pipValuePerLot": "1000 JPY",
        "leverage400": "250 USD",
        "leverage200": "500 USD",
        "leverage100": "1000 USD",
        "baseCurrency": "GBP",
        "pricingCurrency": "JPY",
        "marginType": "Fixed"
    },
    {
        "product": "GBPNZD",
        "name": "Great British Pound/New Zealand Dollar",
        "contractSize": 100000,
        "pipValuePerLot": "10 NZD",
        "leverage400": "250 USD",
        "leverage200": "500 USD",
        "leverage100": "1000 USD",
        "baseCurrency": "GBP",
        "pricingCurrency": "NZD",
        "marginType": "Fixed"
    },
    {
        "product": "NZDCAD",
        "name": "New Zealand Dollar/Canadian Dollar",
        "contractSize": 100000,
        "pipValuePerLot": "10 CAD",
        "leverage400": "250 USD",
        "leverage200": "500 USD",
        "leverage100": "1000 USD",
        "baseCurrency": "NZD",
        "pricingCurrency": "CAD",
        "marginType": "Fixed"
    },
    {
        "product": "NZDCHF",
        "name": "New Zealand Dollar/Swiss Franc",
        "contractSize": 100000,
        "pipValuePerLot": "10 CHF",
        "leverage400": "250 USD",
        "leverage200": "500 USD",
        "leverage100": "1000 USD",
        "baseCurrency": "NZD",
        "pricingCurrency": "CHF",
        "marginType": "Fixed"
    },
    {
        "product": "NZDJPY",
        "name": "New Zealand Dollar/Japanese Yen",
        "contractSize": 100000,
        "pipValuePerLot": "1000 JPY",
        "leverage400": "250 USD",
        "leverage200": "500 USD",
        "leverage100": "1000 USD",
        "baseCurrency": "NZD",
        "pricingCurrency": "JPY",
        "marginType": "Fixed"
    },
    {
        "product": "EURHUF",
        "name": "Euro/Hungarian Forint",
        "contractSize": 100000,
        "pipValuePerLot": "1000 HUF",
        "leverage400": "2000 EUR",
        "leverage200": "2000 EUR",
        "leverage100": "4000 EUR",
        "baseCurrency": "EUR",
        "pricingCurrency": "HUF",
        "marginType": "Fixed"
    },
    {
        "product": "EURPLN",
        "name": "Euro/Polish Zloty",
        "contractSize": 100000,
        "pipValuePerLot": "10 PLN",
        "leverage400": "2000 EUR",
        "leverage200": "2000 EUR",
        "leverage100": "4000 EUR",
        "baseCurrency": "EUR",
        "pricingCurrency": "PLN",
        "marginType": "Fixed"
    },
    {
        "product": "USDCNH",
        "name": "US Dollar/Chinese Offshore Yuan",
        "contractSize": 100000,
        "pipValuePerLot": "10 CNH",
        "leverage400": "2000 USD",
        "leverage200": "2000 USD",
        "leverage100": "4000 USD",
        "baseCurrency": "USD",
        "pricingCurrency": "CNH",
        "marginType": "Fixed"
    },
    {
        "product": "USDHKD",
        "name": "US Dollar/Hong Kong Dollar",
        "contractSize": 100000,
        "pipValuePerLot": "10 HKD",
        "leverage400": "2000 USD",
        "leverage200": "2000 USD",
        "leverage100": "4000 USD",
        "baseCurrency": "USD",
        "pricingCurrency": "HKD",
        "marginType": "Fixed"
    },
    {
        "product": "USDSGD",
        "name": "US Dollar/Singapore Dollar",
        "contractSize": 100000,
        "pipValuePerLot": "10 SGD",
        "leverage400": "2000 USD",
        "leverage200": "2000 USD",
        "leverage100": "4000 USD",
        "baseCurrency": "USD",
        "pricingCurrency": "SGD",
        "marginType": "Fixed"
    },
    {
        "product": "USDCZK",
        "name": "US Dollar/Czech Koruna",
        "contractSize": 100000,
        "pipValuePerLot": "1000 CZK",
        "leverage400": "2000 USD",
        "leverage200": "2000 USD",
        "leverage100": "4000 USD",
        "baseCurrency": "USD",
        "pricingCurrency": "CZK",
        "marginType": "Fixed"
    },
    {
        "product": "USDDKK",
        "name": "US Dollar/Danish Krone",
        "contractSize": 100000,
        "pipValuePerLot": "10 DKK",
        "leverage400": "2000 USD",
        "leverage200": "2000 USD",
        "leverage100": "4000 USD",
        "baseCurrency": "USD",
        "pricingCurrency": "DKK",
        "marginType": "Fixed"
    },
    {
        "product": "USDHUF",
        "name": "US Dollar/Hungarian Forint",
        "contractSize": 100000,
        "pipValuePerLot": "1000 HUF",
        "leverage400": "2000 USD",
        "leverage200": "2000 USD",
        "leverage100": "4000 USD",
        "baseCurrency": "USD",
        "pricingCurrency": "HUF",
        "marginType": "Fixed"
    },
    {
        "product": "USDMXN",
        "name": "US Dollar/Mexican Peso",
        "contractSize": 100000,
        "pipValuePerLot": "10 MXN",
        "leverage400": "2000 USD",
        "leverage200": "2000 USD",
        "leverage100": "4000 USD",
        "baseCurrency": "USD",
        "pricingCurrency": "MXN",
        "marginType": "Fixed"
    },
    {
        "product": "USDNOK",
        "name": "US Dollar/Norwegian Krone",
        "contractSize": 100000,
        "pipValuePerLot": "10 NOK",
        "leverage400": "2000 USD",
        "leverage200": "2000 USD",
        "leverage100": "4000 USD",
        "baseCurrency": "USD",
        "pricingCurrency": "NOK",
        "marginType": "Fixed"
    },
    {
        "product": "USDPLN",
        "name": "US Dollar/Polish Zloty",
        "contractSize": 100000,
        "pipValuePerLot": "10 PLN",
        "leverage400": "2000 USD",
        "leverage200": "2000 USD",
        "leverage100": "4000 USD",
        "baseCurrency": "USD",
        "pricingCurrency": "PLN",
        "marginType": "Fixed"
    },
    {
        "product": "USDSEK",
        "name": "US Dollar/Swedish Krone",
        "contractSize": 100000,
        "pipValuePerLot": "10 SEK",
        "leverage400": "2000 USD",
        "leverage200": "2000 USD",
        "leverage100": "4000 USD",
        "baseCurrency": "USD",
        "pricingCurrency": "SEK",
        "marginType": "Fixed"
    },
    {
        "product": "USDZAR",
        "name": "US Dollar/South Africa Rand",
        "contractSize": 100000,
        "pipValuePerLot": "10 ZAR",
        "leverage400": "2000 USD",
        "leverage200": "2000 USD",
        "leverage100": "4000 USD",
        "baseCurrency": "USD",
        "pricingCurrency": "ZAR",
        "marginType": "Fixed"
    },
    {
        "product": "XAUUSD",
        "name": "Spot Gold/US Dollar",
        "contractSize": 100,
        "pipValuePerLot": "10 USD",
        "leverage400": "250 USD",
        "leverage200": "500 USD",
        "leverage100": "1000 USD",
        "baseCurrency": "",
        "pricingCurrency": "USD",
        "marginType": "Fixed"
    },
    {
        "product": "XAUEUR",
        "name": "Spot Gold/Euro",
        "contractSize": 100,
        "pipValuePerLot": "10 EUR",
        "leverage400": "250 EUR",
        "leverage200": "500 EUR",
        "leverage100": "1000 EUR",
        "baseCurrency": "",
        "pricingCurrency": "EUR",
        "marginType": "Fixed"
    },
    {
        "product": "XAGUSD",
        "name": "Spot Silver/US Dollar",
        "contractSize": 5000,
        "pipValuePerLot": "50 USD",
        "leverage400": "1500 USD",
        "leverage200": "1500 USD",
        "leverage100": "3000 USD",
        "baseCurrency": "",
        "pricingCurrency": "USD",
        "marginType": "Fixed"
    },
    {
        "product": "GOLD_MMMYY",
        "name": "Gold Futures (CFD)",
        "contractSize": 100,
        "pipValuePerLot": "10 USD",
        "leverage400": "8000 USD",
        "leverage200": "8000 USD",
        "leverage100": "8000 USD",
        "baseCurrency": "",
        "pricingCurrency": "USD",
        "marginType": "Fixed"
    },
    {
        "product": "HG_MMMYY",
        "name": "High Grade Copper Futures (CFD)",
        "contractSize": 25000,
        "pipValuePerLot": "25 USD",
        "leverage400": "1:50",
        "leverage200": "1:50",
        "leverage100": "1:50",
        "baseCurrency": "",
        "pricingCurrency": "USD",
        "marginType": "Floating"
    },
    {
        "product": "USOIL.MMMYY",
        "name": "US WTI Crude Oil Futures Contract (CFD)",
        "contractSize": 1000,
        "pipValuePerLot": "10 USD",
        "leverage400": "500 USD",
        "leverage200": "500 USD",
        "leverage100": "500 USD",
        "baseCurrency": "",
        "pricingCurrency": "USD",
        "marginType": "Fixed"
    },
    {
        "product": "UKOIL.MMMYY",
        "name": "UK BRENT Crude Oil Futures Contract (CFD)",
        "contractSize": 1000,
        "pipValuePerLot": "10 USD",
        "leverage400": "500 USD",
        "leverage200": "500 USD",
        "leverage100": "500 USD",
        "baseCurrency": "",
        "pricingCurrency": "USD",
        "marginType": "Fixed"
    },
    {
        "product": "NGAS.MMMYY",
        "name": "US Natural Gas Futures Contract (CFD)",
        "contractSize": 10000,
        "pipValuePerLot": "10 USD",
        "leverage400": "1:50",
        "leverage200": "1:50",
        "leverage100": "1:50",
        "baseCurrency": "",
        "pricingCurrency": "USD",
        "marginType": "Floating"
    },
    {
        "product": "WTI",
        "name": "US WTI Crude Oil Spot Contract",
        "contractSize": 1000,
        "pipValuePerLot": "10 USD",
        "leverage400": "500 USD",
        "leverage200": "500 USD",
        "leverage100": "500 USD",
        "baseCurrency": "",
        "pricingCurrency": "USD",
        "marginType": "Fixed"
    },
    {
        "product": "BRENT",
        "name": "UK BRENT Crude Oil Spot Contract",
        "contractSize": 1000,
        "pipValuePerLot": "10 USD",
        "leverage400": "500 USD",
        "leverage200": "500 USD",
        "leverage100": "500 USD",
        "baseCurrency": "",
        "pricingCurrency": "USD",
        "marginType": "Fixed"
    },
    {
        "product": "CHI50",
        "name": "FTSE China A50 Spot Index (CFD)",
        "contractSize": 10,
        "pipValuePerLot": "10 USD",
        "leverage400": "1:100",
        "leverage200": "1:100",
        "leverage100": "1:100",
        "baseCurrency": "",
        "pricingCurrency": "USD",
        "marginType": "Floating"
    },
    {
        "product": "HK50",
        "name": "Hong Kong HS50 Spot Index (CFD)",
        "contractSize": 50,
        "pipValuePerLot": "50 HKD",
        "leverage400": "1:100",
        "leverage200": "1:100",
        "leverage100": "1:100",
        "baseCurrency": "",
        "pricingCurrency": "HKD",
        "marginType": "Floating"
    },
    {
        "product": "HKCH50",
        "name": "Hong Kong China H-Shares Spot Index (CFD)",
        "contractSize": 50,
        "pipValuePerLot": "50 HKD",
        "leverage400": "1:100",
        "leverage200": "1:100",
        "leverage100": "1:100",
        "baseCurrency": "",
        "pricingCurrency": "HKD",
        "marginType": "Floating"
    },
    {
        "product": "AUS200",
        "name": "Australian S&P/ASX 200 Spot Index (CFD)",
        "contractSize": 20,
        "pipValuePerLot": "20 AUD",
        "leverage400": "1:100",
        "leverage200": "1:100",
        "leverage100": "1:100",
        "baseCurrency": "",
        "pricingCurrency": "AUD",
        "marginType": "Floating"
    },
    {
        "product": "EU50",
        "name": "Euro Stoxx 50 Spot Index (CFD)",
        "contractSize": 30,
        "pipValuePerLot": "30 EUR",
        "leverage400": "1:100",
        "leverage200": "1:100",
        "leverage100": "1:100",
        "baseCurrency": "",
        "pricingCurrency": "EUR",
        "marginType": "Floating"
    },
    {
        "product": "ESP35",
        "name": "Spain IBEX 35 Spot Index (CFD)",
        "contractSize": 10,
        "pipValuePerLot": "10 EUR",
        "leverage400": "1:100",
        "leverage200": "1:100",
        "leverage100": "1:100",
        "baseCurrency": "",
        "pricingCurrency": "EUR",
        "marginType": "Floating"
    },
    {
        "product": "FRA40",
        "name": "French CAC 40 Spot Index (CFD)",
        "contractSize": 20,
        "pipValuePerLot": "10 EUR",
        "leverage400": "1:100",
        "leverage200": "1:100",
        "leverage100": "1:100",
        "baseCurrency": "",
        "pricingCurrency": "EUR",
        "marginType": "Floating"
    },
    {
        "product": "GER30",
        "name": "German 30 Spot Index (CFD)",
        "contractSize": 10,
        "pipValuePerLot": "10 EUR",
        "leverage400": "1:100",
        "leverage200": "1:100",
        "leverage100": "1:100",
        "baseCurrency": "",
        "pricingCurrency": "EUR",
        "marginType": "Floating"
    },
    {
        "product": "IT40",
        "name": "Italy MIB 40 Spot Index (CFD)",
        "contractSize": 10,
        "pipValuePerLot": "10 EUR",
        "leverage400": "1:100",
        "leverage200": "1:100",
        "leverage100": "1:100",
        "baseCurrency": "",
        "pricingCurrency": "EUR",
        "marginType": "Floating"
    },
    {
        "product": "JP225",
        "name": "Japan Nikkei 225 Spot Index (CFD)",
        "contractSize": 10,
        "pipValuePerLot": "10 USD",
        "leverage400": "1:100",
        "leverage200": "1:100",
        "leverage100": "1:100",
        "baseCurrency": "",
        "pricingCurrency": "USD",
        "marginType": "Floating"
    },
    {
        "product": "UK100",
        "name": "UK FTSE 100 Spot Index (CFD)",
        "contractSize": 10,
        "pipValuePerLot": "10 GBP",
        "leverage400": "1:100",
        "leverage200": "1:100",
        "leverage100": "1:100",
        "baseCurrency": "",
        "pricingCurrency": "GBP",
        "marginType": "Floating"
    },
    {
        "product": "US30",
        "name": "US Dow Jones 30 Spot Index (CFD)",
        "contractSize": 10,
        "pipValuePerLot": "10 USD",
        "leverage400": "1:100",
        "leverage200": "1:100",
        "leverage100": "1:100",
        "baseCurrency": "",
        "pricingCurrency": "USD",
        "marginType": "Floating"
    },
    {
        "product": "NAS100",
        "name": "US NASDAQ 100 Spot Index (CFD)",
        "contractSize": 20,
        "pipValuePerLot": "10 USD",
        "leverage400": "1:100",
        "leverage200": "1:100",
        "leverage100": "1:100",
        "baseCurrency": "",
        "pricingCurrency": "USD",
        "marginType": "Floating"
    },
    {
        "product": "SPX500",
        "name": "US S&P 500 Spot Index (CFD)",
        "contractSize": 50,
        "pipValuePerLot": "10 USD",
        "leverage400": "1:100",
        "leverage200": "1:100",
        "leverage100": "1:100",
        "baseCurrency": "",
        "pricingCurrency": "USD",
        "marginType": "Floating"
    },
    {
        "product": "US2000",
        "name": "US Russell 2000 Spot Index (CFD)",
        "contractSize": 50,
        "pipValuePerLot": "10 USD",
        "leverage400": "1:100",
        "leverage200": "1:100",
        "leverage100": "1:100",
        "baseCurrency": "",
        "pricingCurrency": "USD",
        "marginType": "Floating"
    },
    {
        "product": "USDX_MMMYY",
        "name": "US Dollar Futures Index (CFD)",
        "contractSize": 1000,
        "pipValuePerLot": "10 USD",
        "leverage400": "1:100",
        "leverage200": "1:100",
        "leverage100": "1:100",
        "baseCurrency": "",
        "pricingCurrency": "USD",
        "marginType": "Floating"
    }
];</script></head><body class="min-h-screen bg-custom"><div class="container mx-auto px-4 py-8 max-w-6xl"><!-- 页面标题 --><div class="text-center mb-8"><h1 class="text-4xl font-bold text-gray-800 mb-2"><i class="fas fa-calculator text-blue-600 mr-3"></i>PnL Calculator</h1><p class="text-gray-600 text-lg">Calculate Profits, Losses and Margin Precisely</p></div><!-- 主要内容区域 --><div class="bg-white rounded-2xl shadow-xl overflow-hidden"><!-- 表单区域 --><div class="p-8"><form class="space-y-6" id="pnlForm"><!-- 计算选项 --><div class="grid grid-cols-1 md:grid-cols-2 gap-6"><!-- 多订单选项 --><div class="flex items-center"><input class="w-5 h-5 text-blue-600 focus:ring-blue-500 border-gray-300 rounded" id="multipleOrders" type="checkbox"/><label class="ml-2 text-gray-700 font-medium" for="multipleOrders">Calculate Multiple Orders</label></div><!-- 仓位计算选项 --><div class="flex items-center"><input class="w-5 h-5 text-blue-600 focus:ring-blue-500 border-gray-300 rounded" id="positionCalculation" type="checkbox"/><label class="ml-2 text-gray-700 font-medium" for="positionCalculation">Include Position Calculations</label></div></div><!-- 余额输入框 (默认隐藏) --><div class="hidden" id="balanceContainer"><label class="block text-gray-700 font-semibold mb-2" for="balance"><i class="fas fa-wallet text-green-600 mr-2"></i>Account Balance (USD)</label><input class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" id="balance" min="0" placeholder="0.00" step="0.01" type="number"/></div><div class="hidden" id="globalCommissionContainer"><label class="block text-gray-700 font-semibold mb-2" for="globalCommissionRate"><i class="fas fa-receipt text-blue-600 mr-2"></i>Commission per lot</label><input class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" id="globalCommissionRate" placeholder="e.g., 7" step="any" type="number"/><p class="text-gray-500 text-sm mt-1">Commission per order = Lots × Commission per lot</p></div><!-- 订单管理按钮 (默认隐藏) --><div class="hidden" id="orderManagement"><div class="flex justify-between items-center"><h3 class="text-lg font-semibold text-gray-800"><i class="fas fa-list-alt text-blue-600 mr-2"></i>Order List</h3><button class="bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-lg transition-all" id="addOrderBtn" type="button"><i class="fas fa-plus mr-1"></i>Add Order</button></div></div><!-- 订单容器 --><div id="ordersContainer"><!-- 默认订单表单 --><div class="order-form bg-gray-50 p-6 rounded-xl mb-6" data-order-id="1"><div class="flex justify-between items-center mb-4"><h4 class="font-semibold text-gray-800">Order #1</h4><button class="remove-order-btn text-red-500 hover:text-red-700 transition-colors hidden" data-order-id="1" type="button"><i class="fas fa-trash"></i>Remove</button></div><!-- 产品搜索和选择 --><div class="relative mb-6"><label class="block text-gray-700 font-semibold mb-2" for="productSearch_1"><i class="fas fa-search text-blue-600 mr-2"></i>Product Search</label><div class="relative"><input class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" id="productSearch_1" placeholder="Search by product code or name..." type="text"/><div class="absolute w-full bg-white rounded-lg shadow-lg mt-1 z-10 max-h-60 overflow-y-auto hidden" id="searchResults_1"><!-- 搜索结果将动态显示在这里 --></div></div><div class="mt-2 p-3 bg-blue-50 rounded-lg hidden" id="selectedProduct_1"><div class="flex justify-between items-center"><div><span class="font-bold text-blue-800" id="productCode_1"></span><span class="text-gray-600 ml-2" id="productName_1"></span></div><button class="clear-product-btn text-red-500 hover:text-red-700" data-order-id="1" type="button"><i class="fas fa-times"></i></button></div></div></div><!-- 产品信息显示 --><div class="grid grid-cols-1 md:grid-cols-3 gap-4 p-4 bg-white rounded-lg hidden mb-6" id="productInfo_1"><div><p class="text-sm text-gray-600">Contract Size</p><p class="font-semibold" id="contractSize_1"></p></div><div><p class="text-sm text-gray-600">Pip Value per Lot</p><p class="font-semibold" id="pipValue_1"></p></div><div><p class="text-sm text-gray-600">Pricing Currency</p><p class="font-semibold" id="pricingCurrency_1"></p></div><div><p class="text-sm text-gray-600">Base Currency</p><p class="font-semibold" id="baseCurrency_1"></p></div><div><p class="text-sm text-gray-600">Margin Type</p><p class="font-semibold capitalize" id="marginType_1"></p></div><div><p class="text-sm text-gray-600">Margin per Lot (for selected leverage)</p><p class="font-semibold" id="perLotMargin_1"></p></div></div><!-- 交易详情 --><div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"><div><label class="block text-gray-700 font-semibold mb-2" for="tradeType_1"><i class="fas fa-exchange-alt text-green-600 mr-2"></i>Trade Type</label><select class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" disabled="" id="tradeType_1"><option value="buy">Buy</option><option value="sell">Sell</option></select></div><div><label class="block text-gray-700 font-semibold mb-2" for="leverage_1"><i class="fas fa-percentage text-purple-600 mr-2"></i>Select Leverage</label><select class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all leverage-select" disabled="" id="leverage_1"><option value="400">1:400</option><option value="200">1:200</option><option value="100">1:100</option></select></div></div><div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6"><div><label class="block text-gray-700 font-semibold mb-2" for="lots_1"><i class="fas fa-layer-group text-orange-600 mr-2"></i>Lots</label><input class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" disabled="" id="lots_1" min="0.01" placeholder="0.01" step="0.01" type="number"/></div><div><label class="block text-gray-700 font-semibold mb-2" for="openPrice_1"><i class="fas fa-arrow-up text-green-600 mr-2"></i>Open Price</label><input class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" disabled="" id="openPrice_1" min="0" placeholder="0.00000" step="0.00001" type="number"/></div><div><label class="block text-gray-700 font-semibold mb-2" for="closePrice_1"><i class="fas fa-arrow-down text-red-600 mr-2"></i>Close Price</label><input class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" disabled="" id="closePrice_1" min="0" placeholder="0.00000" step="0.00001" type="number"/></div></div><!-- 汇率输入 --><div class="mb-4 hidden" id="exchangeRateContainer_1"><label class="block text-gray-700 font-semibold mb-2" for="exchangeRate_1"><i class="fas fa-money-bill-wave text-teal-600 mr-2"></i>Exchange Rate Required</label><input class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" id="exchangeRate_1" min="0.00001" placeholder="Enter exchange rate" step="0.00001" type="number"/><p class="text-xs text-amber-600 mt-1 font-medium" id="exchangeRateHint_1">Please enter the exchange rate</p></div><!-- EURUSD汇率输入 (仅特定产品显示) --><div class="hidden" id="eurusdRateContainer_1"><label class="block text-gray-700 font-semibold mb-2" for="eurusdRate_1"><i class="fas fa-money-bill-wave text-purple-600 mr-2"></i>EURUSD Exchange Rate Required</label><input class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all" id="eurusdRate_1" min="0.00001" placeholder="Enter EURUSD rate" step="0.00001" type="number"/><p class="text-xs text-amber-600 mt-1 font-medium">Please enter the EURUSD exchange rate for margin conversion to USD</p></div></div></div><!-- 计算按钮 --><div class="text-center"><button class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg transition-all transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed" disabled="" id="calculateBtn" type="button"><i class="fas fa-calculator mr-2"></i>Calculate PnL &amp; Margin</button></div></form></div><!-- 结果显示区域 --><div class="bg-gradient-to-r from-blue-600 to-indigo-700 text-white p-8 hidden" id="resultsSection"><h2 class="text-2xl font-bold mb-6 text-center"><i class="fas fa-chart-line mr-2"></i>Calculation Results</h2><!-- 汇率提示 --><div class="bg-yellow-500 bg-opacity-20 rounded-xl p-4 backdrop-blur-sm mb-6 hidden" id="exchangeRateNote"><p class="text-sm flex items-center"><i class="fas fa-info-circle mr-2"></i>Please be advised that due to exchange rate fluctuations, the final amount may differ slightly from the actual order total.</p></div><!-- 对冲仓位提示 --><div class="bg-yellow-500 bg-opacity-20 rounded-xl p-4 backdrop-blur-sm mb-6 hidden" id="hedgeNotice"><h3 class="text-lg font-semibold flex items-center"><i class="fas fa-info-circle mr-2"></i>Hedge Position Detected</h3><p class="text-sm mt-2" id="hedgeDetails"></p></div><!-- 多订单汇总结果 --><div class="bg-white bg-opacity-10 rounded-xl p-6 backdrop-blur-sm mb-8 hidden" id="summaryResults"><h3 class="text-lg font-semibold mb-4"><i class="fas fa-calculator-alt mr-2"></i>Total Summary</h3><div class="grid grid-cols-1 md:grid-cols-3 gap-6"><!-- Total PnL (excl. commission) --><div><div class="text-sm opacity-80">Total PnL (excl. commission)</div><div class="text-3xl font-bold" id="totalPnLNoCommissionInUSD"></div></div><!-- Total PnL (incl. commission) --><div><div class="text-sm opacity-80">Total PnL (incl. commission)</div><div class="text-3xl font-bold" id="totalPnLWithCommissionInUSD"></div></div><!-- Total Margin in USD --><div><p class="text-sm opacity-80">Total Margin in USD</p><p class="text-3xl font-bold" id="totalMarginInUSD"></p></div></div></div><!-- 单个订单结果 --><div class="space-y-6" id="individualResults"><!-- 单个结果将动态插入到这里 --></div><!-- 仓位计算结果 (默认隐藏) --><div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-8 hidden" id="positionResults"><div class="bg-white bg-opacity-10 rounded-xl p-6 backdrop-blur-sm"><h3 class="text-lg font-semibold mb-4"><i class="fas fa-money-check-alt mr-2"></i>Equity</h3><div class="text-3xl font-bold" id="equity"></div><div class="text-sm opacity-80 mt-1">Balance + Total PnL</div></div><div class="bg-white bg-opacity-10 rounded-xl p-6 backdrop-blur-sm"><h3 class="text-lg font-semibold mb-4"><i class="fas fa-wallet mr-2"></i>Free Margin</h3><div class="text-3xl font-bold" id="freeMargin"></div><div class="text-sm opacity-80 mt-1">Equity - Total Margin</div></div><div class="bg-white bg-opacity-10 rounded-xl p-6 backdrop-blur-sm"><h3 class="text-lg font-semibold mb-4"><i class="fas fa-percent mr-2"></i>Margin Ratio</h3><div class="text-3xl font-bold" id="marginRatio"></div><div class="text-sm opacity-80 mt-1">Equity / Total Margin × 100%</div></div></div><!-- 详细计算过程 --><div class="mt-8 bg-white bg-opacity-10 rounded-xl p-6 backdrop-blur-sm"><h3 class="text-lg font-semibold mb-4"><i class="fas fa-calculator mr-2"></i>Calculation Details</h3><div class="space-y-4 text-sm" id="calculationDetails"><!-- 计算过程将动态显示在这里 --></div></div></div></div><!-- 最近计算历史 --><div class="mt-8 bg-white rounded-2xl shadow-xl overflow-hidden"><div class="p-6 border-b border-gray-200"><h2 class="text-xl font-bold text-gray-800"><i class="fas fa-history text-blue-600 mr-2"></i>Recent Calculations</h2></div><div class="p-6 max-h-60 overflow-y-auto" id="historyList"><p class="text-gray-500 text-center italic" id="noHistory">No calculation history yet</p><!-- 历史记录将动态显示在这里 --></div></div><!-- 页脚 --><div class="mt-8 text-center text-gray-600 py-4"><p>This page is developed by ATFX HKCS Team</p></div></div><script>// 全局变量
        let calculationHistory = [];
        let orderCount = 1;
        let currentLeverage = "400"; // 默认杠杆
        
        // 需要EURUSD汇率的产品列表
        const productsNeedingEurusd = ['EURHUF', 'EURPLN', 'XAUEUR'];
            // Futures Products (hedged portion margin = 50%)
            const futuresProducts = ['GOLD_MMMYY','HG_MMMYY','USOIL.MMMYY','UKOIL.MMMYY','NGAS.MMMYY','USDX_MMMYY'];
            // Products whose hedged portion keeps 50% margin
            const fiftyPercentHedgeProducts = ['GOLD_MMMYY','HG_MMMYY','USOIL.MMMYY','UKOIL.MMMYY','NGAS.MMMYY','USDX_MMMYY'];
        
        // 页面加载后初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 绑定事件监听器
            document.getElementById('addOrderBtn').addEventListener('click', addNewOrder);
            document.getElementById('calculateBtn').addEventListener('click', calculateAllOrders);
            document.getElementById('positionCalculation').addEventListener('change', togglePositionCalculation);
            document.getElementById('multipleOrders').addEventListener('change', toggleMultipleOrders);
            
            // 初始化杠杆同步
            document.addEventListener('change', function(e) {
                if (e.target.classList.contains('leverage-select') && !e.target.disabled) {
                    syncLeverageAcrossOrders(e.target.value);
                }
            });
            
            // 初始化第一个订单
            initOrderEvents(1);
            
            // 为删除按钮添加事件委托
            document.getElementById('ordersContainer').addEventListener('click', function(e) {
                if (e.target.closest('.remove-order-btn')) {
                    const btn = e.target.closest('.remove-order-btn');
                    const orderId = parseInt(btn.getAttribute('data-order-id'));
                    removeOrder(orderId);
                }
            });
            
            // 添加输入事件监听器以更新计算按钮状态
            document.addEventListener('input', updateCalculateButtonState);
            document.addEventListener('change', updateCalculateButtonState);
        });
        
        // 在所有订单间同步杠杆
        function syncLeverageAcrossOrders(leverageValue) {
            currentLeverage = leverageValue;
            
            // 更新所有杠杆下拉框
            const leverageSelects = document.querySelectorAll('.leverage-select');
            leverageSelects.forEach(select =>{
                // 如果选择框已设置为此值或禁用，则跳过
                if (select.value !== leverageValue && !select.disabled) {
                    select.value = leverageValue;
                    
                    // 更新此订单的每手保证金显示
                    const orderId = select.id.split('_')[1];
                    updatePerLotMargin(orderId);
                }
            });
        }
        
        // 切换多订单功能
        function toggleMultipleOrders() {
            const multipleOrdersEnabled = this.checked;
            const orderManagement = document.getElementById('orderManagement');
            const removeButtons = document.querySelectorAll('.remove-order-btn');
            
            if (multipleOrdersEnabled) {
                orderManagement.classList.remove('hidden');
                // 显示所有订单的删除按钮，除非只有一个订单
                if (removeButtons.length >1) {
                    removeButtons.forEach(btn =>btn.classList.remove('hidden'));
                } else if (removeButtons.length === 1) {
                    removeButtons[0].classList.add('hidden');
                }
            } else {
                orderManagement.classList.add('hidden');
                // 隐藏所有删除按钮
                removeButtons.forEach(btn =>btn.classList.add('hidden'));
                
                // 移除额外订单，只保留第一个
                const orderForms = document.querySelectorAll('.order-form');
                if (orderForms.length >1) {
                    for (let i = orderForms.length - 1; i >0; i--) {
                        orderForms[i].remove();
                    }
                    orderCount = 1;
                }
            }
            
            updateCalculateButtonState();
        }
        
        // 切换仓位计算部分
        function togglePositionCalculation() {
            const balanceContainer = document.getElementById('balanceContainer');
            if (this.checked) {
                balanceContainer.classList.remove('hidden');
            } else {
                balanceContainer.classList.add('hidden');
            }
            const globalCommission = document.getElementById('globalCommissionContainer');
            if (globalCommission) { if (this.checked) globalCommission.classList.remove('hidden'); else globalCommission.classList.add('hidden'); }
            updateCalculateButtonState();
        }
        
        // 添加新订单表单
	function addNewOrder() {
    	// Keep numbering contiguous after deletions: next order is (current forms count + 1)
    	orderCount = document.querySelectorAll('.order-form').length + 1;
    	const ordersContainer = document.getElementById('ordersContainer');

            
            // 克隆第一个订单表单
            const firstOrder = document.querySelector('.order-form');
            const newOrder = firstOrder.cloneNode(true);
            
            // 更新新订单的ID和属性
            newOrder.setAttribute('data-order-id', orderCount);
            newOrder.querySelector('h4').textContent = `Order #${orderCount}`;
            newOrder.querySelector('.remove-order-btn').setAttribute('data-order-id', orderCount);
            
            // 如果启用了多订单，显示删除按钮
            if (document.getElementById('multipleOrders').checked) {
                newOrder.querySelector('.remove-order-btn').classList.remove('hidden');
            }
            
            // 更新新订单中所有元素的ID
            const elements = newOrder.querySelectorAll('[id]');
            elements.forEach(element =>{
                const id = element.getAttribute('id');
                if (id) {
                    const newId = id.replace(/_\d+$/, `_${orderCount}`);
                    element.setAttribute('id', newId);
                }
            });
            
            // 更新label的for属性
            const labels = newOrder.querySelectorAll('label[for]');
            labels.forEach(label =>{
                const forAttr = label.getAttribute('for');
                if (forAttr) {
                    const newFor = forAttr.replace(/_\d+$/, `_${orderCount}`);
                    label.setAttribute('for', newFor);
                }
            });
            
            // 设置杠杆以匹配当前选择
            const leverageSelect = newOrder.querySelector('.leverage-select');
            leverageSelect.value = currentLeverage;
            
            // 重置表单值
            newOrder.querySelector(`[id^="selectedProduct_"]`).classList.add('hidden');
            newOrder.querySelector(`[id^="productInfo_"]`).classList.add('hidden');
            newOrder.querySelector(`[id^="exchangeRateContainer_"]`).classList.add('hidden');
            newOrder.querySelector(`[id^="eurusdRateContainer_"]`).classList.add('hidden');
            
            // 将新订单添加到容器
            ordersContainer.appendChild(newOrder);
            
            // 初始化新订单的事件
            initOrderEvents(orderCount);
            
            // 重置新订单的表单字段
            resetOrderForm(orderCount);
            
            updateCalculateButtonState();
        }
        
        // 初始化订单表单的事件
        function initOrderEvents(orderId) {
    // limit queries within the current order form and add null-safety
    const orderRoot = document.querySelector(`.order-form[data-order-id="${orderId}"]`);
    if (!orderRoot) return;

    // product search input
    const searchInput = orderRoot.querySelector(`#productSearch_${orderId}`);
    if (!searchInput) return;
    const newSearchInput = searchInput.cloneNode(true);
    searchInput.parentNode.replaceChild(newSearchInput, searchInput);
    newSearchInput.addEventListener('input', function() {
        handleProductSearch(orderId, this.value);
    });

    // clear selected product
    const clearBtn = orderRoot.querySelector(`.clear-product-btn[data-order-id="${orderId}"]`);
    if (clearBtn) {
        const newClearBtn = clearBtn.cloneNode(true);
        clearBtn.parentNode.replaceChild(newClearBtn, clearBtn);
        newClearBtn.addEventListener('click', function() {
            clearSelectedProduct(orderId);
            updateCalculateButtonState();
        });
    }

    // click outside to hide search results (scoped)
    document.addEventListener('click', function(e) {
        const searchBox = orderRoot.querySelector(`#productSearch_${orderId}`);
        const container = searchBox ? searchBox.closest('.relative') : null;
        if (container && !container.contains(e.target)) {
            const list = document.getElementById(`searchResults_${orderId}`);
            if (list) list.classList.add('hidden');
        }
    });
}

        
        // 移除订单
        function removeOrder(orderId) {
            const orderForm = document.querySelector(`.order-form[data-order-id="${orderId}"]`);
            if (orderForm) {
                orderForm.remove();
                
                // 如果启用了多订单，更新订单编号
                if (document.getElementById('multipleOrders').checked) {
                    const remainingOrders = Array.from(document.querySelectorAll('.order-form'));
                    remainingOrders.forEach((order, index) =>{
                        const newOrderId = index + 1;
                        const oldOrderId = order.getAttribute('data-order-id');
                        
                        // 如果已具有正确ID，则跳过
                        if (parseInt(oldOrderId) === newOrderId) return;
                        
                        // 更新数据属性
                        order.setAttribute('data-order-id', newOrderId);
                        
                        // 更新标题
                        order.querySelector('h4').textContent = `Order #${newOrderId}`;
                        
                        // 更新删除按钮
                        const removeBtn = order.querySelector('.remove-order-btn');
                        if (removeBtn) {
                            removeBtn.setAttribute('data-order-id', newOrderId);
                        }
                        
                        // 更新订单中所有元素的ID
                        const elements = order.querySelectorAll('[id]');
                        elements.forEach(element =>{
                            const id = element.getAttribute('id');
                            if (id) {
                                const newId = id.replace(`_${oldOrderId}`, `_${newOrderId}`);
                                element.setAttribute('id', newId);
                            }
                        });
                        
                        // 更新label的for属性
                        const labels = order.querySelectorAll('label[for]');
                        labels.forEach(label =>{
                            const forAttr = label.getAttribute('for');
                            if (forAttr) {
                                const newFor = forAttr.replace(`_${oldOrderId}`, `_${newOrderId}`);
                                label.setAttribute('for', newFor);
                            }
                        });
                        
                        // 使用新ID重新初始化此订单的事件
                        initOrderEvents(newOrderId);
                    });
                    
                    orderCount = remainingOrders.length;
                    
                    // 如果只剩下一个订单，隐藏删除按钮
                    if (remainingOrders.length === 1) {
                        remainingOrders[0].querySelector('.remove-order-btn').classList.add('hidden');
                    }
                }
                
                updateCalculateButtonState();
            }
        }
        
        // 重置订单表单
        function resetOrderForm(orderId) {
            document.getElementById(`productSearch_${orderId}`).value = '';
            document.getElementById(`tradeType_${orderId}`).disabled = true;
            document.getElementById(`leverage_${orderId}`).disabled = true;
            document.getElementById(`lots_${orderId}`).disabled = true;
            document.getElementById(`openPrice_${orderId}`).disabled = true;
            document.getElementById(`closePrice_${orderId}`).disabled = true;
            document.getElementById(`lots_${orderId}`).value = '';
            document.getElementById(`openPrice_${orderId}`).value = '';
            document.getElementById(`closePrice_${orderId}`).value = '';
            document.getElementById(`exchangeRate_${orderId}`).value = '';
            document.getElementById(`eurusdRate_${orderId}`).value = '';
        }
        
        // 处理特定订单的产品搜索
        function handleProductSearch(orderId, searchTerm) {
            const resultsContainer = document.getElementById(`searchResults_${orderId}`);
            resultsContainer.innerHTML = '';
            
            if (searchTerm.length< 1) {
                resultsContainer.classList.add('hidden');
                return;
            }
            
            // 搜索匹配的产品
            const matchingProducts = productsData.filter(product =>{
                return product.product.toLowerCase().includes(searchTerm.toLowerCase()) || 
                       product.name.toLowerCase().includes(searchTerm.toLowerCase());
            });
            
            if (matchingProducts.length === 0) {
                resultsContainer.innerHTML = '<div class="p-3 text-gray-500">No matching products found</div>';
                resultsContainer.classList.remove('hidden');
                return;
            }
            
            // 显示搜索结果
            matchingProducts.forEach(product =>{
                const resultItem = document.createElement('div');
                resultItem.className = 'p-3 hover:bg-blue-50 cursor-pointer transition-colors border-b border-gray-100';
                resultItem.innerHTML = `<div class="font-semibold text-gray-800">${product.product}</div><div class="text-sm text-gray-600">${product.name}</div><div class="text-xs text-gray-500 mt-1">Margin Type: ${product.marginType} | Margin per lot at 1:400 leverage: ${product.leverage400}</div>`;
                resultItem.addEventListener('click', () =>{
                    selectProduct(orderId, product);
                    updateCalculateButtonState();
                });
                resultsContainer.appendChild(resultItem);
            });
            
            resultsContainer.classList.remove('hidden');
        }
        
        // 为特定订单选择产品
        function selectProduct(orderId, product) {
            // 更新UI
            document.getElementById(`productCode_${orderId}`).textContent = product.product;
            document.getElementById(`productName_${orderId}`).textContent = product.name;
            document.getElementById(`selectedProduct_${orderId}`).classList.remove('hidden');
            document.getElementById(`searchResults_${orderId}`).classList.add('hidden');
            document.getElementById(`productSearch_${orderId}`).value = '';
            
            // 在元素上存储产品数据供以后使用
            document.getElementById(`selectedProduct_${orderId}`).setAttribute('data-product', JSON.stringify(product));
            
            // 显示产品信息
            document.getElementById(`contractSize_${orderId}`).textContent = product.contractSize.toLocaleString();
            document.getElementById(`pipValue_${orderId}`).textContent = product.pipValuePerLot;
            document.getElementById(`pricingCurrency_${orderId}`).textContent = product.pricingCurrency;
            document.getElementById(`baseCurrency_${orderId}`).textContent = product.baseCurrency || '-';
            document.getElementById(`marginType_${orderId}`).textContent = product.marginType;
            
            // 根据当前杠杆更新每手保证金
            updatePerLotMargin(orderId);
            
            document.getElementById(`productInfo_${orderId}`).classList.remove('hidden');
            
            // 确定是否显示汇率输入
            const pricingCurrency = product.pricingCurrency;
            const exchangeRateContainer = document.getElementById(`exchangeRateContainer_${orderId}`);
            const exchangeRateHint = document.getElementById(`exchangeRateHint_${orderId}`);
            
            if (pricingCurrency !== 'USD') {
                exchangeRateContainer.classList.remove('hidden');
                exchangeRateHint.textContent = `Required: 1 ${pricingCurrency} = ? USD`;
                document.getElementById(`exchangeRate_${orderId}`).setAttribute('placeholder', `1 ${pricingCurrency} = X USD`);
            } else {
                exchangeRateContainer.classList.add('hidden');
            }
            
            // 对于特定产品，显示EURUSD汇率输入
            const eurusdRateContainer = document.getElementById(`eurusdRateContainer_${orderId}`);
            if (productsNeedingEurusd.includes(product.product)) {
                eurusdRateContainer.classList.remove('hidden');
            } else {
                eurusdRateContainer.classList.add('hidden');
            }
            
            // 启用表单字段
            document.getElementById(`tradeType_${orderId}`).disabled = false;
            document.getElementById(`leverage_${orderId}`).disabled = false;
            document.getElementById(`lots_${orderId}`).disabled = false;
            document.getElementById(`openPrice_${orderId}`).disabled = false;
            document.getElementById(`closePrice_${orderId}`).disabled = false;
        }
        
        // 清除特定订单的选定产品
        function clearSelectedProduct(orderId) {
            document.getElementById(`selectedProduct_${orderId}`).classList.add('hidden');
            document.getElementById(`productInfo_${orderId}`).classList.add('hidden');
            document.getElementById(`exchangeRateContainer_${orderId}`).classList.add('hidden');
            document.getElementById(`eurusdRateContainer_${orderId}`).classList.add('hidden');
            
            // 禁用表单字段
            document.getElementById(`tradeType_${orderId}`).disabled = true;
            document.getElementById(`leverage_${orderId}`).disabled = true;
            document.getElementById(`lots_${orderId}`).disabled = true;
            document.getElementById(`openPrice_${orderId}`).disabled = true;
            document.getElementById(`closePrice_${orderId}`).disabled = true;
        }
        
        // 当杠杆变化时更新"每手保证金"显示
        function updatePerLotMargin(orderId) {
            const productElement = document.getElementById(`selectedProduct_${orderId}`);
            if (!productElement || productElement.classList.contains('hidden')) return;
            
            const product = JSON.parse(productElement.getAttribute('data-product'));
            const selectedLeverage = document.getElementById(`leverage_${orderId}`).value;
            let perLotMargin = '';
            
            switch(selectedLeverage) {
                case '400':
                    perLotMargin = product.leverage400;
                    break;
                case '200':
                    perLotMargin = product.leverage200;
                    break;
                case '100':
                    perLotMargin = product.leverage100;
                    break;
            }
            
            document.getElementById(`perLotMargin_${orderId}`).textContent = perLotMargin;
        }
        
        // 根据表单有效性更新计算按钮状态
        function updateCalculateButtonState() {
            const calculateBtn = document.getElementById('calculateBtn');
            const orderForms = document.querySelectorAll('.order-form');
            let allOrdersValid = true;
            
            // 检查每个订单的有效数据
            orderForms.forEach(orderForm =>{
                const orderId = orderForm.getAttribute('data-order-id');
                const productSelected = !document.getElementById(`selectedProduct_${orderId}`).classList.contains('hidden');
                
                // 检查是否选择了产品
                if (!productSelected) {
                    allOrdersValid = false;
                    return; // 退出当前订单的循环
                }
                
                // 获取产品数据
                const productElement = document.getElementById(`selectedProduct_${orderId}`);
                const product = JSON.parse(productElement.getAttribute('data-product'));
                
                // 获取表单值
                const lotsInput = document.getElementById(`lots_${orderId}`);
                const openPriceInput = document.getElementById(`openPrice_${orderId}`);
                const closePriceInput = document.getElementById(`closePrice_${orderId}`);
                
                // 检查必填字段是否有值
                if (!lotsInput.value || !openPriceInput.value || !closePriceInput.value) {
                    allOrdersValid = false;
                    return;
                }
                
                // 验证数值
                const lotsNum = parseFloat(lotsInput.value);
                const openPriceNum = parseFloat(openPriceInput.value);
                const closePriceNum = parseFloat(closePriceInput.value);
                
                if (isNaN(lotsNum) || isNaN(openPriceNum) || isNaN(closePriceNum) || 
                    lotsNum<= 0 || openPriceNum<= 0 || closePriceNum<= 0) {
                    allOrdersValid = false;
                    return;
                }
                
                // 检查是否需要汇率且有效
                if (product.pricingCurrency !== 'USD') {
                    const exchangeRateInput = document.getElementById(`exchangeRate_${orderId}`);
                    if (!exchangeRateInput.value) {
                        allOrdersValid = false;
                        return;
                    }
                    
                    const exchangeRateNum = parseFloat(exchangeRateInput.value);
                    if (isNaN(exchangeRateNum) || exchangeRateNum<= 0) {
                        allOrdersValid = false;
                        return;
                    }
                }
                
                // 对于特定产品，检查EURUSD汇率是否有效
                if (productsNeedingEurusd.includes(product.product)) {
                    const eurusdRateInput = document.getElementById(`eurusdRate_${orderId}`);
                    if (!eurusdRateInput.value) {
                        allOrdersValid = false;
                        return;
                    }
                    
                    const eurusdRateNum = parseFloat(eurusdRateInput.value);
                    if (isNaN(eurusdRateNum) || eurusdRateNum<= 0) {
                        allOrdersValid = false;
                        return;
                    }
                }
            });
            
            // 如果启用了仓位计算，检查账户余额
            const positionCalculationEnabled = document.getElementById('positionCalculation').checked;
            if (positionCalculationEnabled) {
                const balanceInput = document.getElementById('balance');
                if (!balanceInput.value) {
                    allOrdersValid = false;
                } else {
                    const balanceNum = parseFloat(balanceInput.value);
                    if (isNaN(balanceNum) || balanceNum<= 0) {
                        allOrdersValid = false;
                    }
                }
            }
            
            // 更新按钮状态
            calculateBtn.disabled = !allOrdersValid;
        }
        
        // 使用对冲仓位逻辑计算所有订单
        function calculateAllOrders() {
            const orderForms = document.querySelectorAll('.order-form');
            const multipleOrdersEnabled = document.getElementById('multipleOrders').checked;
            const positionCalculationEnabled = document.getElementById('positionCalculation').checked;
            
            // 检查是否有任何订单使用汇率转换
            let usesExchangeRate = false;
            
            // 首先，计算所有单个订单
            let allOrderResults = [];
            orderForms.forEach(orderForm =>{
                const orderId = parseInt(orderForm.getAttribute('data-order-id'));
                const result = calculateSingleOrder(orderId);
                
                if (result) {
                    allOrderResults.push(result);
                    
                    // 检查此订单是否使用汇率
                    if (result.product.pricingCurrency !== 'USD' || 
                        productsNeedingEurusd.includes(result.product.product)) {
                        usesExchangeRate = true;
                    }
                }
            });
            
            // 按产品分组订单以进行对冲计算
            const products = {};
            allOrderResults.forEach(order =>{
                const productCode = order.product.product;
                if (!products[productCode]) {
                    products[productCode] = {
                        product: order.product,
                        buyOrders: [],
                        sellOrders: [],
                        totalBuyLots: 0,
                        totalSellLots: 0
                    };
                }
                
                if (order.tradeType === 'buy') {
                    products[productCode].buyOrders.push(order);
                    products[productCode].totalBuyLots += order.lots;
                } else {
                    products[productCode].sellOrders.push(order);
                    products[productCode].totalSellLots += order.lots;
                }
            });
            
            // 计算对冲仓位并调整保证金
            let hasHedgePositions = false;
            let hedgeDetails = [];
            
            Object.values(products).forEach(productData =>{
                // 检查此产品是否同时有买入和卖出订单
                if (productData.totalBuyLots >0 && productData.totalSellLots >0) {
                    hasHedgePositions = true;
                    
                    // 计算对冲金额（买入和卖出的最小值）
                    const hedgedLots = Math.min(productData.totalBuyLots, productData.totalSellLots);
                    const remainingBuyLots = productData.totalBuyLots - hedgedLots;
                    const remainingSellLots = productData.totalSellLots - hedgedLots;
                    
                    // 添加到对冲详情
                    hedgeDetails.push(`${productData.product.product}: ${hedgedLots} lots hedged (${productData.totalBuyLots} buy / ${productData.totalSellLots} sell)`);
                    
                    // 计算此产品的每手保证金
                    const leverage = productData.buyOrders.length >0 
                        ? productData.buyOrders[0].selectedLeverage 
                        : productData.sellOrders[0].selectedLeverage;
                    
                    const perLotMarginMatch = productData.product[`leverage${leverage}`].match(/^(\d+\.?\d*) ([A-Z]{3})$/);
                    if (perLotMarginMatch) {
                        const perLotMarginAmount = parseFloat(perLotMarginMatch[1]);
                        const marginCurrency = perLotMarginMatch[2];
                        
                        // 调整买入订单的保证金
                        let remainingBuyToAllocate = remainingBuyLots;
                        productData.buyOrders.forEach(order =>{
                            if (remainingBuyToAllocate<= 0) {
                                // 此订单完全对冲
                                order.originalMarginInUSD = order.marginInUSD;
                                order.marginInUSD = 0;
                                order.isHedged = true;
                                order.hedgedLots = order.lots;
                            } else {
                                // 部分对冲
                                const hedgedInThisOrder = Math.max(0, order.lots - remainingBuyToAllocate);
                                if (hedgedInThisOrder >0) {
                                    order.originalMarginInUSD = order.marginInUSD;
                                    const hedgedPercentage = hedgedInThisOrder / order.lots;
                                    order.marginInUSD *= (1 - hedgedPercentage);
                                    order.isHedged = true;
                                    order.hedgedLots = hedgedInThisOrder;
                                    remainingBuyToAllocate -= (order.lots - hedgedInThisOrder);
                                } else {
                                    order.isHedged = false;
                                    order.hedgedLots = 0;
                                }
                            }
                        });
                        
                        // 调整卖出订单的保证金
                        let remainingSellToAllocate = remainingSellLots;
                        productData.sellOrders.forEach(order =>{
                            if (remainingSellToAllocate<= 0) {
                                // 此订单完全对冲
                                order.originalMarginInUSD = order.marginInUSD;
                                order.marginInUSD = 0;
                                order.isHedged = true;
                                order.hedgedLots = order.lots;
                            } else {
                                // 部分对冲
                                const hedgedInThisOrder = Math.max(0, order.lots - remainingSellToAllocate);
                                if (hedgedInThisOrder >0) {
                                    order.originalMarginInUSD = order.marginInUSD;
                                    const hedgedPercentage = hedgedInThisOrder / order.lots;
                                    order.marginInUSD *= (1 - hedgedPercentage);
                                    order.isHedged = true;
                                    order.hedgedLots = hedgedInThisOrder;
                                    remainingSellToAllocate -= (order.lots - hedgedInThisOrder);
                                } else {
                                    order.isHedged = false;
                                    order.hedgedLots = 0;
                                }
                            }
                        });
                    } else {
                        // Apply hedging margin adjustments for floating margin products as well
                        // 调整买入订单的保证金（浮动保证金）
                        let remainingBuyToAllocate = remainingBuyLots;
                        productData.buyOrders.forEach(order =>{
                            order.originalMarginInUSD = order.marginInUSD;
                            const perLotUSD = (order.lots > 0) ? (order.originalMarginInUSD / order.lots) : 0;

                            if (remainingBuyToAllocate<= 0) {
                                // fully hedged: keep 50% per lot for each lot
                                order.marginInUSD = order.lots * (0.5 * perLotUSD);
                                order.isHedged = true;
                                order.hedgedLots = order.lots;
                            } else {
                                const hedgedInThisOrder = Math.max(0, order.lots - remainingBuyToAllocate);
                                if (hedgedInThisOrder >0) {
                                    const nonHedgedLots = order.lots - hedgedInThisOrder;
                                    order.marginInUSD = nonHedgedLots * perLotUSD + hedgedInThisOrder * (0.5 * perLotUSD);
                                    order.isHedged = true;
                                    order.hedgedLots = hedgedInThisOrder;
                                    remainingBuyToAllocate -= (order.lots - hedgedInThisOrder);
                                } else {
                                    order.isHedged = false;
                                    order.hedgedLots = 0;
                                }
                            }
                        });

                        // 调整卖出订单的保证金（浮动保证金）
                        let remainingSellToAllocate = remainingSellLots;
                        productData.sellOrders.forEach(order =>{
                            order.originalMarginInUSD = order.marginInUSD;
                            const perLotUSD = (order.lots > 0) ? (order.originalMarginInUSD / order.lots) : 0;

                            if (remainingSellToAllocate<= 0) {
                                // fully hedged: keep 50% per lot for each lot
                                order.marginInUSD = order.lots * (0.5 * perLotUSD);
                                order.isHedged = true;
                                order.hedgedLots = order.lots;
                            } else {
                                const hedgedInThisOrder = Math.max(0, order.lots - remainingSellToAllocate);
                                if (hedgedInThisOrder >0) {
                                    const nonHedgedLots = order.lots - hedgedInThisOrder;
                                    order.marginInUSD = nonHedgedLots * perLotUSD + hedgedInThisOrder * (0.5 * perLotUSD);
                                    order.isHedged = true;
                                    order.hedgedLots = hedgedInThisOrder;
                                    remainingSellToAllocate -= (order.lots - hedgedInThisOrder);
                                } else {
                                    order.isHedged = false;
                                    order.hedgedLots = 0;
                                }
                            }
                        });
                    }
                } else {
                    // 此产品没有对冲
                    [...productData.buyOrders, ...productData.sellOrders].forEach(order =>{
                        order.isHedged = false;
                        order.hedgedLots = 0;
                        order.originalMarginInUSD = order.marginInUSD;
                    });
                }
            });
            
            // 使用调整后的保证金计算总计
            let totalPnLInUSD = 0;
            let totalMarginInUSD = 0;
            let totalOriginalMarginInUSD = 0;
            
            allOrderResults.forEach(order =>{
                totalPnLInUSD += order.pnlInUSD;
                totalMarginInUSD += order.marginInUSD;
                totalOriginalMarginInUSD += order.originalMarginInUSD;
            });
            
            // Preserve total PnL before commission and prepare after-commission value
            const totalPnLNoCommissionInUSD = totalPnLInUSD;
            let totalPnLWithCommissionInUSD = totalPnLInUSD;
            
            
            // 显示包含对冲信息的结果
            
            // Deduct commissions using global commission rate and attach per-order commission to details
            const positionOn = document.getElementById('positionCalculation').checked;
            const globalRateEl = document.getElementById('globalCommissionRate');
            const globalRate = globalRateEl ? (parseFloat(globalRateEl.value) || 0) : 0;
            let totalCommissionUSD = 0;
            if (positionOn) {
                allOrderResults.forEach(order =>{
                    const commissionUSD = (parseFloat(order.lots) || 0) * globalRate;
                    order.commissionUSD = commissionUSD;
                    totalCommissionUSD += commissionUSD;
                });
                totalPnLInUSD -= totalCommissionUSD;
                totalPnLWithCommissionInUSD = totalPnLInUSD;
            } else {
                allOrderResults.forEach(order =>{ order.commissionUSD = 0; });
            }
            displayResults(
                allOrderResults, 
                totalPnLInUSD, 
                totalMarginInUSD, 
                totalOriginalMarginInUSD,
                multipleOrdersEnabled, 
                positionCalculationEnabled,
                hasHedgePositions,
                hedgeDetails,
                usesExchangeRate,
                totalPnLNoCommissionInUSD,
                totalPnLWithCommissionInUSD
            );
            
            // 添加到历史记录
            addToHistory(allOrderResults, totalPnLInUSD, totalMarginInUSD, positionCalculationEnabled);
        }
        
        // 计算单个订单
        function calculateSingleOrder(orderId) {
            const productElement = document.getElementById(`selectedProduct_${orderId}`);
            if (!productElement || productElement.classList.contains('hidden')) return null;
            
            const product = JSON.parse(productElement.getAttribute('data-product'));
            
            // 获取表单值
            const tradeType = document.getElementById(`tradeType_${orderId}`).value;
            const selectedLeverage = document.getElementById(`leverage_${orderId}`).value;
            const lots = parseFloat(document.getElementById(`lots_${orderId}`).value);
            const openPrice = parseFloat(document.getElementById(`openPrice_${orderId}`).value);
            const closePrice = parseFloat(document.getElementById(`closePrice_${orderId}`).value);
            const contractSize = product.contractSize;
            const pricingCurrency = product.pricingCurrency;
            
            // 输入验证
            if (isNaN(lots) || isNaN(openPrice) || isNaN(closePrice) || lots<= 0 || openPrice<= 0 || closePrice<= 0) {
                alert(`Please enter valid positive numbers for Order #${orderId}`);
                return null;
            }
            
            // 汇率处理
            let exchangeRate = 1.0;
            if (pricingCurrency !== 'USD') {
                exchangeRate = parseFloat(document.getElementById(`exchangeRate_${orderId}`).value) || 0;
                if (exchangeRate<= 0) {
                    alert(`Please enter a valid exchange rate for Order #${orderId}`);
                    return null;
                }
            }
            
            // 对于特定产品，获取EURUSD汇率
            let eurusdRate = 1.0;
            if (productsNeedingEurusd.includes(product.product)) {
                eurusdRate = parseFloat(document.getElementById(`eurusdRate_${orderId}`).value) || 0;
                if (eurusdRate<= 0) {
                    alert(`Please enter a valid EURUSD exchange rate for Order #${orderId}`);
                    return null;
                }
            }
            
            // 盈亏计算
            const priceChange = closePrice - openPrice;
            const directionFactor = tradeType === 'buy' ? 1 : -1;
            const pnl = priceChange * contractSize * lots * directionFactor;
            let pnlInUSD = pnl;
if (pricingCurrency === 'USD') {
  pnlInUSD = pnl;
} else if (pricingCurrency === 'EUR' && productsNeedingEurusd.includes(product.product) && eurusdRate > 0) {
  pnlInUSD = pnl * eurusdRate;
} else {
  pnlInUSD = pnl * exchangeRate;
}
            const pnlCurrency = product.pipValuePerLot.match(/[A-Z]{3}$/)?.[0] || pricingCurrency;
            
            // 基于保证金类型的保证金计算
            let marginRequired = 0;
            let marginCurrency = '';
            let marginCalculationDesc = '';
            const perLotMarginValue = product[`leverage${selectedLeverage}`];
            
            if (product.marginType === 'Fixed') {
                const fixedMarginMatch = perLotMarginValue.match(/^(\d+\.?\d*) ([A-Z]{3})$/);
                if (!fixedMarginMatch) {
                    alert(`Invalid fixed margin format for ${product.product} (${perLotMarginValue})`);
                    return null;
                }
                const perLotMarginAmount = parseFloat(fixedMarginMatch[1]);
                marginCurrency = fixedMarginMatch[2];
                marginRequired = perLotMarginAmount * lots;
                marginCalculationDesc = `Fixed margin per lot (${perLotMarginAmount} ${marginCurrency}) × number of lots (${lots})`;
            
            } else if (product.marginType === 'Floating') {
                const leverageRatioMatch = perLotMarginValue.match(/^1:(\d+)$/);
                if (!leverageRatioMatch) {
                    alert(`Invalid leverage format for floating margin product ${product.product} (${perLotMarginValue})`);
                    return null;
                }
                const leverageRatio = parseInt(leverageRatioMatch[1]);
                marginCurrency = pricingCurrency;
                marginRequired = (openPrice * lots * contractSize) / leverageRatio;
                marginCalculationDesc = `Open price (${openPrice}) × lots (${lots}) × contract size (${contractSize.toLocaleString()}) ÷ leverage ratio (1:${leverageRatio})`;
            
            } else {
                alert(`Unknown margin type: ${product.marginType} (Product: ${product.product})`);
                return null;
            }
            
            // 保证金美元转换 - 对于EUR保证金产品，使用EURUSD汇率
            let marginInUSD = marginRequired;
if (marginCurrency === 'USD') {
  marginInUSD = marginRequired;
} else if (marginCurrency === 'EUR' && productsNeedingEurusd.includes(product.product) && eurusdRate > 0) {
  marginInUSD = marginRequired * eurusdRate;
} else {
  // Fallback to general exchangeRate for all non-USD (including EUR non-whitelist)
  marginInUSD = marginRequired * exchangeRate;
}
            
            // 盈亏百分比计算
            const pnlPercentage = (pnl / marginRequired) * 100;
            
            return {
                orderId,
                product,
                tradeType,
                selectedLeverage,
                lots,
                openPrice,
                closePrice,
                pnl,
                pnlCurrency,
                pnlInUSD,
                marginRequired,
                marginCurrency,
                marginInUSD,
                pnlPercentage,
                marginCalculationDesc,
                exchangeRate,
                eurusdRate: productsNeedingEurusd.includes(product.product) ? eurusdRate : null
            };
        }
        
        // 显示所有结果
        function displayResults(
            orderResults, 
            totalPnLInUSD, 
            totalMarginInUSD,
            totalOriginalMarginInUSD,
            multipleOrdersEnabled, 
            positionCalculationEnabled,
            hasHedgePositions,
            hedgeDetails,
            usesExchangeRate
        , totalPnLNoCommissionInUSD, totalPnLWithCommissionInUSD) {
            const resultsSection = document.getElementById('resultsSection');
            const individualResults = document.getElementById('individualResults');
            const summaryResults = document.getElementById('summaryResults');
            const calculationDetails = document.getElementById('calculationDetails');
            const hedgeNotice = document.getElementById('hedgeNotice');
            const hedgeDetailsEl = document.getElementById('hedgeDetails');
            const exchangeRateNote = document.getElementById('exchangeRateNote');
            
            // 清除先前的结果
            individualResults.innerHTML = '';
            calculationDetails.innerHTML = '';
            
            // 显示或隐藏汇率提示
            if (usesExchangeRate) {
                exchangeRateNote.classList.remove('hidden');
            } else {
                exchangeRateNote.classList.add('hidden');
            }
            
            // 显示或隐藏对冲提示
            if (hasHedgePositions) {
                hedgeNotice.classList.remove('hidden');
                hedgeDetailsEl.innerHTML = `Hedged positions detected: ${hedgeDetails.join('; ')}.`;
            } else {
                hedgeNotice.classList.add('hidden');
            }
            
            // 为多订单显示汇总
            if (multipleOrdersEnabled && orderResults.length >1) {
                summaryResults.classList.remove('hidden');
                
                const elNo = document.getElementById('totalPnLNoCommissionInUSD');
                const elWith = document.getElementById('totalPnLWithCommissionInUSD');
                if (elNo)  elNo.textContent  = `${(totalPnLNoCommissionInUSD ?? totalPnLInUSD).toFixed(2)} USD`;
                if (elWith) elWith.textContent = `${(totalPnLWithCommissionInUSD ?? totalPnLInUSD).toFixed(2)} USD`;
              
                
                // 如果有对冲，显示原始与调整后的保证金
                if (hasHedgePositions) {
                    document.getElementById('totalMarginInUSD').innerHTML = `
                        ${totalMarginInUSD.toFixed(2)} USD<div class="text-sm opacity-80">(Original: ${totalOriginalMarginInUSD.toFixed(2)} USD)</div>`;
                } else {
                    document.getElementById('totalMarginInUSD').textContent = `${totalMarginInUSD.toFixed(2)} USD`;
                }
            } else {
                summaryResults.classList.add('hidden');
            }
            
            // 显示单个订单结果
            orderResults.forEach(result =>{
                // 创建单个结果卡片
                const resultCard = document.createElement('div');
                resultCard.className = 'bg-white bg-opacity-10 rounded-xl p-6 backdrop-blur-sm';
                
                const isProfit = result.pnl >= 0;
                const pnlClass = isProfit ? 'text-green-400' : 'text-red-400';
                const pnlIcon = isProfit ? 'fas fa-arrow-up' : 'fas fa-arrow-down';
                
                // 准备包含对冲信息的保证金显示（如适用）
                let marginDisplay = `${result.marginInUSD.toFixed(2)} USD`;
                if (result.isHedged && result.hedgedLots >0) {
                    marginDisplay += `<div class="text-sm opacity-80">(Original: ${result.originalMarginInUSD.toFixed(2)} USD)</div><div class="text-xs bg-yellow-500 bg-opacity-20 px-2 py-1 rounded mt-1"><i class="fas fa-info-circle mr-1"></i>${result.hedgedLots} lots hedged ${futuresProducts.includes(result.product.product) ? '(hedged portion margin = 50%)' : '(margin reduced to 0)'}</div>`;
                } else {
                    marginDisplay += `<div class="text-sm opacity-80">(${result.marginRequired.toFixed(2)} ${result.marginCurrency})</div>`;
                }
                
                resultCard.innerHTML = `<div class="flex justify-between items-center mb-4"><h3 class="text-lg font-semibold">${multipleOrdersEnabled ? `Order #${result.orderId}: ` : ''}${result.product.product} - ${result.product.name}</h3><span class="text-sm font-medium px-3 py-1 rounded-full ${isProfit ? 'bg-green-500 bg-opacity-20' : 'bg-red-500 bg-opacity-20'}">${result.tradeType === 'buy' ? 'Buy' : 'Sell'} | ${result.lots} lots | Leverage: 1:${result.selectedLeverage}</span></div><div class="grid grid-cols-1 md:grid-cols-2 gap-6"><div><h4 class="text-sm opacity-80 mb-1">Profit/Loss</h4><div class="font-bold text-xl ${pnlClass}"><i class="${pnlIcon} mr-1"></i>${result.pnlInUSD.toFixed(2)} USD</div><div class="text-sm opacity-80">(${result.pnl.toFixed(2)} ${result.pnlCurrency})</div><div class="text-xs opacity-80 mt-1">(Relative to margin: ${result.pnlPercentage.toFixed(2)}%)</div><div class="text-xs opacity-80 mt-1">Commission (USD): ${ (result.commissionUSD || 0).toFixed(2) }</div></div><div><h4 class="text-sm opacity-80 mb-1">Used Margin</h4><div class="font-bold text-xl">${marginDisplay}</div><div class="text-xs opacity-80 mt-1">${result.marginCalculationDesc}</div></div></div>`;
                
                individualResults.appendChild(resultCard);
                
                // 添加到计算详情
                const product = result.product;
                let hedgeInfo = '';
                if (result.isHedged && result.hedgedLots >0) {
                    hedgeInfo = `
                        ${futuresProducts.includes(product.product) ? `<div><strong>Hedged:</strong>${result.hedgedLots} lots (hedged portion margin = 50%)</div>` : `<div><strong>Hedged:</strong>${result.hedgedLots} lots (margin reduced to 0)</div>`}<div><strong>Original Margin:</strong>${result.originalMarginInUSD.toFixed(2)} USD</div>`;
                }
                
                let exchangeRateInfo = '';
                if (product.pricingCurrency !== 'USD') {
                    exchangeRateInfo = `<div><strong>Exchange Rate Used:</strong>1 ${product.pricingCurrency} = ${result.exchangeRate} USD</div>`;
                }
                
                // 添加EURUSD汇率信息（如适用）
                let eurusdRateInfo = '';
                if (productsNeedingEurusd.includes(product.product)) {
                    eurusdRateInfo = `<div><strong>EURUSD Rate Used:</strong>${result.eurusdRate}</div>`;
                }
                
                let orderDetails = `<div class="p-3 bg-white bg-opacity-5 rounded-lg"><div class="font-medium mb-2">${multipleOrdersEnabled ? `Order #${result.orderId}: ` : ''}${product.product} - ${product.name}</div><div class="grid grid-cols-1 md:grid-cols-2 gap-x-4 gap-y-1 text-xs"><div><strong>Trade:</strong>${result.tradeType === 'buy' ? 'Buy' : 'Sell'} | ${result.lots} lots</div><div><strong>Leverage:</strong>1:${result.selectedLeverage}</div><div><strong>Open Price:</strong>${result.openPrice}</div><div><strong>Close Price:</strong>${result.closePrice}</div><div><strong>Price Change:</strong>${(result.closePrice - result.openPrice).toFixed(5)}</div><div><strong>Contract Size:</strong>${product.contractSize.toLocaleString()}</div><div><strong>PnL:</strong>${result.pnl.toFixed(2)} ${result.pnlCurrency} (${result.pnlInUSD.toFixed(2)} USD)</div><div><strong>Used Margin:</strong>${result.marginInUSD.toFixed(2)} USD (${result.marginRequired.toFixed(2)} ${result.marginCurrency})</div>${positionCalculationEnabled ? `<div><strong>Commission Deducted:</strong>$${(result.commissionUSD || 0).toFixed(2)}</div>` : ''}
                            ${exchangeRateInfo}
                            ${eurusdRateInfo}
                            ${hedgeInfo}</div></div>`;
                
                calculationDetails.innerHTML += orderDetails;
            });
            
            // 为多订单添加汇总计算
            if (multipleOrdersEnabled && orderResults.length >1) {
                let hedgeSummary = '';
                if (hasHedgePositions) {
                    hedgeSummary = `<div><strong>Original Total Margin:</strong>${totalOriginalMarginInUSD.toFixed(2)} USD</div><div><strong>Margin Reduction Due to Hedging:</strong>${(totalOriginalMarginInUSD - totalMarginInUSD).toFixed(2)} USD</div>`;
                }
                
                calculationDetails.innerHTML += `<div class="p-3 bg-white bg-opacity-10 rounded-lg mt-4"><div class="font-medium mb-2">Total Summary</div><div class="grid grid-cols-1 md:grid-cols-2 gap-x-4 gap-y-1 text-xs"><div><strong>Total PnL in USD:</strong>${totalPnLInUSD.toFixed(2)} USD</div><div><strong>Total Margin in USD:</strong>${totalMarginInUSD.toFixed(2)} USD</div><div><strong>Total Orders:</strong>${orderResults.length}</div><div><strong>Used Leverage:</strong>1:${currentLeverage}</div>${hedgeSummary}</div></div>`;
            }
            
            // 如果启用，计算并显示仓位指标
            const positionResults = document.getElementById('positionResults');
            if (positionCalculationEnabled) {
                const balance = parseFloat(document.getElementById('balance').value) || 0;
                const equity = balance + totalPnLInUSD;
                const freeMargin = equity - totalMarginInUSD;
                const marginRatio = (equity / totalMarginInUSD) * 100;
                
                document.getElementById('equity').textContent = `${equity.toFixed(2)} USD`;
                document.getElementById('freeMargin').textContent = `${freeMargin.toFixed(2)} USD`;
                document.getElementById('marginRatio').textContent = `${marginRatio.toFixed(2)}%`;
                
                positionResults.classList.remove('hidden');
                
                // 将仓位详情添加到计算详情
                calculationDetails.innerHTML += `<div class="p-3 bg-white bg-opacity-10 rounded-lg mt-4"><div class="font-medium mb-2">Position Calculations</div><div class="grid grid-cols-1 md:grid-cols-3 gap-x-4 gap-y-1 text-xs"><div><strong>Balance:</strong>${balance.toFixed(2)} USD</div><div><strong>Equity:</strong>${equity.toFixed(2)} USD (Balance + Total PnL)</div><div><strong>Free Margin:</strong>${freeMargin.toFixed(2)} USD (Equity - Total Margin)</div><div><strong>Margin Ratio:</strong>${marginRatio.toFixed(2)}% (Equity / Total Margin × 100%)</div></div></div>`;
            } else {
                positionResults.classList.add('hidden');
            }
            
            // 显示结果部分
            resultsSection.classList.remove('hidden');
        }
        
        // 添加到历史记录
        function addToHistory(orderResults, totalPnLInUSD, totalMarginInUSD, positionCalculationEnabled) {
            let balance = null;
            let equity = null;
            let freeMargin = null;
            let marginRatio = null;
            
            if (positionCalculationEnabled) {
                balance = parseFloat(document.getElementById('balance').value) || 0;
                equity = balance + totalPnLInUSD;
                freeMargin = equity - totalMarginInUSD;
                marginRatio = (equity / totalMarginInUSD) * 100;
            }
            
            const historyItem = {
                orders: orderResults,
                totalPnLInUSD,
                totalMarginInUSD,
                positionCalculation: positionCalculationEnabled,
                balance,
                equity,
                freeMargin,
                marginRatio,
                leverage: currentLeverage,
                timestamp: new Date()
            };
            
            calculationHistory.unshift(historyItem);
            if (calculationHistory.length >5) {
                calculationHistory.pop();
            }
            
            updateHistoryDisplay();
        }
        
        // 更新历史记录显示
        function updateHistoryDisplay() {
            const historyList = document.getElementById('historyList');
            const noHistory = document.getElementById('noHistory');
            
            if (calculationHistory.length === 0) {
                noHistory.classList.remove('hidden');
                historyList.innerHTML = '';
                return;
            }
            
            noHistory.classList.add('hidden');
            historyList.innerHTML = '';
            
            calculationHistory.forEach((item, index) =>{
                const historyItem = document.createElement('div');
                historyItem.className = 'p-4 border-b border-gray-100 hover:bg-gray-50 transition-colors';
                
                const isProfit = item.totalPnLInUSD >= 0;
                const pnlClass = isProfit ? 'text-green-600' : 'text-red-600';
                const pnlIcon = isProfit ? 'fas fa-arrow-up' : 'fas fa-arrow-down';
                
                // 创建订单摘要文本
                let orderSummary = '';
                if (item.orders.length === 1) {
                    const order = item.orders[0];
                    orderSummary = `${order.product.product} (${order.lots} lots)`;
                } else {
                    orderSummary = `${item.orders.length} orders`;
                }
                
                // 检查是否有对冲订单
                const hasHedgedOrders = item.orders.some(order =>order.isHedged);
                const hedgeIndicator = hasHedgedOrders ? 
                    '<span class="inline-block text-xs bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded ml-2">Hedged</span>' : '';
                
                // 格式化时间戳
                const formattedTime = item.timestamp.toLocaleString();
                
                // 仓位详情
                let positionDetails = '';
                if (item.positionCalculation) {
                    positionDetails = `<div class="text-xs text-gray-500 mt-1">Equity: ${item.equity.toFixed(2)} USD | Margin Ratio: ${item.marginRatio.toFixed(2)}%</div>`;
                }
                
                historyItem.innerHTML = `<div class="flex justify-between items-start"><div><div class="font-medium">${formattedTime}</div><div class="text-sm text-gray-600 mt-1">${orderSummary} ${hedgeIndicator}</div></div><div class="text-right"><div class="font-medium ${pnlClass}"><i class="${pnlIcon}"></i>${item.totalPnLInUSD.toFixed(2)} USD</div><div class="text-xs text-gray-500 mt-1">Margin: ${item.totalMarginInUSD.toFixed(2)} USD</div></div></div>${positionDetails}
                `;
                
                historyList.appendChild(historyItem);
            });
        }</script></body>
</template>

<template id="page-latam">
<html lang="en"><head><meta charset="utf-8"/><meta content="width=device-width, initial-scale=1.0" name="viewport"/><title>PnL Calculator</title><script src="https://cdn.tailwindcss.com"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" rel="stylesheet"/><style>.bg-custom {
            background: linear-gradient(rgba(255, 255, 255, 0.85), rgba(255, 255, 255, 0.85)), 
                        url('https://images.unsplash.com/photo-1611974789855-9c2a0a7236a3?ixlib=rb-4.0.3');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }</style><!-- 产品数据 --><script>const productsData = [{"product": "EURUSD", "name": "Euro/US Dollar", "contractSize": 100000, "pipValuePerLot": "10 USD", "leverage400": "1:400", "leverage200": "1:200", "leverage100": "N/A", "baseCurrency": "EUR", "pricingCurrency": "USD", "marginType": "Floating"}, {"product": "USDJPY", "name": "US Dollar/Japanese Yen", "contractSize": 100000, "pipValuePerLot": "1000 JPY", "leverage400": "1:400", "leverage200": "1:200", "leverage100": "N/A", "baseCurrency": "USD", "pricingCurrency": "JPY", "marginType": "Floating"}, {"product": "GBPUSD", "name": "Great British Pound/US Dollar", "contractSize": 100000, "pipValuePerLot": "10 USD", "leverage400": "1:400", "leverage200": "1:200", "leverage100": "N/A", "baseCurrency": "GBP", "pricingCurrency": "USD", "marginType": "Floating"}, {"product": "USDCHF", "name": "US Dollar/Swiss Franc", "contractSize": 100000, "pipValuePerLot": "10 CHF", "leverage400": "1:400", "leverage200": "1:200", "leverage100": "N/A", "baseCurrency": "USD", "pricingCurrency": "CHF", "marginType": "Floating"}, {"product": "AUDUSD", "name": "Australian Dollar/US Dollar", "contractSize": 100000, "pipValuePerLot": "10 USD", "leverage400": "1:400", "leverage200": "1:200", "leverage100": "N/A", "baseCurrency": "AUD", "pricingCurrency": "USD", "marginType": "Floating"}, {"product": "NZDUSD", "name": "New Zealand Dollar/US Dollar", "contractSize": 100000, "pipValuePerLot": "10 USD", "leverage400": "1:400", "leverage200": "1:200", "leverage100": "N/A", "baseCurrency": "NZD", "pricingCurrency": "USD", "marginType": "Floating"}, {"product": "USDCAD", "name": "US Dollar/Canadian Dollar", "contractSize": 100000, "pipValuePerLot": "10 CAD", "leverage400": "1:400", "leverage200": "1:200", "leverage100": "N/A", "baseCurrency": "USD", "pricingCurrency": "CAD", "marginType": "Floating"}, {"product": "AUDCAD", "name": "Australian Dollar/Canadian Dollar", "contractSize": 100000, "pipValuePerLot": "10 CAD", "leverage400": "1:400", "leverage200": "1:200", "leverage100": "N/A", "baseCurrency": "AUD", "pricingCurrency": "CAD", "marginType": "Floating"}, {"product": "AUDCHF", "name": "Australian Dollar/Swiss Franc", "contractSize": 100000, "pipValuePerLot": "10 CHF", "leverage400": "1:400", "leverage200": "1:200", "leverage100": "N/A", "baseCurrency": "AUD", "pricingCurrency": "CHF", "marginType": "Floating"}, {"product": "AUDJPY", "name": "Australian Dollar/Japanese Yen", "contractSize": 100000, "pipValuePerLot": "1000 JPY", "leverage400": "1:400", "leverage200": "1:200", "leverage100": "N/A", "baseCurrency": "AUD", "pricingCurrency": "JPY", "marginType": "Floating"}, {"product": "AUDNZD", "name": "Australian Dollar/New Zealand Dollar", "contractSize": 100000, "pipValuePerLot": "10 NZD", "leverage400": "1:400", "leverage200": "1:200", "leverage100": "N/A", "baseCurrency": "AUD", "pricingCurrency": "NZD", "marginType": "Floating"}, {"product": "CADCHF", "name": "Canadian Dollar/Swiss Franc", "contractSize": 100000, "pipValuePerLot": "10 CHF", "leverage400": "1:400", "leverage200": "1:200", "leverage100": "N/A", "baseCurrency": "CAD", "pricingCurrency": "CHF", "marginType": "Floating"}, {"product": "CADJPY", "name": "Canadian Dollar/Japanese Yen", "contractSize": 100000, "pipValuePerLot": "1000 JPY", "leverage400": "1:400", "leverage200": "1:200", "leverage100": "N/A", "baseCurrency": "CAD", "pricingCurrency": "JPY", "marginType": "Floating"}, {"product": "CHFJPY", "name": "Swiss Franc/Japanese Yen", "contractSize": 100000, "pipValuePerLot": "1000 JPY", "leverage400": "1:400", "leverage200": "1:200", "leverage100": "N/A", "baseCurrency": "CHF", "pricingCurrency": "JPY", "marginType": "Floating"}, {"product": "EURAUD", "name": "Euro/Australian Dollar", "contractSize": 100000, "pipValuePerLot": "10 AUD", "leverage400": "1:400", "leverage200": "1:200", "leverage100": "N/A", "baseCurrency": "EUR", "pricingCurrency": "AUD", "marginType": "Floating"}, {"product": "EURCAD", "name": "Euro/Canadian Dollar", "contractSize": 100000, "pipValuePerLot": "10 CAD", "leverage400": "1:400", "leverage200": "1:200", "leverage100": "N/A", "baseCurrency": "EUR", "pricingCurrency": "CAD", "marginType": "Floating"}, {"product": "EURCHF", "name": "Euro/Swiss Franc", "contractSize": 100000, "pipValuePerLot": "10 CHF", "leverage400": "1:400", "leverage200": "1:200", "leverage100": "N/A", "baseCurrency": "EUR", "pricingCurrency": "CHF", "marginType": "Floating"}, {"product": "EURGBP", "name": "Euro/Great British Pound", "contractSize": 100000, "pipValuePerLot": "10 GBP", "leverage400": "1:400", "leverage200": "1:200", "leverage100": "N/A", "baseCurrency": "EUR", "pricingCurrency": "GBP", "marginType": "Floating"}, {"product": "EURJPY", "name": "Euro/Japanese Yen", "contractSize": 100000, "pipValuePerLot": "1000 JPY", "leverage400": "1:400", "leverage200": "1:200", "leverage100": "N/A", "baseCurrency": "EUR", "pricingCurrency": "JPY", "marginType": "Floating"}, {"product": "EURNZD", "name": "Euro/New Zealand Dollar", "contractSize": 100000, "pipValuePerLot": "10 NZD", "leverage400": "1:400", "leverage200": "1:200", "leverage100": "N/A", "baseCurrency": "EUR", "pricingCurrency": "NZD", "marginType": "Floating"}, {"product": "GBPAUD", "name": "Great British Pound/Australian Dollar", "contractSize": 100000, "pipValuePerLot": "10 AUD", "leverage400": "1:400", "leverage200": "1:200", "leverage100": "N/A", "baseCurrency": "GBP", "pricingCurrency": "AUD", "marginType": "Floating"}, {"product": "GBPCAD", "name": "Great British Pound/Canadian Dollar", "contractSize": 100000, "pipValuePerLot": "10 CAD", "leverage400": "1:400", "leverage200": "1:200", "leverage100": "N/A", "baseCurrency": "GBP", "pricingCurrency": "CAD", "marginType": "Floating"}, {"product": "GBPCHF", "name": "Great British Pound/Swiss Franc", "contractSize": 100000, "pipValuePerLot": "10 CHF", "leverage400": "1:400", "leverage200": "1:200", "leverage100": "N/A", "baseCurrency": "GBP", "pricingCurrency": "CHF", "marginType": "Floating"}, {"product": "GBPJPY", "name": "Great British Pound/Japanese Yen", "contractSize": 100000, "pipValuePerLot": "1000 JPY", "leverage400": "1:400", "leverage200": "1:200", "leverage100": "N/A", "baseCurrency": "GBP", "pricingCurrency": "JPY", "marginType": "Floating"}, {"product": "GBPNZD", "name": "Great British Pound/New Zealand Dollar", "contractSize": 100000, "pipValuePerLot": "10 NZD", "leverage400": "1:400", "leverage200": "1:200", "leverage100": "N/A", "baseCurrency": "GBP", "pricingCurrency": "NZD", "marginType": "Floating"}, {"product": "NZDCAD", "name": "New Zealand Dollar/Canadian Dollar", "contractSize": 100000, "pipValuePerLot": "10 CAD", "leverage400": "1:400", "leverage200": "1:200", "leverage100": "N/A", "baseCurrency": "NZD", "pricingCurrency": "CAD", "marginType": "Floating"}, {"product": "NZDCHF", "name": "New Zealand Dollar/Swiss Franc", "contractSize": 100000, "pipValuePerLot": "10 CHF", "leverage400": "1:400", "leverage200": "1:200", "leverage100": "N/A", "baseCurrency": "NZD", "pricingCurrency": "CHF", "marginType": "Floating"}, {"product": "NZDJPY", "name": "New Zealand Dollar/Japanese Yen", "contractSize": 100000, "pipValuePerLot": "1000 JPY", "leverage400": "1:400", "leverage200": "1:200", "leverage100": "N/A", "baseCurrency": "NZD", "pricingCurrency": "JPY", "marginType": "Floating"}, {"product": "EURHUF", "name": "Euro/Hungarian Forint", "contractSize": 100000, "pipValuePerLot": "1000 HUF", "leverage400": "1:50", "leverage200": "1:50", "leverage100": "N/A", "baseCurrency": "EUR", "pricingCurrency": "HUF", "marginType": "Floating"}, {"product": "EURPLN", "name": "Euro/Polish Zloty", "contractSize": 100000, "pipValuePerLot": "10 PLN", "leverage400": "1:50", "leverage200": "1:50", "leverage100": "N/A", "baseCurrency": "EUR", "pricingCurrency": "PLN", "marginType": "Floating"}, {"product": "USDCNH", "name": "US Dollar/Chinese Offshore Yuan", "contractSize": 100000, "pipValuePerLot": "10 CNH", "leverage400": "1:50", "leverage200": "1:50", "leverage100": "N/A", "baseCurrency": "USD", "pricingCurrency": "CNH", "marginType": "Floating"}, {"product": "USDHKD", "name": "US Dollar/Hong Kong Dollar", "contractSize": 100000, "pipValuePerLot": "10 HKD", "leverage400": "1:50", "leverage200": "1:50", "leverage100": "N/A", "baseCurrency": "USD", "pricingCurrency": "HKD", "marginType": "Floating"}, {"product": "USDSGD", "name": "US Dollar/Singapore Dollar", "contractSize": 100000, "pipValuePerLot": "10 SGD", "leverage400": "1:50", "leverage200": "1:50", "leverage100": "N/A", "baseCurrency": "USD", "pricingCurrency": "SGD", "marginType": "Floating"}, {"product": "USDCZK", "name": "US Dollar/Czech Koruna", "contractSize": 100000, "pipValuePerLot": "1000 CZK", "leverage400": "1:50", "leverage200": "1:50", "leverage100": "N/A", "baseCurrency": "USD", "pricingCurrency": "CZK", "marginType": "Floating"}, {"product": "USDDKK", "name": "US Dollar/Danish Krone", "contractSize": 100000, "pipValuePerLot": "10 DKK", "leverage400": "1:50", "leverage200": "1:50", "leverage100": "N/A", "baseCurrency": "USD", "pricingCurrency": "DKK", "marginType": "Floating"}, {"product": "USDHUF", "name": "US Dollar/Hungarian Forint", "contractSize": 100000, "pipValuePerLot": "1000 HUF", "leverage400": "1:50", "leverage200": "1:50", "leverage100": "N/A", "baseCurrency": "USD", "pricingCurrency": "HUF", "marginType": "Floating"}, {"product": "USDMXN", "name": "US Dollar/Mexican Peso", "contractSize": 100000, "pipValuePerLot": "10 MXN", "leverage400": "1:50", "leverage200": "1:50", "leverage100": "N/A", "baseCurrency": "USD", "pricingCurrency": "MXN", "marginType": "Floating"}, {"product": "USDNOK", "name": "US Dollar/Norwegian Krone", "contractSize": 100000, "pipValuePerLot": "10 NOK", "leverage400": "1:50", "leverage200": "1:50", "leverage100": "N/A", "baseCurrency": "USD", "pricingCurrency": "NOK", "marginType": "Floating"}, {"product": "USDPLN", "name": "US Dollar/Polish Zloty", "contractSize": 100000, "pipValuePerLot": "10 PLN", "leverage400": "1:50", "leverage200": "1:50", "leverage100": "N/A", "baseCurrency": "USD", "pricingCurrency": "PLN", "marginType": "Floating"}, {"product": "USDTRY", "name": "US Dollar/Turkish Lira (Disabled)", "contractSize": 100000, "pipValuePerLot": "10 TRY", "leverage400": "1:50", "leverage200": "1:50", "leverage100": "N/A", "baseCurrency": "USD", "pricingCurrency": "TRY", "marginType": "Floating"}, {"product": "USDSEK", "name": "US Dollar/Swedish Krone", "contractSize": 100000, "pipValuePerLot": "10 SEK", "leverage400": "1:50", "leverage200": "1:50", "leverage100": "N/A", "baseCurrency": "USD", "pricingCurrency": "SEK", "marginType": "Floating"}, {"product": "USDZAR", "name": "US Dollar/South Africa Rand", "contractSize": 100000, "pipValuePerLot": "10 ZAR", "leverage400": "1:50", "leverage200": "1:50", "leverage100": "N/A", "baseCurrency": "USD", "pricingCurrency": "ZAR", "marginType": "Floating"}, {"product": "XAUUSD", "name": "Spot Gold/US Dollar", "contractSize": 100, "pipValuePerLot": "10 USD", "leverage400": "1:400", "leverage200": "1:200", "leverage100": "N/A", "baseCurrency": "", "pricingCurrency": "USD", "marginType": "Floating"}, {"product": "XAUEUR", "name": "Spot Gold/Euro", "contractSize": 100, "pipValuePerLot": "10 EUR", "leverage400": "1:400", "leverage200": "1:200", "leverage100": "N/A", "baseCurrency": "", "pricingCurrency": "EUR", "marginType": "Floating"}, {"product": "XAUAUD", "name": "Spot Gold/Australian Dollar", "contractSize": 100, "pipValuePerLot": "10 AUD", "leverage400": "1:400", "leverage200": "1:200", "leverage100": "N/A", "baseCurrency": "", "pricingCurrency": "AUD", "marginType": "Floating"}, {"product": "XAGUSD", "name": "Spot Silver/US Dollar", "contractSize": 5000, "pipValuePerLot": "50 USD", "leverage400": "1:100", "leverage200": "1:100", "leverage100": "N/A", "baseCurrency": "", "pricingCurrency": "USD", "marginType": "Floating"}, {"product": "USOIL.MMMYY", "name": "US WTI Crude Oil Futures Contract (CFD)", "contractSize": 1000, "pipValuePerLot": "10 USD", "leverage400": "500 USD", "leverage200": "250 USD", "leverage100": "N/A", "baseCurrency": "", "pricingCurrency": "USD", "marginType": "Fixed"}, {"product": "UKOIL.MMMYY", "name": "UK BRENT Crude Oil Futures Contract (CFD)", "contractSize": 1000, "pipValuePerLot": "10 USD", "leverage400": "500 USD", "leverage200": "250 USD", "leverage100": "N/A", "baseCurrency": "", "pricingCurrency": "USD", "marginType": "Fixed"}, {"product": "WTI", "name": "US WTI Crude Oil Spot Contract", "contractSize": 1000, "pipValuePerLot": "10 USD", "leverage400": "500 USD", "leverage200": "250 USD", "leverage100": "N/A", "baseCurrency": "", "pricingCurrency": "USD", "marginType": "Fixed"}, {"product": "BRENT", "name": "UK BRENT Crude Oil Spot Contract", "contractSize": 1000, "pipValuePerLot": "10 USD", "leverage400": "500 USD", "leverage200": "250 USD", "leverage100": "N/A", "baseCurrency": "", "pricingCurrency": "USD", "marginType": "Fixed"}, {"product": "CHI50", "name": "FTSE China A50 Spot Index (CFD)", "contractSize": 10, "pipValuePerLot": "10 USD", "leverage400": "1:100", "leverage200": "1:100", "leverage100": "N/A", "baseCurrency": "", "pricingCurrency": "USD", "marginType": "Floating"}, {"product": "HK50", "name": "Hong Kong HS50 Spot Index (CFD)", "contractSize": 50, "pipValuePerLot": "50 HKD", "leverage400": "1:100", "leverage200": "1:100", "leverage100": "N/A", "baseCurrency": "", "pricingCurrency": "HKD", "marginType": "Floating"}, {"product": "HKCH50", "name": "Hong Kong China H-Shares Spot Index (CFD)", "contractSize": 50, "pipValuePerLot": "50 HKD", "leverage400": "1:100", "leverage200": "1:100", "leverage100": "N/A", "baseCurrency": "", "pricingCurrency": "HKD", "marginType": "Floating"}, {"product": "AUS200", "name": "Australian S&P/ASX 200 Spot Index (CFD)", "contractSize": 20, "pipValuePerLot": "20 AUD", "leverage400": "1:100", "leverage200": "1:100", "leverage100": "N/A", "baseCurrency": "", "pricingCurrency": "AUD", "marginType": "Floating"}, {"product": "EU50", "name": "Euro Stoxx 50 Spot Index (CFD)", "contractSize": 30, "pipValuePerLot": "30 EUR", "leverage400": "1:100", "leverage200": "1:100", "leverage100": "N/A", "baseCurrency": "", "pricingCurrency": "EUR", "marginType": "Floating"}, {"product": "ESP35", "name": "Spain IBEX 35 Spot Index (CFD)", "contractSize": 10, "pipValuePerLot": "10 EUR", "leverage400": "1:100", "leverage200": "1:100", "leverage100": "N/A", "baseCurrency": "", "pricingCurrency": "EUR", "marginType": "Floating"}, {"product": "FRA40", "name": "French CAC 40 Spot Index (CFD)", "contractSize": 20, "pipValuePerLot": "10 EUR", "leverage400": "1:100", "leverage200": "1:100", "leverage100": "N/A", "baseCurrency": "", "pricingCurrency": "EUR", "marginType": "Floating"}, {"product": "GER30", "name": "German 30 Spot Index (CFD)", "contractSize": 10, "pipValuePerLot": "10 EUR", "leverage400": "1:100", "leverage200": "1:100", "leverage100": "N/A", "baseCurrency": "", "pricingCurrency": "EUR", "marginType": "Floating"}, {"product": "IT40", "name": "Italy MIB 40 Spot Index (CFD)", "contractSize": 10, "pipValuePerLot": "10 EUR", "leverage400": "1:100", "leverage200": "1:100", "leverage100": "N/A", "baseCurrency": "", "pricingCurrency": "EUR", "marginType": "Floating"}, {"product": "JP225", "name": "Japan Nikkei 225 Spot Index (CFD)", "contractSize": 10, "pipValuePerLot": "10 USD", "leverage400": "1:100", "leverage200": "1:100", "leverage100": "N/A", "baseCurrency": "", "pricingCurrency": "USD", "marginType": "Floating"}, {"product": "UK100", "name": "UK FTSE 100 Spot Index (CFD)", "contractSize": 10, "pipValuePerLot": "10 GBP", "leverage400": "1:100", "leverage200": "1:100", "leverage100": "N/A", "baseCurrency": "", "pricingCurrency": "GBP", "marginType": "Floating"}, {"product": "US30", "name": "US Dow Jones 30 Spot Index (CFD)", "contractSize": 10, "pipValuePerLot": "10 USD", "leverage400": "1:100", "leverage200": "1:100", "leverage100": "N/A", "baseCurrency": "", "pricingCurrency": "USD", "marginType": "Floating"}, {"product": "NAS100", "name": "US NASDAQ 100 Spot Index (CFD)", "contractSize": 20, "pipValuePerLot": "10 USD", "leverage400": "1:100", "leverage200": "1:100", "leverage100": "N/A", "baseCurrency": "", "pricingCurrency": "USD", "marginType": "Floating"}, {"product": "SPX500", "name": "US S&P 500 Spot Index (CFD)", "contractSize": 50, "pipValuePerLot": "10 USD", "leverage400": "1:100", "leverage200": "1:100", "leverage100": "N/A", "baseCurrency": "", "pricingCurrency": "USD", "marginType": "Floating"}, {"product": "US2000", "name": "US Russell 2000 Spot Index (CFD)", "contractSize": 50, "pipValuePerLot": "10 USD", "leverage400": "1:100", "leverage200": "1:100", "leverage100": "N/A", "baseCurrency": "", "pricingCurrency": "USD", "marginType": "Floating"}, {"product": "USDX_MMMYY", "name": "US Dollar Futures Index (CFD)", "contractSize": 1000, "pipValuePerLot": "10 USD", "leverage400": "1:50", "leverage200": "1:50", "leverage100": "N/A", "baseCurrency": "", "pricingCurrency": "USD", "marginType": "Floating"}];</script></head><body class="min-h-screen bg-custom"><div class="container mx-auto px-4 py-8 max-w-6xl"><!-- 页面标题 --><div class="text-center mb-8"><h1 class="text-4xl font-bold text-gray-800 mb-2"><i class="fas fa-calculator text-blue-600 mr-3"></i>PnL Calculator</h1><p class="text-gray-600 text-lg">Calculate Profits, Losses and Margin Precisely</p></div><!-- 主要内容区域 --><div class="bg-white rounded-2xl shadow-xl overflow-hidden"><!-- 表单区域 --><div class="p-8"><form class="space-y-6" id="pnlForm"><!-- 计算选项 --><div class="grid grid-cols-1 md:grid-cols-2 gap-6"><!-- 多订单选项 --><div class="flex items-center"><input class="w-5 h-5 text-blue-600 focus:ring-blue-500 border-gray-300 rounded" id="multipleOrders" type="checkbox"/><label class="ml-2 text-gray-700 font-medium" for="multipleOrders">Calculate Multiple Orders</label></div><!-- 仓位计算选项 --><div class="flex items-center"><input class="w-5 h-5 text-blue-600 focus:ring-blue-500 border-gray-300 rounded" id="positionCalculation" type="checkbox"/><label class="ml-2 text-gray-700 font-medium" for="positionCalculation">Include Position Calculations</label></div></div><!-- 余额输入框 (默认隐藏) --><div class="hidden" id="balanceContainer"><label class="block text-gray-700 font-semibold mb-2" for="balance"><i class="fas fa-wallet text-green-600 mr-2"></i>Account Balance (USD)</label><input class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" id="balance" min="0" placeholder="0.00" step="0.01" type="number"/></div><div class="hidden" id="globalCommissionContainer"><label class="block text-gray-700 font-semibold mb-2" for="globalCommissionRate"><i class="fas fa-receipt text-blue-600 mr-2"></i>Commission per lot</label><input class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" id="globalCommissionRate" placeholder="e.g., 7" step="any" type="number"/><p class="text-gray-500 text-sm mt-1">Commission per order = Lots × Commission per lot</p></div><!-- 订单管理按钮 (默认隐藏) --><div class="hidden" id="orderManagement"><div class="flex justify-between items-center"><h3 class="text-lg font-semibold text-gray-800"><i class="fas fa-list-alt text-blue-600 mr-2"></i>Order List</h3><button class="bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-lg transition-all" id="addOrderBtn" type="button"><i class="fas fa-plus mr-1"></i>Add Order</button></div></div><!-- 订单容器 --><div id="ordersContainer"><!-- 默认订单表单 --><div class="order-form bg-gray-50 p-6 rounded-xl mb-6" data-order-id="1"><div class="flex justify-between items-center mb-4"><h4 class="font-semibold text-gray-800">Order #1</h4><button class="remove-order-btn text-red-500 hover:text-red-700 transition-colors hidden" data-order-id="1" type="button"><i class="fas fa-trash"></i>Remove</button></div><!-- 产品搜索和选择 --><div class="relative mb-6"><label class="block text-gray-700 font-semibold mb-2" for="productSearch_1"><i class="fas fa-search text-blue-600 mr-2"></i>Product Search</label><div class="relative"><input class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" id="productSearch_1" placeholder="Search by product code or name..." type="text"/><div class="absolute w-full bg-white rounded-lg shadow-lg mt-1 z-10 max-h-60 overflow-y-auto hidden" id="searchResults_1"><!-- 搜索结果将动态显示在这里 --></div></div><div class="mt-2 p-3 bg-blue-50 rounded-lg hidden" id="selectedProduct_1"><div class="flex justify-between items-center"><div><span class="font-bold text-blue-800" id="productCode_1"></span><span class="text-gray-600 ml-2" id="productName_1"></span></div><button class="clear-product-btn text-red-500 hover:text-red-700" data-order-id="1" type="button"><i class="fas fa-times"></i></button></div></div></div><!-- 产品信息显示 --><div class="grid grid-cols-1 md:grid-cols-3 gap-4 p-4 bg-white rounded-lg hidden mb-6" id="productInfo_1"><div><p class="text-sm text-gray-600">Contract Size</p><p class="font-semibold" id="contractSize_1"></p></div><div><p class="text-sm text-gray-600">Pip Value per Lot</p><p class="font-semibold" id="pipValue_1"></p></div><div><p class="text-sm text-gray-600">Pricing Currency</p><p class="font-semibold" id="pricingCurrency_1"></p></div><div><p class="text-sm text-gray-600">Base Currency</p><p class="font-semibold" id="baseCurrency_1"></p></div><div><p class="text-sm text-gray-600">Margin Type</p><p class="font-semibold capitalize" id="marginType_1"></p></div><div><p class="text-sm text-gray-600">Margin per Lot (for selected leverage)</p><p class="font-semibold" id="perLotMargin_1"></p></div></div><!-- 交易详情 --><div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"><div><label class="block text-gray-700 font-semibold mb-2" for="tradeType_1"><i class="fas fa-exchange-alt text-green-600 mr-2"></i>Trade Type</label><select class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" disabled="" id="tradeType_1"><option value="buy">Buy</option><option value="sell">Sell</option></select></div><div><label class="block text-gray-700 font-semibold mb-2" for="leverage_1"><i class="fas fa-percentage text-purple-600 mr-2"></i>Select Leverage</label><select class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all leverage-select" disabled="" id="leverage_1"><option value="400">1:400</option><option value="200">1:200</option><option value="100">1:100</option></select></div></div><div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6"><div><label class="block text-gray-700 font-semibold mb-2" for="lots_1"><i class="fas fa-layer-group text-orange-600 mr-2"></i>Lots</label><input class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" disabled="" id="lots_1" min="0.01" placeholder="0.01" step="0.01" type="number"/></div><div><label class="block text-gray-700 font-semibold mb-2" for="openPrice_1"><i class="fas fa-arrow-up text-green-600 mr-2"></i>Open Price</label><input class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" disabled="" id="openPrice_1" min="0" placeholder="0.00000" step="0.00001" type="number"/></div><div><label class="block text-gray-700 font-semibold mb-2" for="closePrice_1"><i class="fas fa-arrow-down text-red-600 mr-2"></i>Close Price</label><input class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" disabled="" id="closePrice_1" min="0" placeholder="0.00000" step="0.00001" type="number"/></div></div><!-- 汇率输入 --><div class="mb-4 hidden" id="exchangeRateContainer_1"><label class="block text-gray-700 font-semibold mb-2" for="exchangeRate_1"><i class="fas fa-money-bill-wave text-teal-600 mr-2"></i>Exchange Rate Required</label><input class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" id="exchangeRate_1" min="0.00001" placeholder="Enter exchange rate" step="0.00001" type="number"/><p class="text-xs text-amber-600 mt-1 font-medium" id="exchangeRateHint_1">Please enter the exchange rate</p></div><!-- EURUSD汇率输入 (仅特定产品显示) --><div class="hidden" id="eurusdRateContainer_1"><label class="block text-gray-700 font-semibold mb-2" for="eurusdRate_1"><i class="fas fa-money-bill-wave text-purple-600 mr-2"></i>EURUSD Exchange Rate Required</label><input class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all" id="eurusdRate_1" min="0.00001" placeholder="Enter EURUSD rate" step="0.00001" type="number"/><p class="text-xs text-amber-600 mt-1 font-medium">Please enter the EURUSD exchange rate for margin conversion to USD</p></div></div></div><!-- 计算按钮 --><div class="text-center"><button class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg transition-all transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed" disabled="" id="calculateBtn" type="button"><i class="fas fa-calculator mr-2"></i>Calculate PnL &amp; Margin</button></div></form></div><!-- 结果显示区域 --><div class="bg-gradient-to-r from-blue-600 to-indigo-700 text-white p-8 hidden" id="resultsSection"><h2 class="text-2xl font-bold mb-6 text-center"><i class="fas fa-chart-line mr-2"></i>Calculation Results</h2><!-- 汇率提示 --><div class="bg-yellow-500 bg-opacity-20 rounded-xl p-4 backdrop-blur-sm mb-6 hidden" id="exchangeRateNote"><p class="text-sm flex items-center"><i class="fas fa-info-circle mr-2"></i>Please be advised that due to exchange rate fluctuations, the final amount may differ slightly from the actual order total.</p></div><!-- 对冲仓位提示 --><div class="bg-yellow-500 bg-opacity-20 rounded-xl p-4 backdrop-blur-sm mb-6 hidden" id="hedgeNotice"><h3 class="text-lg font-semibold flex items-center"><i class="fas fa-info-circle mr-2"></i>Hedge Position Detected</h3><p class="text-sm mt-2" id="hedgeDetails"></p></div><!-- 多订单汇总结果 --><div class="bg-white bg-opacity-10 rounded-xl p-6 backdrop-blur-sm mb-8 hidden" id="summaryResults"><h3 class="text-lg font-semibold mb-4"><i class="fas fa-calculator-alt mr-2"></i>Total Summary</h3><div class="grid grid-cols-1 md:grid-cols-3 gap-6"><!-- Total PnL (excl. commission) --><div><div class="text-sm opacity-80">Total PnL (excl. commission)</div><div class="text-3xl font-bold" id="totalPnLNoCommissionInUSD"></div></div><!-- Total PnL (incl. commission) --><div><div class="text-sm opacity-80">Total PnL (incl. commission)</div><div class="text-3xl font-bold" id="totalPnLWithCommissionInUSD"></div></div><!-- Total Margin in USD --><div><p class="text-sm opacity-80">Total Margin in USD</p><p class="text-3xl font-bold" id="totalMarginInUSD"></p></div></div></div><!-- 单个订单结果 --><div class="space-y-6" id="individualResults"><!-- 单个结果将动态插入到这里 --></div><!-- 仓位计算结果 (默认隐藏) --><div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-8 hidden" id="positionResults"><div class="bg-white bg-opacity-10 rounded-xl p-6 backdrop-blur-sm"><h3 class="text-lg font-semibold mb-4"><i class="fas fa-money-check-alt mr-2"></i>Equity</h3><div class="text-3xl font-bold" id="equity"></div><div class="text-sm opacity-80 mt-1">Balance + Total PnL</div></div><div class="bg-white bg-opacity-10 rounded-xl p-6 backdrop-blur-sm"><h3 class="text-lg font-semibold mb-4"><i class="fas fa-wallet mr-2"></i>Free Margin</h3><div class="text-3xl font-bold" id="freeMargin"></div><div class="text-sm opacity-80 mt-1">Equity - Total Margin</div></div><div class="bg-white bg-opacity-10 rounded-xl p-6 backdrop-blur-sm"><h3 class="text-lg font-semibold mb-4"><i class="fas fa-percent mr-2"></i>Margin Ratio</h3><div class="text-3xl font-bold" id="marginRatio"></div><div class="text-sm opacity-80 mt-1">Equity / Total Margin × 100%</div></div></div><!-- 详细计算过程 --><div class="mt-8 bg-white bg-opacity-10 rounded-xl p-6 backdrop-blur-sm"><h3 class="text-lg font-semibold mb-4"><i class="fas fa-calculator mr-2"></i>Calculation Details</h3><div class="space-y-4 text-sm" id="calculationDetails"><!-- 计算过程将动态显示在这里 --></div></div></div></div><!-- 最近计算历史 --><div class="mt-8 bg-white rounded-2xl shadow-xl overflow-hidden"><div class="p-6 border-b border-gray-200"><h2 class="text-xl font-bold text-gray-800"><i class="fas fa-history text-blue-600 mr-2"></i>Recent Calculations</h2></div><div class="p-6 max-h-60 overflow-y-auto" id="historyList"><p class="text-gray-500 text-center italic" id="noHistory">No calculation history yet</p><!-- 历史记录将动态显示在这里 --></div></div><!-- 页脚 --><div class="mt-8 text-center text-gray-600 py-4"><p>This page is developed by ATFX HKCS Team</p></div></div><script>// 全局变量
        let calculationHistory = [];
        let orderCount = 1;
        let currentLeverage = "400"; // 默认杠杆
        
        // 需要EURUSD汇率的产品列表
        const productsNeedingEurusd = ['EURHUF', 'EURPLN', 'XAUEUR'];
            // Futures Products (hedged portion margin = 50%)
            const futuresProducts = ['GOLD_MMMYY','HG_MMMYY','USOIL.MMMYY','UKOIL.MMMYY','NGAS.MMMYY','USDX_MMMYY'];
            // Products whose hedged portion keeps 50% margin
            const fiftyPercentHedgeProducts = ['GOLD_MMMYY','HG_MMMYY','USOIL.MMMYY','UKOIL.MMMYY','NGAS.MMMYY','USDX_MMMYY'];
        
        // 页面加载后初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 绑定事件监听器
            document.getElementById('addOrderBtn').addEventListener('click', addNewOrder);
            document.getElementById('calculateBtn').addEventListener('click', calculateAllOrders);
            document.getElementById('positionCalculation').addEventListener('change', togglePositionCalculation);
            document.getElementById('multipleOrders').addEventListener('change', toggleMultipleOrders);
            
            // 初始化杠杆同步
            document.addEventListener('change', function(e) {
                if (e.target.classList.contains('leverage-select') && !e.target.disabled) {
                    syncLeverageAcrossOrders(e.target.value);
                }
            });
            
            // 初始化第一个订单
            initOrderEvents(1);
            
            // 为删除按钮添加事件委托
            document.getElementById('ordersContainer').addEventListener('click', function(e) {
                if (e.target.closest('.remove-order-btn')) {
                    const btn = e.target.closest('.remove-order-btn');
                    const orderId = parseInt(btn.getAttribute('data-order-id'));
                    removeOrder(orderId);
                }
            });
            
            // 添加输入事件监听器以更新计算按钮状态
            document.addEventListener('input', updateCalculateButtonState);
            document.addEventListener('change', updateCalculateButtonState);
        });
        
        // 在所有订单间同步杠杆
        function syncLeverageAcrossOrders(leverageValue) {
            currentLeverage = leverageValue;
            
            // 更新所有杠杆下拉框
            const leverageSelects = document.querySelectorAll('.leverage-select');
            leverageSelects.forEach(select =>{
                // 如果选择框已设置为此值或禁用，则跳过
                if (select.value !== leverageValue && !select.disabled) {
                    select.value = leverageValue;
                    
                    // 更新此订单的每手保证金显示
                    const orderId = select.id.split('_')[1];
                    updatePerLotMargin(orderId);
                }
            });
        }
        
        // 切换多订单功能
        function toggleMultipleOrders() {
            const multipleOrdersEnabled = this.checked;
            const orderManagement = document.getElementById('orderManagement');
            const removeButtons = document.querySelectorAll('.remove-order-btn');
            
            if (multipleOrdersEnabled) {
                orderManagement.classList.remove('hidden');
                // 显示所有订单的删除按钮，除非只有一个订单
                if (removeButtons.length >1) {
                    removeButtons.forEach(btn =>btn.classList.remove('hidden'));
                } else if (removeButtons.length === 1) {
                    removeButtons[0].classList.add('hidden');
                }
            } else {
                orderManagement.classList.add('hidden');
                // 隐藏所有删除按钮
                removeButtons.forEach(btn =>btn.classList.add('hidden'));
                
                // 移除额外订单，只保留第一个
                const orderForms = document.querySelectorAll('.order-form');
                if (orderForms.length >1) {
                    for (let i = orderForms.length - 1; i >0; i--) {
                        orderForms[i].remove();
                    }
                    orderCount = 1;
                }
            }
            
            updateCalculateButtonState();
        }
        
        // 切换仓位计算部分
        function togglePositionCalculation() {
            const balanceContainer = document.getElementById('balanceContainer');
            if (this.checked) {
                balanceContainer.classList.remove('hidden');
            } else {
                balanceContainer.classList.add('hidden');
            }
            const globalCommission = document.getElementById('globalCommissionContainer');
            if (globalCommission) { if (this.checked) globalCommission.classList.remove('hidden'); else globalCommission.classList.add('hidden'); }
            updateCalculateButtonState();
        }
        
        // 添加新订单表单
	function addNewOrder() {
    	// Keep numbering contiguous after deletions: next order is (current forms count + 1)
    	orderCount = document.querySelectorAll('.order-form').length + 1;
    	const ordersContainer = document.getElementById('ordersContainer');

            
            // 克隆第一个订单表单
            const firstOrder = document.querySelector('.order-form');
            const newOrder = firstOrder.cloneNode(true);
            
            // 更新新订单的ID和属性
            newOrder.setAttribute('data-order-id', orderCount);
            newOrder.querySelector('h4').textContent = `Order #${orderCount}`;
            newOrder.querySelector('.remove-order-btn').setAttribute('data-order-id', orderCount);
            
            // 如果启用了多订单，显示删除按钮
            if (document.getElementById('multipleOrders').checked) {
                newOrder.querySelector('.remove-order-btn').classList.remove('hidden');
            }
            
            // 更新新订单中所有元素的ID
            const elements = newOrder.querySelectorAll('[id]');
            elements.forEach(element =>{
                const id = element.getAttribute('id');
                if (id) {
                    const newId = id.replace(/_\d+$/, `_${orderCount}`);
                    element.setAttribute('id', newId);
                }
            });
            
            // 更新label的for属性
            const labels = newOrder.querySelectorAll('label[for]');
            labels.forEach(label =>{
                const forAttr = label.getAttribute('for');
                if (forAttr) {
                    const newFor = forAttr.replace(/_\d+$/, `_${orderCount}`);
                    label.setAttribute('for', newFor);
                }
            });
            
            // 设置杠杆以匹配当前选择
            const leverageSelect = newOrder.querySelector('.leverage-select');
            leverageSelect.value = currentLeverage;
            
            // 重置表单值
            newOrder.querySelector(`[id^="selectedProduct_"]`).classList.add('hidden');
            newOrder.querySelector(`[id^="productInfo_"]`).classList.add('hidden');
            newOrder.querySelector(`[id^="exchangeRateContainer_"]`).classList.add('hidden');
            newOrder.querySelector(`[id^="eurusdRateContainer_"]`).classList.add('hidden');
            
            // 将新订单添加到容器
            ordersContainer.appendChild(newOrder);
            
            // 初始化新订单的事件
            initOrderEvents(orderCount);
            
            // 重置新订单的表单字段
            resetOrderForm(orderCount);
            
            updateCalculateButtonState();
        }
        
        // 初始化订单表单的事件
        function initOrderEvents(orderId) {
    // limit queries within the current order form and add null-safety
    const orderRoot = document.querySelector(`.order-form[data-order-id="${orderId}"]`);
    if (!orderRoot) return;

    // product search input
    const searchInput = orderRoot.querySelector(`#productSearch_${orderId}`);
    if (!searchInput) return;
    const newSearchInput = searchInput.cloneNode(true);
    searchInput.parentNode.replaceChild(newSearchInput, searchInput);
    newSearchInput.addEventListener('input', function() {
        handleProductSearch(orderId, this.value);
    });

    // clear selected product
    const clearBtn = orderRoot.querySelector(`.clear-product-btn[data-order-id="${orderId}"]`);
    if (clearBtn) {
        const newClearBtn = clearBtn.cloneNode(true);
        clearBtn.parentNode.replaceChild(newClearBtn, clearBtn);
        newClearBtn.addEventListener('click', function() {
            clearSelectedProduct(orderId);
            updateCalculateButtonState();
        });
    }

    // click outside to hide search results (scoped)
    document.addEventListener('click', function(e) {
        const searchBox = orderRoot.querySelector(`#productSearch_${orderId}`);
        const container = searchBox ? searchBox.closest('.relative') : null;
        if (container && !container.contains(e.target)) {
            const list = document.getElementById(`searchResults_${orderId}`);
            if (list) list.classList.add('hidden');
        }
    });
}

        
        // 移除订单
        function removeOrder(orderId) {
            const orderForm = document.querySelector(`.order-form[data-order-id="${orderId}"]`);
            if (orderForm) {
                orderForm.remove();
                
                // 如果启用了多订单，更新订单编号
                if (document.getElementById('multipleOrders').checked) {
                    const remainingOrders = Array.from(document.querySelectorAll('.order-form'));
                    remainingOrders.forEach((order, index) =>{
                        const newOrderId = index + 1;
                        const oldOrderId = order.getAttribute('data-order-id');
                        
                        // 如果已具有正确ID，则跳过
                        if (parseInt(oldOrderId) === newOrderId) return;
                        
                        // 更新数据属性
                        order.setAttribute('data-order-id', newOrderId);
                        
                        // 更新标题
                        order.querySelector('h4').textContent = `Order #${newOrderId}`;
                        
                        // 更新删除按钮
                        const removeBtn = order.querySelector('.remove-order-btn');
                        if (removeBtn) {
                            removeBtn.setAttribute('data-order-id', newOrderId);
                        }
                        
                        // 更新订单中所有元素的ID
                        const elements = order.querySelectorAll('[id]');
                        elements.forEach(element =>{
                            const id = element.getAttribute('id');
                            if (id) {
                                const newId = id.replace(`_${oldOrderId}`, `_${newOrderId}`);
                                element.setAttribute('id', newId);
                            }
                        });
                        
                        // 更新label的for属性
                        const labels = order.querySelectorAll('label[for]');
                        labels.forEach(label =>{
                            const forAttr = label.getAttribute('for');
                            if (forAttr) {
                                const newFor = forAttr.replace(`_${oldOrderId}`, `_${newOrderId}`);
                                label.setAttribute('for', newFor);
                            }
                        });
                        
                        // 使用新ID重新初始化此订单的事件
                        initOrderEvents(newOrderId);
                    });
                    
                    orderCount = remainingOrders.length;
                    
                    // 如果只剩下一个订单，隐藏删除按钮
                    if (remainingOrders.length === 1) {
                        remainingOrders[0].querySelector('.remove-order-btn').classList.add('hidden');
                    }
                }
                
                updateCalculateButtonState();
            }
        }
        
        // 重置订单表单
        function resetOrderForm(orderId) {
            document.getElementById(`productSearch_${orderId}`).value = '';
            document.getElementById(`tradeType_${orderId}`).disabled = true;
            document.getElementById(`leverage_${orderId}`).disabled = true;
            document.getElementById(`lots_${orderId}`).disabled = true;
            document.getElementById(`openPrice_${orderId}`).disabled = true;
            document.getElementById(`closePrice_${orderId}`).disabled = true;
            document.getElementById(`lots_${orderId}`).value = '';
            document.getElementById(`openPrice_${orderId}`).value = '';
            document.getElementById(`closePrice_${orderId}`).value = '';
            document.getElementById(`exchangeRate_${orderId}`).value = '';
            document.getElementById(`eurusdRate_${orderId}`).value = '';
        }
        
        // 处理特定订单的产品搜索
        function handleProductSearch(orderId, searchTerm) {
            const resultsContainer = document.getElementById(`searchResults_${orderId}`);
            resultsContainer.innerHTML = '';
            
            if (searchTerm.length< 1) {
                resultsContainer.classList.add('hidden');
                return;
            }
            
            // 搜索匹配的产品
            const matchingProducts = productsData.filter(product =>{
                return product.product.toLowerCase().includes(searchTerm.toLowerCase()) || 
                       product.name.toLowerCase().includes(searchTerm.toLowerCase());
            });
            
            if (matchingProducts.length === 0) {
                resultsContainer.innerHTML = '<div class="p-3 text-gray-500">No matching products found</div>';
                resultsContainer.classList.remove('hidden');
                return;
            }
            
            // 显示搜索结果
            matchingProducts.forEach(product =>{
                const resultItem = document.createElement('div');
                resultItem.className = 'p-3 hover:bg-blue-50 cursor-pointer transition-colors border-b border-gray-100';
                resultItem.innerHTML = `<div class="font-semibold text-gray-800">${product.product}</div><div class="text-sm text-gray-600">${product.name}</div><div class="text-xs text-gray-500 mt-1">Margin Type: ${product.marginType} | Margin per lot at 1:400 leverage: ${product.leverage400}</div>`;
                resultItem.addEventListener('click', () =>{
                    selectProduct(orderId, product);
                    updateCalculateButtonState();
                });
                resultsContainer.appendChild(resultItem);
            });
            
            resultsContainer.classList.remove('hidden');
        }
        
        // 为特定订单选择产品
        function selectProduct(orderId, product) {
            // 更新UI
            document.getElementById(`productCode_${orderId}`).textContent = product.product;
            document.getElementById(`productName_${orderId}`).textContent = product.name;
            document.getElementById(`selectedProduct_${orderId}`).classList.remove('hidden');
            document.getElementById(`searchResults_${orderId}`).classList.add('hidden');
            document.getElementById(`productSearch_${orderId}`).value = '';
            
            // 在元素上存储产品数据供以后使用
            document.getElementById(`selectedProduct_${orderId}`).setAttribute('data-product', JSON.stringify(product));
            
            // 显示产品信息
            document.getElementById(`contractSize_${orderId}`).textContent = product.contractSize.toLocaleString();
            document.getElementById(`pipValue_${orderId}`).textContent = product.pipValuePerLot;
            document.getElementById(`pricingCurrency_${orderId}`).textContent = product.pricingCurrency;
            document.getElementById(`baseCurrency_${orderId}`).textContent = product.baseCurrency || '-';
            document.getElementById(`marginType_${orderId}`).textContent = product.marginType;
            
            // 根据当前杠杆更新每手保证金
            updatePerLotMargin(orderId);
            
            document.getElementById(`productInfo_${orderId}`).classList.remove('hidden');
            
            // 确定是否显示汇率输入
            const pricingCurrency = product.pricingCurrency;
            const exchangeRateContainer = document.getElementById(`exchangeRateContainer_${orderId}`);
            const exchangeRateHint = document.getElementById(`exchangeRateHint_${orderId}`);
            
            if (pricingCurrency !== 'USD') {
                exchangeRateContainer.classList.remove('hidden');
                exchangeRateHint.textContent = `Required: 1 ${pricingCurrency} = ? USD`;
                document.getElementById(`exchangeRate_${orderId}`).setAttribute('placeholder', `1 ${pricingCurrency} = X USD`);
            } else {
                exchangeRateContainer.classList.add('hidden');
            }
            
            // 对于特定产品，显示EURUSD汇率输入
            const eurusdRateContainer = document.getElementById(`eurusdRateContainer_${orderId}`);
            if (productsNeedingEurusd.includes(product.product)) {
                eurusdRateContainer.classList.remove('hidden');
            } else {
                eurusdRateContainer.classList.add('hidden');
            }
            
            // 启用表单字段
            document.getElementById(`tradeType_${orderId}`).disabled = false;
            document.getElementById(`leverage_${orderId}`).disabled = false;
            document.getElementById(`lots_${orderId}`).disabled = false;
            document.getElementById(`openPrice_${orderId}`).disabled = false;
            document.getElementById(`closePrice_${orderId}`).disabled = false;
        }
        
        // 清除特定订单的选定产品
        function clearSelectedProduct(orderId) {
            document.getElementById(`selectedProduct_${orderId}`).classList.add('hidden');
            document.getElementById(`productInfo_${orderId}`).classList.add('hidden');
            document.getElementById(`exchangeRateContainer_${orderId}`).classList.add('hidden');
            document.getElementById(`eurusdRateContainer_${orderId}`).classList.add('hidden');
            
            // 禁用表单字段
            document.getElementById(`tradeType_${orderId}`).disabled = true;
            document.getElementById(`leverage_${orderId}`).disabled = true;
            document.getElementById(`lots_${orderId}`).disabled = true;
            document.getElementById(`openPrice_${orderId}`).disabled = true;
            document.getElementById(`closePrice_${orderId}`).disabled = true;
        }
        
        // 当杠杆变化时更新"每手保证金"显示
        function updatePerLotMargin(orderId) {
            const productElement = document.getElementById(`selectedProduct_${orderId}`);
            if (!productElement || productElement.classList.contains('hidden')) return;
            
            const product = JSON.parse(productElement.getAttribute('data-product'));
            const selectedLeverage = document.getElementById(`leverage_${orderId}`).value;
            let perLotMargin = '';
            
            switch(selectedLeverage) {
                case '400':
                    perLotMargin = product.leverage400;
                    break;
                case '200':
                    perLotMargin = product.leverage200;
                    break;
                case '100':
                    perLotMargin = product.leverage100;
                    break;
            }
            
            document.getElementById(`perLotMargin_${orderId}`).textContent = perLotMargin;
        }
        
        // 根据表单有效性更新计算按钮状态
        function updateCalculateButtonState() {
            const calculateBtn = document.getElementById('calculateBtn');
            const orderForms = document.querySelectorAll('.order-form');
            let allOrdersValid = true;
            
            // 检查每个订单的有效数据
            orderForms.forEach(orderForm =>{
                const orderId = orderForm.getAttribute('data-order-id');
                const productSelected = !document.getElementById(`selectedProduct_${orderId}`).classList.contains('hidden');
                
                // 检查是否选择了产品
                if (!productSelected) {
                    allOrdersValid = false;
                    return; // 退出当前订单的循环
                }
                
                // 获取产品数据
                const productElement = document.getElementById(`selectedProduct_${orderId}`);
                const product = JSON.parse(productElement.getAttribute('data-product'));
                
                // 获取表单值
                const lotsInput = document.getElementById(`lots_${orderId}`);
                const openPriceInput = document.getElementById(`openPrice_${orderId}`);
                const closePriceInput = document.getElementById(`closePrice_${orderId}`);
                
                // 检查必填字段是否有值
                if (!lotsInput.value || !openPriceInput.value || !closePriceInput.value) {
                    allOrdersValid = false;
                    return;
                }
                
                // 验证数值
                const lotsNum = parseFloat(lotsInput.value);
                const openPriceNum = parseFloat(openPriceInput.value);
                const closePriceNum = parseFloat(closePriceInput.value);
                
                if (isNaN(lotsNum) || isNaN(openPriceNum) || isNaN(closePriceNum) || 
                    lotsNum<= 0 || openPriceNum<= 0 || closePriceNum<= 0) {
                    allOrdersValid = false;
                    return;
                }
                
                // 检查是否需要汇率且有效
                if (product.pricingCurrency !== 'USD') {
                    const exchangeRateInput = document.getElementById(`exchangeRate_${orderId}`);
                    if (!exchangeRateInput.value) {
                        allOrdersValid = false;
                        return;
                    }
                    
                    const exchangeRateNum = parseFloat(exchangeRateInput.value);
                    if (isNaN(exchangeRateNum) || exchangeRateNum<= 0) {
                        allOrdersValid = false;
                        return;
                    }
                }
                
                // 对于特定产品，检查EURUSD汇率是否有效
                if (productsNeedingEurusd.includes(product.product)) {
                    const eurusdRateInput = document.getElementById(`eurusdRate_${orderId}`);
                    if (!eurusdRateInput.value) {
                        allOrdersValid = false;
                        return;
                    }
                    
                    const eurusdRateNum = parseFloat(eurusdRateInput.value);
                    if (isNaN(eurusdRateNum) || eurusdRateNum<= 0) {
                        allOrdersValid = false;
                        return;
                    }
                }
            });
            
            // 如果启用了仓位计算，检查账户余额
            const positionCalculationEnabled = document.getElementById('positionCalculation').checked;
            if (positionCalculationEnabled) {
                const balanceInput = document.getElementById('balance');
                if (!balanceInput.value) {
                    allOrdersValid = false;
                } else {
                    const balanceNum = parseFloat(balanceInput.value);
                    if (isNaN(balanceNum) || balanceNum<= 0) {
                        allOrdersValid = false;
                    }
                }
            }
            
            // 更新按钮状态
            calculateBtn.disabled = !allOrdersValid;
        }
        
        // 使用对冲仓位逻辑计算所有订单
        function calculateAllOrders() {
            const orderForms = document.querySelectorAll('.order-form');
            const multipleOrdersEnabled = document.getElementById('multipleOrders').checked;
            const positionCalculationEnabled = document.getElementById('positionCalculation').checked;
            
            // 检查是否有任何订单使用汇率转换
            let usesExchangeRate = false;
            
            // 首先，计算所有单个订单
            let allOrderResults = [];
            orderForms.forEach(orderForm =>{
                const orderId = parseInt(orderForm.getAttribute('data-order-id'));
                const result = calculateSingleOrder(orderId);
                
                if (result) {
                    allOrderResults.push(result);
                    
                    // 检查此订单是否使用汇率
                    if (result.product.pricingCurrency !== 'USD' || 
                        productsNeedingEurusd.includes(result.product.product)) {
                        usesExchangeRate = true;
                    }
                }
            });
            
            // 按产品分组订单以进行对冲计算
            const products = {};
            allOrderResults.forEach(order =>{
                const productCode = order.product.product;
                if (!products[productCode]) {
                    products[productCode] = {
                        product: order.product,
                        buyOrders: [],
                        sellOrders: [],
                        totalBuyLots: 0,
                        totalSellLots: 0
                    };
                }
                
                if (order.tradeType === 'buy') {
                    products[productCode].buyOrders.push(order);
                    products[productCode].totalBuyLots += order.lots;
                } else {
                    products[productCode].sellOrders.push(order);
                    products[productCode].totalSellLots += order.lots;
                }
            });
            
            // 计算对冲仓位并调整保证金
            let hasHedgePositions = false;
            let hedgeDetails = [];
            
            Object.values(products).forEach(productData =>{
                // 检查此产品是否同时有买入和卖出订单
                if (productData.totalBuyLots >0 && productData.totalSellLots >0) {
                    hasHedgePositions = true;
                    
                    // 计算对冲金额（买入和卖出的最小值）
                    const hedgedLots = Math.min(productData.totalBuyLots, productData.totalSellLots);
                    const remainingBuyLots = productData.totalBuyLots - hedgedLots;
                    const remainingSellLots = productData.totalSellLots - hedgedLots;
                    
                    // 添加到对冲详情
                    hedgeDetails.push(`${productData.product.product}: ${hedgedLots} lots hedged (${productData.totalBuyLots} buy / ${productData.totalSellLots} sell)`);
                    
                    // 计算此产品的每手保证金
                    const leverage = productData.buyOrders.length >0 
                        ? productData.buyOrders[0].selectedLeverage 
                        : productData.sellOrders[0].selectedLeverage;
                    
                    const perLotMarginMatch = productData.product[`leverage${leverage}`].match(/^(\d+\.?\d*) ([A-Z]{3})$/);
                    if (perLotMarginMatch) {
                        const perLotMarginAmount = parseFloat(perLotMarginMatch[1]);
                        const marginCurrency = perLotMarginMatch[2];
                        
                        // 调整买入订单的保证金
                        let remainingBuyToAllocate = remainingBuyLots;
                        productData.buyOrders.forEach(order =>{
                            if (remainingBuyToAllocate<= 0) {
                                // 此订单完全对冲
                                order.originalMarginInUSD = order.marginInUSD;
                                order.marginInUSD = 0;
                                order.isHedged = true;
                                order.hedgedLots = order.lots;
                            } else {
                                // 部分对冲
                                const hedgedInThisOrder = Math.max(0, order.lots - remainingBuyToAllocate);
                                if (hedgedInThisOrder >0) {
                                    order.originalMarginInUSD = order.marginInUSD;
                                    const hedgedPercentage = hedgedInThisOrder / order.lots;
                                    order.marginInUSD *= (1 - hedgedPercentage);
                                    order.isHedged = true;
                                    order.hedgedLots = hedgedInThisOrder;
                                    remainingBuyToAllocate -= (order.lots - hedgedInThisOrder);
                                } else {
                                    order.isHedged = false;
                                    order.hedgedLots = 0;
                                }
                            }
                        });
                        
                        // 调整卖出订单的保证金
                        let remainingSellToAllocate = remainingSellLots;
                        productData.sellOrders.forEach(order =>{
                            if (remainingSellToAllocate<= 0) {
                                // 此订单完全对冲
                                order.originalMarginInUSD = order.marginInUSD;
                                order.marginInUSD = 0;
                                order.isHedged = true;
                                order.hedgedLots = order.lots;
                            } else {
                                // 部分对冲
                                const hedgedInThisOrder = Math.max(0, order.lots - remainingSellToAllocate);
                                if (hedgedInThisOrder >0) {
                                    order.originalMarginInUSD = order.marginInUSD;
                                    const hedgedPercentage = hedgedInThisOrder / order.lots;
                                    order.marginInUSD *= (1 - hedgedPercentage);
                                    order.isHedged = true;
                                    order.hedgedLots = hedgedInThisOrder;
                                    remainingSellToAllocate -= (order.lots - hedgedInThisOrder);
                                } else {
                                    order.isHedged = false;
                                    order.hedgedLots = 0;
                                }
                            }
                        });
                    } else {
                        // Apply hedging margin adjustments for floating margin products as well
                        // 调整买入订单的保证金（浮动保证金）
                        let remainingBuyToAllocate = remainingBuyLots;
                        productData.buyOrders.forEach(order =>{
                            order.originalMarginInUSD = order.marginInUSD;
                            const perLotUSD = (order.lots > 0) ? (order.originalMarginInUSD / order.lots) : 0;

                            if (remainingBuyToAllocate<= 0) {
                                order.marginInUSD = order.lots * (0.5 * perLotUSD);
                                order.isHedged = true;
                                order.hedgedLots = order.lots;
                            } else {
                                const hedgedInThisOrder = Math.max(0, order.lots - remainingBuyToAllocate);
                                if (hedgedInThisOrder >0) {
                                    const nonHedgedLots = order.lots - hedgedInThisOrder;
                                    order.marginInUSD = nonHedgedLots * perLotUSD + hedgedInThisOrder * (0.5 * perLotUSD);
                                    order.isHedged = true;
                                    order.hedgedLots = hedgedInThisOrder;
                                    remainingBuyToAllocate -= (order.lots - hedgedInThisOrder);
                                } else {
                                    order.isHedged = false;
                                    order.hedgedLots = 0;
                                }
                            }
                        });

                        // 调整卖出订单的保证金（浮动保证金）
                        let remainingSellToAllocate = remainingSellLots;
                        productData.sellOrders.forEach(order =>{
                            order.originalMarginInUSD = order.marginInUSD;
                            const perLotUSD = (order.lots > 0) ? (order.originalMarginInUSD / order.lots) : 0;

                            if (remainingSellToAllocate<= 0) {
                                order.marginInUSD = order.lots * (0.5 * perLotUSD);
                                order.isHedged = true;
                                order.hedgedLots = order.lots;
                            } else {
                                const hedgedInThisOrder = Math.max(0, order.lots - remainingSellToAllocate);
                                if (hedgedInThisOrder >0) {
                                    const nonHedgedLots = order.lots - hedgedInThisOrder;
                                    order.marginInUSD = nonHedgedLots * perLotUSD + hedgedInThisOrder * (0.5 * perLotUSD);
                                    order.isHedged = true;
                                    order.hedgedLots = hedgedInThisOrder;
                                    remainingSellToAllocate -= (order.lots - hedgedInThisOrder);
                                } else {
                                    order.isHedged = false;
                                    order.hedgedLots = 0;
                                }
                            }
                        });
                    }
                } else {
                    // 此产品没有对冲
                    [...productData.buyOrders, ...productData.sellOrders].forEach(order =>{
                        order.isHedged = false;
                        order.hedgedLots = 0;
                        order.originalMarginInUSD = order.marginInUSD;
                    });
                }
            });
            
            // 使用调整后的保证金计算总计
            let totalPnLInUSD = 0;
            let totalMarginInUSD = 0;
            let totalOriginalMarginInUSD = 0;
            
            allOrderResults.forEach(order =>{
                totalPnLInUSD += order.pnlInUSD;
                totalMarginInUSD += order.marginInUSD;
                totalOriginalMarginInUSD += order.originalMarginInUSD;
            });
            
            // Preserve total PnL before commission and prepare after-commission value
            const totalPnLNoCommissionInUSD = totalPnLInUSD;
            let totalPnLWithCommissionInUSD = totalPnLInUSD;
            
            
            // 显示包含对冲信息的结果
            
            // Deduct commissions using global commission rate and attach per-order commission to details
            const positionOn = document.getElementById('positionCalculation').checked;
            const globalRateEl = document.getElementById('globalCommissionRate');
            const globalRate = globalRateEl ? (parseFloat(globalRateEl.value) || 0) : 0;
            let totalCommissionUSD = 0;
            if (positionOn) {
                allOrderResults.forEach(order =>{
                    const commissionUSD = (parseFloat(order.lots) || 0) * globalRate;
                    order.commissionUSD = commissionUSD;
                    totalCommissionUSD += commissionUSD;
                });
                totalPnLInUSD -= totalCommissionUSD;
                totalPnLWithCommissionInUSD = totalPnLInUSD;
            } else {
                allOrderResults.forEach(order =>{ order.commissionUSD = 0; });
            }
            displayResults(
                allOrderResults, 
                totalPnLInUSD, 
                totalMarginInUSD, 
                totalOriginalMarginInUSD,
                multipleOrdersEnabled, 
                positionCalculationEnabled,
                hasHedgePositions,
                hedgeDetails,
                usesExchangeRate,
                totalPnLNoCommissionInUSD,
                totalPnLWithCommissionInUSD
            );
            
            // 添加到历史记录
            addToHistory(allOrderResults, totalPnLInUSD, totalMarginInUSD, positionCalculationEnabled);
        }
        
        // 计算单个订单
        function calculateSingleOrder(orderId) {
            const productElement = document.getElementById(`selectedProduct_${orderId}`);
            if (!productElement || productElement.classList.contains('hidden')) return null;
            
            const product = JSON.parse(productElement.getAttribute('data-product'));
            
            // 获取表单值
            const tradeType = document.getElementById(`tradeType_${orderId}`).value;
            const selectedLeverage = document.getElementById(`leverage_${orderId}`).value;
            const lots = parseFloat(document.getElementById(`lots_${orderId}`).value);
            const openPrice = parseFloat(document.getElementById(`openPrice_${orderId}`).value);
            const closePrice = parseFloat(document.getElementById(`closePrice_${orderId}`).value);
            const contractSize = product.contractSize;
            const pricingCurrency = product.pricingCurrency;
            
            // 输入验证
            if (isNaN(lots) || isNaN(openPrice) || isNaN(closePrice) || lots<= 0 || openPrice<= 0 || closePrice<= 0) {
                alert(`Please enter valid positive numbers for Order #${orderId}`);
                return null;
            }
            
            // 汇率处理
            let exchangeRate = 1.0;
            if (pricingCurrency !== 'USD') {
                exchangeRate = parseFloat(document.getElementById(`exchangeRate_${orderId}`).value) || 0;
                if (exchangeRate<= 0) {
                    alert(`Please enter a valid exchange rate for Order #${orderId}`);
                    return null;
                }
            }
            
            // 对于特定产品，获取EURUSD汇率
            let eurusdRate = 1.0;
            if (productsNeedingEurusd.includes(product.product)) {
                eurusdRate = parseFloat(document.getElementById(`eurusdRate_${orderId}`).value) || 0;
                if (eurusdRate<= 0) {
                    alert(`Please enter a valid EURUSD exchange rate for Order #${orderId}`);
                    return null;
                }
            }
            
            // 盈亏计算
            const priceChange = closePrice - openPrice;
            const directionFactor = tradeType === 'buy' ? 1 : -1;
            const pnl = priceChange * contractSize * lots * directionFactor;
            let pnlInUSD = pnl;
if (pricingCurrency === 'USD') {
  pnlInUSD = pnl;
} else if (pricingCurrency === 'EUR' && productsNeedingEurusd.includes(product.product) && eurusdRate > 0) {
  pnlInUSD = pnl * eurusdRate;
} else {
  pnlInUSD = pnl * exchangeRate;
}
            const pnlCurrency = product.pipValuePerLot.match(/[A-Z]{3}$/)?.[0] || pricingCurrency;
            
            // 基于保证金类型的保证金计算
            let marginRequired = 0;
            let marginCurrency = '';
            let marginCalculationDesc = '';
            const perLotMarginValue = product[`leverage${selectedLeverage}`];
            
            if (product.marginType === 'Fixed') {
                const fixedMarginMatch = perLotMarginValue.match(/^(\d+\.?\d*) ([A-Z]{3})$/);
                if (!fixedMarginMatch) {
                    alert(`Invalid fixed margin format for ${product.product} (${perLotMarginValue})`);
                    return null;
                }
                const perLotMarginAmount = parseFloat(fixedMarginMatch[1]);
                marginCurrency = fixedMarginMatch[2];
                marginRequired = perLotMarginAmount * lots;
                marginCalculationDesc = `Fixed margin per lot (${perLotMarginAmount} ${marginCurrency}) × number of lots (${lots})`;
            
            } else if (product.marginType === 'Floating') {
                const leverageRatioMatch = perLotMarginValue.match(/^1:(\d+)$/);
                if (!leverageRatioMatch) {
                    alert(`Invalid leverage format for floating margin product ${product.product} (${perLotMarginValue})`);
                    return null;
                }
                const leverageRatio = parseInt(leverageRatioMatch[1]);
                marginCurrency = pricingCurrency;
                marginRequired = (openPrice * lots * contractSize) / leverageRatio;
                marginCalculationDesc = `Open price (${openPrice}) × lots (${lots}) × contract size (${contractSize.toLocaleString()}) ÷ leverage ratio (1:${leverageRatio})`;
            
            } else {
                alert(`Unknown margin type: ${product.marginType} (Product: ${product.product})`);
                return null;
            }
            
            // 保证金美元转换 - 对于EUR保证金产品，使用EURUSD汇率
            let marginInUSD = marginRequired;
if (marginCurrency === 'USD') {
  marginInUSD = marginRequired;
} else if (marginCurrency === 'EUR' && productsNeedingEurusd.includes(product.product) && eurusdRate > 0) {
  marginInUSD = marginRequired * eurusdRate;
} else {
  // Fallback to general exchangeRate for all non-USD (including EUR non-whitelist)
  marginInUSD = marginRequired * exchangeRate;
}
            
            // 盈亏百分比计算
            const pnlPercentage = (pnl / marginRequired) * 100;
            
            return {
                orderId,
                product,
                tradeType,
                selectedLeverage,
                lots,
                openPrice,
                closePrice,
                pnl,
                pnlCurrency,
                pnlInUSD,
                marginRequired,
                marginCurrency,
                marginInUSD,
                pnlPercentage,
                marginCalculationDesc,
                exchangeRate,
                eurusdRate: productsNeedingEurusd.includes(product.product) ? eurusdRate : null
            };
        }
        
        // 显示所有结果
        function displayResults(
            orderResults, 
            totalPnLInUSD, 
            totalMarginInUSD,
            totalOriginalMarginInUSD,
            multipleOrdersEnabled, 
            positionCalculationEnabled,
            hasHedgePositions,
            hedgeDetails,
            usesExchangeRate
        , totalPnLNoCommissionInUSD, totalPnLWithCommissionInUSD) {
            const resultsSection = document.getElementById('resultsSection');
            const individualResults = document.getElementById('individualResults');
            const summaryResults = document.getElementById('summaryResults');
            const calculationDetails = document.getElementById('calculationDetails');
            const hedgeNotice = document.getElementById('hedgeNotice');
            const hedgeDetailsEl = document.getElementById('hedgeDetails');
            const exchangeRateNote = document.getElementById('exchangeRateNote');
            
            // 清除先前的结果
            individualResults.innerHTML = '';
            calculationDetails.innerHTML = '';
            
            // 显示或隐藏汇率提示
            if (usesExchangeRate) {
                exchangeRateNote.classList.remove('hidden');
            } else {
                exchangeRateNote.classList.add('hidden');
            }
            
            // 显示或隐藏对冲提示
            if (hasHedgePositions) {
                hedgeNotice.classList.remove('hidden');
                hedgeDetailsEl.innerHTML = `Hedged positions detected: ${hedgeDetails.join('; ')}.`;
            } else {
                hedgeNotice.classList.add('hidden');
            }
            
            // 为多订单显示汇总
            if (multipleOrdersEnabled && orderResults.length >1) {
                summaryResults.classList.remove('hidden');
                
                const elNo = document.getElementById('totalPnLNoCommissionInUSD');
                const elWith = document.getElementById('totalPnLWithCommissionInUSD');
                if (elNo)  elNo.textContent  = `${(totalPnLNoCommissionInUSD ?? totalPnLInUSD).toFixed(2)} USD`;
                if (elWith) elWith.textContent = `${(totalPnLWithCommissionInUSD ?? totalPnLInUSD).toFixed(2)} USD`;
              
                
                // 如果有对冲，显示原始与调整后的保证金
                if (hasHedgePositions) {
                    document.getElementById('totalMarginInUSD').innerHTML = `
                        ${totalMarginInUSD.toFixed(2)} USD<div class="text-sm opacity-80">(Original: ${totalOriginalMarginInUSD.toFixed(2)} USD)</div>`;
                } else {
                    document.getElementById('totalMarginInUSD').textContent = `${totalMarginInUSD.toFixed(2)} USD`;
                }
            } else {
                summaryResults.classList.add('hidden');
            }
            
            // 显示单个订单结果
            orderResults.forEach(result =>{
                // 创建单个结果卡片
                const resultCard = document.createElement('div');
                resultCard.className = 'bg-white bg-opacity-10 rounded-xl p-6 backdrop-blur-sm';
                
                const isProfit = result.pnl >= 0;
                const pnlClass = isProfit ? 'text-green-400' : 'text-red-400';
                const pnlIcon = isProfit ? 'fas fa-arrow-up' : 'fas fa-arrow-down';
                
                // 准备包含对冲信息的保证金显示（如适用）
                let marginDisplay = `${result.marginInUSD.toFixed(2)} USD`;
                if (result.isHedged && result.hedgedLots >0) {
                    marginDisplay += `<div class="text-sm opacity-80">(Original: ${result.originalMarginInUSD.toFixed(2)} USD)</div><div class="text-xs bg-yellow-500 bg-opacity-20 px-2 py-1 rounded mt-1"><i class="fas fa-info-circle mr-1"></i>${result.hedgedLots} lots hedged ${futuresProducts.includes(result.product.product) ? '(hedged portion margin = 50%)' : '(margin reduced to 0)'}</div>`;
                } else {
                    marginDisplay += `<div class="text-sm opacity-80">(${result.marginRequired.toFixed(2)} ${result.marginCurrency})</div>`;
                }
                
                resultCard.innerHTML = `<div class="flex justify-between items-center mb-4"><h3 class="text-lg font-semibold">${multipleOrdersEnabled ? `Order #${result.orderId}: ` : ''}${result.product.product} - ${result.product.name}</h3><span class="text-sm font-medium px-3 py-1 rounded-full ${isProfit ? 'bg-green-500 bg-opacity-20' : 'bg-red-500 bg-opacity-20'}">${result.tradeType === 'buy' ? 'Buy' : 'Sell'} | ${result.lots} lots | Leverage: 1:${result.selectedLeverage}</span></div><div class="grid grid-cols-1 md:grid-cols-2 gap-6"><div><h4 class="text-sm opacity-80 mb-1">Profit/Loss</h4><div class="font-bold text-xl ${pnlClass}"><i class="${pnlIcon} mr-1"></i>${result.pnlInUSD.toFixed(2)} USD</div><div class="text-sm opacity-80">(${result.pnl.toFixed(2)} ${result.pnlCurrency})</div><div class="text-xs opacity-80 mt-1">(Relative to margin: ${result.pnlPercentage.toFixed(2)}%)</div><div class="text-xs opacity-80 mt-1">Commission (USD): ${ (result.commissionUSD || 0).toFixed(2) }</div></div><div><h4 class="text-sm opacity-80 mb-1">Used Margin</h4><div class="font-bold text-xl">${marginDisplay}</div><div class="text-xs opacity-80 mt-1">${result.marginCalculationDesc}</div></div></div>`;
                
                individualResults.appendChild(resultCard);
                
                // 添加到计算详情
                const product = result.product;
                let hedgeInfo = '';
                if (result.isHedged && result.hedgedLots >0) {
                    hedgeInfo = `
                        ${futuresProducts.includes(product.product) ? `<div><strong>Hedged:</strong>${result.hedgedLots} lots (hedged portion margin = 50%)</div>` : `<div><strong>Hedged:</strong>${result.hedgedLots} lots (margin reduced to 0)</div>`}<div><strong>Original Margin:</strong>${result.originalMarginInUSD.toFixed(2)} USD</div>`;
                }
                
                let exchangeRateInfo = '';
                if (product.pricingCurrency !== 'USD') {
                    exchangeRateInfo = `<div><strong>Exchange Rate Used:</strong>1 ${product.pricingCurrency} = ${result.exchangeRate} USD</div>`;
                }
                
                // 添加EURUSD汇率信息（如适用）
                let eurusdRateInfo = '';
                if (productsNeedingEurusd.includes(product.product)) {
                    eurusdRateInfo = `<div><strong>EURUSD Rate Used:</strong>${result.eurusdRate}</div>`;
                }
                
                let orderDetails = `<div class="p-3 bg-white bg-opacity-5 rounded-lg"><div class="font-medium mb-2">${multipleOrdersEnabled ? `Order #${result.orderId}: ` : ''}${product.product} - ${product.name}</div><div class="grid grid-cols-1 md:grid-cols-2 gap-x-4 gap-y-1 text-xs"><div><strong>Trade:</strong>${result.tradeType === 'buy' ? 'Buy' : 'Sell'} | ${result.lots} lots</div><div><strong>Leverage:</strong>1:${result.selectedLeverage}</div><div><strong>Open Price:</strong>${result.openPrice}</div><div><strong>Close Price:</strong>${result.closePrice}</div><div><strong>Price Change:</strong>${(result.closePrice - result.openPrice).toFixed(5)}</div><div><strong>Contract Size:</strong>${product.contractSize.toLocaleString()}</div><div><strong>PnL:</strong>${result.pnl.toFixed(2)} ${result.pnlCurrency} (${result.pnlInUSD.toFixed(2)} USD)</div><div><strong>Used Margin:</strong>${result.marginInUSD.toFixed(2)} USD (${result.marginRequired.toFixed(2)} ${result.marginCurrency})</div>${positionCalculationEnabled ? `<div><strong>Commission Deducted:</strong>$${(result.commissionUSD || 0).toFixed(2)}</div>` : ''}
                            ${exchangeRateInfo}
                            ${eurusdRateInfo}
                            ${hedgeInfo}</div></div>`;
                
                calculationDetails.innerHTML += orderDetails;
            });
            
            // 为多订单添加汇总计算
            if (multipleOrdersEnabled && orderResults.length >1) {
                let hedgeSummary = '';
                if (hasHedgePositions) {
                    hedgeSummary = `<div><strong>Original Total Margin:</strong>${totalOriginalMarginInUSD.toFixed(2)} USD</div><div><strong>Margin Reduction Due to Hedging:</strong>${(totalOriginalMarginInUSD - totalMarginInUSD).toFixed(2)} USD</div>`;
                }
                
                calculationDetails.innerHTML += `<div class="p-3 bg-white bg-opacity-10 rounded-lg mt-4"><div class="font-medium mb-2">Total Summary</div><div class="grid grid-cols-1 md:grid-cols-2 gap-x-4 gap-y-1 text-xs"><div><strong>Total PnL in USD:</strong>${totalPnLInUSD.toFixed(2)} USD</div><div><strong>Total Margin in USD:</strong>${totalMarginInUSD.toFixed(2)} USD</div><div><strong>Total Orders:</strong>${orderResults.length}</div><div><strong>Used Leverage:</strong>1:${currentLeverage}</div>${hedgeSummary}</div></div>`;
            }
            
            // 如果启用，计算并显示仓位指标
            const positionResults = document.getElementById('positionResults');
            if (positionCalculationEnabled) {
                const balance = parseFloat(document.getElementById('balance').value) || 0;
                const equity = balance + totalPnLInUSD;
                const freeMargin = equity - totalMarginInUSD;
                const marginRatio = (equity / totalMarginInUSD) * 100;
                
                document.getElementById('equity').textContent = `${equity.toFixed(2)} USD`;
                document.getElementById('freeMargin').textContent = `${freeMargin.toFixed(2)} USD`;
                document.getElementById('marginRatio').textContent = `${marginRatio.toFixed(2)}%`;
                
                positionResults.classList.remove('hidden');
                
                // 将仓位详情添加到计算详情
                calculationDetails.innerHTML += `<div class="p-3 bg-white bg-opacity-10 rounded-lg mt-4"><div class="font-medium mb-2">Position Calculations</div><div class="grid grid-cols-1 md:grid-cols-3 gap-x-4 gap-y-1 text-xs"><div><strong>Balance:</strong>${balance.toFixed(2)} USD</div><div><strong>Equity:</strong>${equity.toFixed(2)} USD (Balance + Total PnL)</div><div><strong>Free Margin:</strong>${freeMargin.toFixed(2)} USD (Equity - Total Margin)</div><div><strong>Margin Ratio:</strong>${marginRatio.toFixed(2)}% (Equity / Total Margin × 100%)</div></div></div>`;
            } else {
                positionResults.classList.add('hidden');
            }
            
            // 显示结果部分
            resultsSection.classList.remove('hidden');
        }
        
        // 添加到历史记录
        function addToHistory(orderResults, totalPnLInUSD, totalMarginInUSD, positionCalculationEnabled) {
            let balance = null;
            let equity = null;
            let freeMargin = null;
            let marginRatio = null;
            
            if (positionCalculationEnabled) {
                balance = parseFloat(document.getElementById('balance').value) || 0;
                equity = balance + totalPnLInUSD;
                freeMargin = equity - totalMarginInUSD;
                marginRatio = (equity / totalMarginInUSD) * 100;
            }
            
            const historyItem = {
                orders: orderResults,
                totalPnLInUSD,
                totalMarginInUSD,
                positionCalculation: positionCalculationEnabled,
                balance,
                equity,
                freeMargin,
                marginRatio,
                leverage: currentLeverage,
                timestamp: new Date()
            };
            
            calculationHistory.unshift(historyItem);
            if (calculationHistory.length >5) {
                calculationHistory.pop();
            }
            
            updateHistoryDisplay();
        }
        
        // 更新历史记录显示
        function updateHistoryDisplay() {
            const historyList = document.getElementById('historyList');
            const noHistory = document.getElementById('noHistory');
            
            if (calculationHistory.length === 0) {
                noHistory.classList.remove('hidden');
                historyList.innerHTML = '';
                return;
            }
            
            noHistory.classList.add('hidden');
            historyList.innerHTML = '';
            
            calculationHistory.forEach((item, index) =>{
                const historyItem = document.createElement('div');
                historyItem.className = 'p-4 border-b border-gray-100 hover:bg-gray-50 transition-colors';
                
                const isProfit = item.totalPnLInUSD >= 0;
                const pnlClass = isProfit ? 'text-green-600' : 'text-red-600';
                const pnlIcon = isProfit ? 'fas fa-arrow-up' : 'fas fa-arrow-down';
                
                // 创建订单摘要文本
                let orderSummary = '';
                if (item.orders.length === 1) {
                    const order = item.orders[0];
                    orderSummary = `${order.product.product} (${order.lots} lots)`;
                } else {
                    orderSummary = `${item.orders.length} orders`;
                }
                
                // 检查是否有对冲订单
                const hasHedgedOrders = item.orders.some(order =>order.isHedged);
                const hedgeIndicator = hasHedgedOrders ? 
                    '<span class="inline-block text-xs bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded ml-2">Hedged</span>' : '';
                
                // 格式化时间戳
                const formattedTime = item.timestamp.toLocaleString();
                
                // 仓位详情
                let positionDetails = '';
                if (item.positionCalculation) {
                    positionDetails = `<div class="text-xs text-gray-500 mt-1">Equity: ${item.equity.toFixed(2)} USD | Margin Ratio: ${item.marginRatio.toFixed(2)}%</div>`;
                }
                
                historyItem.innerHTML = `<div class="flex justify-between items-start"><div><div class="font-medium">${formattedTime}</div><div class="text-sm text-gray-600 mt-1">${orderSummary} ${hedgeIndicator}</div></div><div class="text-right"><div class="font-medium ${pnlClass}"><i class="${pnlIcon}"></i>${item.totalPnLInUSD.toFixed(2)} USD</div><div class="text-xs text-gray-500 mt-1">Margin: ${item.totalMarginInUSD.toFixed(2)} USD</div></div></div>${positionDetails}
                `;
                
                historyList.appendChild(historyItem);
            });
        }</script></body>
</template>

<template id="page-uae">
<html lang="en"><head><meta charset="utf-8"/><meta content="width=device-width, initial-scale=1.0" name="viewport"/><title>PnL Calculator</title><script src="https://cdn.tailwindcss.com"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" rel="stylesheet"/><style>.bg-custom {
            background: linear-gradient(rgba(255, 255, 255, 0.85), rgba(255, 255, 255, 0.85)), 
                        url('https://images.unsplash.com/photo-1611974789855-9c2a0a7236a3?ixlib=rb-4.0.3');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }</style><!-- 产品数据 --><script>const productsData = [
            {"product": "EURUSD", "name": "Euro/US Dollar", "contractSize": 100000, "pipValuePerLot": "10 USD", "leverage400": "250 USD", "leverage200": "500 USD", "leverage100": "1000 USD", "baseCurrency": "EUR", "pricingCurrency": "USD", "marginType": "Fixed"},
            {"product": "GBPUSD", "name": "Great British Pound/US Dollar", "contractSize": 100000, "pipValuePerLot": "10 USD", "leverage400": "250 USD", "leverage200": "500 USD", "leverage100": "1000 USD", "baseCurrency": "GBP", "pricingCurrency": "USD", "marginType": "Fixed"},
            {"product": "AUDUSD", "name": "Australian Dollar/US Dollar", "contractSize": 100000, "pipValuePerLot": "10 USD", "leverage400": "250 USD", "leverage200": "500 USD", "leverage100": "1000 USD", "baseCurrency": "AUD", "pricingCurrency": "USD", "marginType": "Fixed"},
            {"product": "NZDUSD", "name": "New Zealand Dollar/US Dollar", "contractSize": 100000, "pipValuePerLot": "10 USD", "leverage400": "250 USD", "leverage200": "500 USD", "leverage100": "1000 USD", "baseCurrency": "NZD", "pricingCurrency": "USD", "marginType": "Fixed"},
            {"product": "XAUUSD", "name": "Spot Gold/US Dollar", "contractSize": 100, "pipValuePerLot": "10 USD", "leverage400": "250 USD", "leverage200": "500 USD", "leverage100": "1000 USD", "baseCurrency": "", "pricingCurrency": "USD", "marginType": "Fixed"},
            {"product": "XAGUSD", "name": "Spot Silver/US Dollar", "contractSize": 5000, "pipValuePerLot": "50 USD", "leverage400": "1500 USD", "leverage200": "1500 USD", "leverage100": "3000 USD", "baseCurrency": "", "pricingCurrency": "USD", "marginType": "Fixed"},
            {"product": "GOLD_MMMYY", "name": "Gold Futures (CFD)", "contractSize": 100, "pipValuePerLot": "10 USD", "leverage400": "8000 USD", "leverage200": "8000 USD", "leverage100": "8000 USD", "baseCurrency": "", "pricingCurrency": "USD", "marginType": "Fixed"},
            {"product": "HG_MMMYY", "name": "High Grade Copper Futures (CFD)", "contractSize": 25000, "pipValuePerLot": "10 USD", "leverage400": "1:50", "leverage200": "1:50", "leverage100": "1:50", "baseCurrency": "", "pricingCurrency": "USD", "marginType": "Floating"},
            {"product": "USOIL.MMMYY", "name": "US WTI Crude Oil Futures Contract (CFD)", "contractSize": 1000, "pipValuePerLot": "10 USD", "leverage400": "500 USD", "leverage200": "500 USD", "leverage100": "500 USD", "baseCurrency": "", "pricingCurrency": "USD", "marginType": "Fixed"},
            {"product": "UKOIL.MMMYY", "name": "UK BRENT Crude Oil Futures Contract (CFD)", "contractSize": 1000, "pipValuePerLot": "10 USD", "leverage400": "500 USD", "leverage200": "500 USD", "leverage100": "500 USD", "baseCurrency": "", "pricingCurrency": "USD", "marginType": "Fixed"},
            {"product": "NGAS.MMMYY", "name": "US Natural Gas Futures Contract (CFD)", "contractSize": 10000, "pipValuePerLot": "10 USD", "leverage400": "1:50", "leverage200": "1:50", "leverage100": "1:50", "baseCurrency": "", "pricingCurrency": "USD", "marginType": "Floating"},
            {"product": "WTI", "name": "US WTI Crude Oil Spot Contract", "contractSize": 1000, "pipValuePerLot": "10 USD", "leverage400": "500 USD", "leverage200": "500 USD", "leverage100": "500 USD", "baseCurrency": "", "pricingCurrency": "USD", "marginType": "Fixed"},
            {"product": "BRENT", "name": "UK BRENT Crude Oil Spot Contract", "contractSize": 1000, "pipValuePerLot": "10 USD", "leverage400": "500 USD", "leverage200": "500 USD", "leverage100": "500 USD", "baseCurrency": "", "pricingCurrency": "USD", "marginType": "Fixed"},
            {"product": "CHI50", "name": "FTSE China A50 Spot Index (CFD)", "contractSize": 10, "pipValuePerLot": "10 USD", "leverage400": "1:100", "leverage200": "1:100", "leverage100": "1:100", "baseCurrency": "", "pricingCurrency": "USD", "marginType": "Floating"},
            {"product": "JP225", "name": "Japan Nikkei 225 Spot Index (CFD)", "contractSize": 10, "pipValuePerLot": "10 USD", "leverage400": "1:100", "leverage200": "1:100", "leverage100": "1:100", "baseCurrency": "", "pricingCurrency": "USD", "marginType": "Floating"},
            {"product": "US30", "name": "US Dow Jones 30 Spot Index (CFD)", "contractSize": 10, "pipValuePerLot": "10 USD", "leverage400": "1:100", "leverage200": "1:100", "leverage100": "1:100", "baseCurrency": "", "pricingCurrency": "USD", "marginType": "Floating"},
            {"product": "NAS100", "name": "US NASDAQ 100 Spot Index (CFD)", "contractSize": 20, "pipValuePerLot": "10 USD", "leverage400": "1:100", "leverage200": "1:100", "leverage100": "1:100", "baseCurrency": "", "pricingCurrency": "USD", "marginType": "Floating"},
            {"product": "SPX500", "name": "US S&P 500 Spot Index (CFD)", "contractSize": 50, "pipValuePerLot": "10 USD", "leverage400": "1:100", "leverage200": "1:100", "leverage100": "1:100", "baseCurrency": "", "pricingCurrency": "USD", "marginType": "Floating"},
            {"product": "US2000", "name": "US Russell 2000 Spot Index (CFD)", "contractSize": 50, "pipValuePerLot": "10 USD", "leverage400": "1:100", "leverage200": "1:100", "leverage100": "1:100", "baseCurrency": "", "pricingCurrency": "USD", "marginType": "Floating"},
            {"product": "USDX_MMMYY", "name": "US Dollar Index Futures (CFD)", "contractSize": 1000, "pipValuePerLot": "10 USD", "leverage400": "1:50", "leverage200": "1:50", "leverage100": "1:50", "baseCurrency": "", "pricingCurrency": "USD", "marginType": "Floating"},
            {"product": "USDJPY", "name": "US Dollar/Japanese Yen", "contractSize": 100000, "pipValuePerLot": "1000 JPY", "leverage400": "250 USD", "leverage200": "500 USD", "leverage100": "1000 USD", "baseCurrency": "USD", "pricingCurrency": "JPY", "marginType": "Fixed"},
            {"product": "USDCHF", "name": "US Dollar/Swiss Franc", "contractSize": 100000, "pipValuePerLot": "10 CHF", "leverage400": "250 USD", "leverage200": "500 USD", "leverage100": "1000 USD", "baseCurrency": "USD", "pricingCurrency": "CHF", "marginType": "Fixed"},
            {"product": "USDCAD", "name": "US Dollar/Canadian Dollar", "contractSize": 100000, "pipValuePerLot": "10 CAD", "leverage400": "250 USD", "leverage200": "500 USD", "leverage100": "1000 USD", "baseCurrency": "USD", "pricingCurrency": "CAD", "marginType": "Fixed"},
            {"product": "USDCNH", "name": "US Dollar/Chinese Offshore Yuan", "contractSize": 100000, "pipValuePerLot": "10 CNH", "leverage400": "2000 USD", "leverage200": "2000 USD", "leverage100": "4000 USD", "baseCurrency": "USD", "pricingCurrency": "CNH", "marginType": "Fixed"},
            {"product": "USDHKD", "name": "US Dollar/Hong Kong Dollar", "contractSize": 100000, "pipValuePerLot": "10 HKD", "leverage400": "2000 USD", "leverage200": "2000 USD", "leverage100": "4000 USD", "baseCurrency": "USD", "pricingCurrency": "HKD", "marginType": "Fixed"},
            {"product": "USDSGD", "name": "US Dollar/Singapore Dollar", "contractSize": 100000, "pipValuePerLot": "10 SGD", "leverage400": "2000 USD", "leverage200": "2000 USD", "leverage100": "4000 USD", "baseCurrency": "USD", "pricingCurrency": "SGD", "marginType": "Fixed"},
            {"product": "USDCZK", "name": "US Dollar/Czech Koruna", "contractSize": 100000, "pipValuePerLot": "10 CZK", "leverage400": "2000 USD", "leverage200": "2000 USD", "leverage100": "4000 USD", "baseCurrency": "USD", "pricingCurrency": "CZK", "marginType": "Fixed"},
            {"product": "USDDKK", "name": "US Dollar/Danish Krone", "contractSize": 100000, "pipValuePerLot": "10 DKK", "leverage400": "2000 USD", "leverage200": "2000 USD", "leverage100": "4000 USD", "baseCurrency": "USD", "pricingCurrency": "DKK", "marginType": "Fixed"},
            {"product": "USDHUF", "name": "US Dollar/Hungarian Forint", "contractSize": 100000, "pipValuePerLot": "1000 HUF", "leverage400": "2000 USD", "leverage200": "2000 USD", "leverage100": "4000 USD", "baseCurrency": "USD", "pricingCurrency": "HUF", "marginType": "Fixed"},
            {"product": "USDMXN", "name": "US Dollar/Mexican Peso", "contractSize": 100000, "pipValuePerLot": "10 MXN", "leverage400": "2000 USD", "leverage200": "2000 USD", "leverage100": "4000 USD", "baseCurrency": "USD", "pricingCurrency": "MXN", "marginType": "Fixed"},
            {"product": "USDNOK", "name": "US Dollar/Norwegian Krone", "contractSize": 100000, "pipValuePerLot": "10 NOK", "leverage400": "2000 USD", "leverage200": "2000 USD", "leverage100": "4000 USD", "baseCurrency": "USD", "pricingCurrency": "NOK", "marginType": "Fixed"},
            {"product": "USDPLN", "name": "US Dollar/Polish Zloty", "contractSize": 100000, "pipValuePerLot": "10 PLN", "leverage400": "2000 USD", "leverage200": "2000 USD", "leverage100": "4000 USD", "baseCurrency": "USD", "pricingCurrency": "PLN", "marginType": "Fixed"},
            {"product": "USDSEK", "name": "US Dollar/Swedish Krone", "contractSize": 100000, "pipValuePerLot": "10 SEK", "leverage400": "2000 USD", "leverage200": "2000 USD", "leverage100": "4000 USD", "baseCurrency": "USD", "pricingCurrency": "SEK", "marginType": "Fixed"},
            {"product": "USDZAR", "name": "US Dollar/South Africa Rand", "contractSize": 100000, "pipValuePerLot": "10 ZAR", "leverage400": "2000 USD", "leverage200": "2000 USD", "leverage100": "4000 USD", "baseCurrency": "USD", "pricingCurrency": "ZAR", "marginType": "Fixed"},
            {"product": "AUDNZD", "name": "Australian Dollar/New Zealand Dollar", "contractSize": 100000, "pipValuePerLot": "10 NZD", "leverage400": "250 USD", "leverage200": "500 USD", "leverage100": "1000 USD", "baseCurrency": "AUD", "pricingCurrency": "NZD", "marginType": "Fixed"},
            {"product": "EURAUD", "name": "Euro/Australian Dollar", "contractSize": 100000, "pipValuePerLot": "10 AUD", "leverage400": "250 USD", "leverage200": "500 USD", "leverage100": "1000 USD", "baseCurrency": "EUR", "pricingCurrency": "AUD", "marginType": "Fixed"},
            {"product": "EURGBP", "name": "Euro/Great British Pound", "contractSize": 100000, "pipValuePerLot": "10 GBP", "leverage400": "250 USD", "leverage200": "500 USD", "leverage100": "1000 USD", "baseCurrency": "EUR", "pricingCurrency": "GBP", "marginType": "Fixed"},
            {"product": "EURNZD", "name": "Euro/New Zealand Dollar", "contractSize": 100000, "pipValuePerLot": "10 NZD", "leverage400": "250 USD", "leverage200": "500 USD", "leverage100": "1000 USD", "baseCurrency": "EUR", "pricingCurrency": "NZD", "marginType": "Fixed"},
            {"product": "GBPAUD", "name": "Great British Pound/Australian Dollar", "contractSize": 100000, "pipValuePerLot": "10 AUD", "leverage400": "250 USD", "leverage200": "500 USD", "leverage100": "1000 USD", "baseCurrency": "GBP", "pricingCurrency": "AUD", "marginType": "Fixed"},
            {"product": "GBPNZD", "name": "Great British Pound/New Zealand Dollar", "contractSize": 100000, "pipValuePerLot": "10 NZD", "leverage400": "250 USD", "leverage200": "500 USD", "leverage100": "1000 USD", "baseCurrency": "GBP", "pricingCurrency": "NZD", "marginType": "Fixed"},
            {"product": "AUDCAD", "name": "Australian Dollar/Canadian Dollar", "contractSize": 100000, "pipValuePerLot": "10 CAD", "leverage400": "250 USD", "leverage200": "500 USD", "leverage100": "1000 USD", "baseCurrency": "AUD", "pricingCurrency": "CAD", "marginType": "Fixed"},
            {"product": "AUDCHF", "name": "Australian Dollar/Swiss Franc", "contractSize": 100000, "pipValuePerLot": "10 CHF", "leverage400": "250 USD", "leverage200": "500 USD", "leverage100": "1000 USD", "baseCurrency": "AUD", "pricingCurrency": "CHF", "marginType": "Fixed"},
            {"product": "AUDJPY", "name": "Australian Dollar/Japanese Yen", "contractSize": 100000, "pipValuePerLot": "1000 JPY", "leverage400": "250 USD", "leverage200": "500 USD", "leverage100": "1000 USD", "baseCurrency": "AUD", "pricingCurrency": "JPY", "marginType": "Fixed"},
            {"product": "CADCHF", "name": "Canadian Dollar/Swiss Franc", "contractSize": 100000, "pipValuePerLot": "10 CHF", "leverage400": "250 USD", "leverage200": "500 USD", "leverage100": "1000 USD", "baseCurrency": "CAD", "pricingCurrency": "CHF", "marginType": "Fixed"},
            {"product": "CADJPY", "name": "Canadian Dollar/Japanese Yen", "contractSize": 100000, "pipValuePerLot": "1000 JPY", "leverage400": "250 USD", "leverage200": "500 USD", "leverage100": "1000 USD", "baseCurrency": "CAD", "pricingCurrency": "JPY", "marginType": "Fixed"},
            {"product": "CHFJPY", "name": "Swiss Franc/Japanese Yen", "contractSize": 100000, "pipValuePerLot": "1000 JPY", "leverage400": "250 USD", "leverage200": "500 USD", "leverage100": "1000 USD", "baseCurrency": "CHF", "pricingCurrency": "JPY", "marginType": "Fixed"},
            {"product": "EURCAD", "name": "Euro/Canadian Dollar", "contractSize": 100000, "pipValuePerLot": "10 CAD", "leverage400": "250 USD", "leverage200": "500 USD", "leverage100": "1000 USD", "baseCurrency": "EUR", "pricingCurrency": "CAD", "marginType": "Fixed"},
            {"product": "EURCHF", "name": "Euro/Swiss Franc", "contractSize": 100000, "pipValuePerLot": "10 CHF", "leverage400": "250 USD", "leverage200": "500 USD", "leverage100": "1000 USD", "baseCurrency": "EUR", "pricingCurrency": "CHF", "marginType": "Fixed"},
            {"product": "EURJPY", "name": "Euro/Japanese Yen", "contractSize": 100000, "pipValuePerLot": "1000 JPY", "leverage400": "250 USD", "leverage200": "500 USD", "leverage100": "1000 USD", "baseCurrency": "EUR", "pricingCurrency": "JPY", "marginType": "Fixed"},
            {"product": "GBPCAD", "name": "Great British Pound/Canadian Dollar", "contractSize": 100000, "pipValuePerLot": "10 CAD", "leverage400": "250 USD", "leverage200": "500 USD", "leverage100": "1000 USD", "baseCurrency": "GBP", "pricingCurrency": "CAD", "marginType": "Fixed"},
            {"product": "GBPCHF", "name": "Great British Pound/Swiss Franc", "contractSize": 100000, "pipValuePerLot": "10 CHF", "leverage400": "250 USD", "leverage200": "500 USD", "leverage100": "1000 USD", "baseCurrency": "GBP", "pricingCurrency": "CHF", "marginType": "Fixed"},
            {"product": "GBPJPY", "name": "Great British Pound/Japanese Yen", "contractSize": 100000, "pipValuePerLot": "1000 JPY", "leverage400": "250 USD", "leverage200": "500 USD", "leverage100": "1000 USD", "baseCurrency": "GBP", "pricingCurrency": "JPY", "marginType": "Fixed"},
            {"product": "NZDCAD", "name": "New Zealand Dollar/Canadian Dollar", "contractSize": 100000, "pipValuePerLot": "10 CAD", "leverage400": "250 USD", "leverage200": "500 USD", "leverage100": "1000 USD", "baseCurrency": "NZD", "pricingCurrency": "CAD", "marginType": "Fixed"},
            {"product": "NZDCHF", "name": "New Zealand Dollar/Swiss Franc", "contractSize": 100000, "pipValuePerLot": "10 CHF", "leverage400": "250 USD", "leverage200": "500 USD", "leverage100": "1000 USD", "baseCurrency": "NZD", "pricingCurrency": "CHF", "marginType": "Fixed"},
            {"product": "NZDJPY", "name": "New Zealand Dollar/Japanese Yen", "contractSize": 100000, "pipValuePerLot": "1000 JPY", "leverage400": "250 USD", "leverage200": "500 USD", "leverage100": "1000 USD", "baseCurrency": "NZD", "pricingCurrency": "JPY", "marginType": "Fixed"},
            {"product": "EURHUF", "name": "Euro/Hungarian Forint", "contractSize": 100000, "pipValuePerLot": "1000 HUF", "leverage400": "2000 EUR", "leverage200": "2000 EUR", "leverage100": "4000 EUR", "baseCurrency": "EUR", "pricingCurrency": "HUF", "marginType": "Fixed"},
            {"product": "EURPLN", "name": "Euro/Polish Zloty", "contractSize": 100000, "pipValuePerLot": "10 PLN", "leverage400": "2000 EUR", "leverage200": "2000 EUR", "leverage100": "4000 EUR", "baseCurrency": "EUR", "pricingCurrency": "PLN", "marginType": "Fixed"},
            {"product": "XAUEUR", "name": "Spot Gold/Euro", "contractSize": 100, "pipValuePerLot": "10 EUR", "leverage400": "250 EUR", "leverage200": "500 EUR", "leverage100": "1000 EUR", "baseCurrency": "", "pricingCurrency": "EUR", "marginType": "Fixed"},
            {"product": "HK50", "name": "Hong Kong HS50 Spot Index (CFD)", "contractSize": 50, "pipValuePerLot": "50 HKD", "leverage400": "1:100", "leverage200": "1:100", "leverage100": "1:100", "baseCurrency": "", "pricingCurrency": "HKD", "marginType": "Floating"},
            {"product": "HKCH50", "name": "Hong Kong China H-Shares Spot Index (CFD)", "contractSize": 50, "pipValuePerLot": "50 HKD", "leverage400": "1:100", "leverage200": "1:100", "leverage100": "1:100", "baseCurrency": "", "pricingCurrency": "HKD", "marginType": "Floating"},
            {"product": "AUS200", "name": "Australian S&P/ASX Spot Index (CFD)", "contractSize": 20, "pipValuePerLot": "20 AUD", "leverage400": "1:100", "leverage200": "1:100", "leverage100": "1:100", "baseCurrency": "", "pricingCurrency": "AUD", "marginType": "Floating"},
            {"product": "EU50", "name": "Euro Stoxx 50 Spot Index (CFD)", "contractSize": 30, "pipValuePerLot": "30 EUR", "leverage400": "1:100", "leverage200": "1:100", "leverage100": "1:100", "baseCurrency": "", "pricingCurrency": "EUR", "marginType": "Floating"},
            {"product": "ESP35", "name": "Spain IBEX 35 Spot Index (CFD)", "contractSize": 10, "pipValuePerLot": "10 EUR", "leverage400": "1:100", "leverage200": "1:100", "leverage100": "1:100", "baseCurrency": "", "pricingCurrency": "EUR", "marginType": "Floating"},
            {"product": "FRA40", "name": "French CAC 40 Spot Index (CFD)", "contractSize": 20, "pipValuePerLot": "10 EUR", "leverage400": "1:100", "leverage200": "1:100", "leverage100": "1:100", "baseCurrency": "", "pricingCurrency": "EUR", "marginType": "Floating"},
            {"product": "GER30", "name": "German 30 Spot Index (CFD)", "contractSize": 10, "pipValuePerLot": "10 EUR", "leverage400": "1:100", "leverage200": "1:100", "leverage100": "1:100", "baseCurrency": "", "pricingCurrency": "EUR", "marginType": "Floating"},
            {"product": "IT40", "name": "Italy MIB 40 Spot Index (CFD)", "contractSize": 10, "pipValuePerLot": "10 EUR", "leverage400": "1:100", "leverage200": "1:100", "leverage100": "1:100", "baseCurrency": "", "pricingCurrency": "EUR", "marginType": "Floating"},
            {"product": "UK100", "name": "UK FTSE 100 Spot Index (CFD)", "contractSize": 10, "pipValuePerLot": "10 GBP", "leverage400": "1:100", "leverage200": "1:100", "leverage100": "1:100", "baseCurrency": "", "pricingCurrency": "GBP", "marginType": "Floating"}
        ];</script></head><body class="min-h-screen bg-custom"><div class="container mx-auto px-4 py-8 max-w-6xl"><!-- 页面标题 --><div class="text-center mb-8"><h1 class="text-4xl font-bold text-gray-800 mb-2"><i class="fas fa-calculator text-blue-600 mr-3"></i>PnL Calculator</h1><p class="text-gray-600 text-lg">Calculate Profits, Losses and Margin Precisely</p></div><!-- 主要内容区域 --><div class="bg-white rounded-2xl shadow-xl overflow-hidden"><!-- 表单区域 --><div class="p-8"><form class="space-y-6" id="pnlForm"><!-- 计算选项 --><div class="grid grid-cols-1 md:grid-cols-2 gap-6"><!-- 多订单选项 --><div class="flex items-center"><input class="w-5 h-5 text-blue-600 focus:ring-blue-500 border-gray-300 rounded" id="multipleOrders" type="checkbox"/><label class="ml-2 text-gray-700 font-medium" for="multipleOrders">Calculate Multiple Orders</label></div><!-- 仓位计算选项 --><div class="flex items-center"><input class="w-5 h-5 text-blue-600 focus:ring-blue-500 border-gray-300 rounded" id="positionCalculation" type="checkbox"/><label class="ml-2 text-gray-700 font-medium" for="positionCalculation">Include Position Calculations</label></div></div><!-- 余额输入框 (默认隐藏) --><div class="hidden" id="balanceContainer"><label class="block text-gray-700 font-semibold mb-2" for="balance"><i class="fas fa-wallet text-green-600 mr-2"></i>Account Balance (USD)</label><input class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" id="balance" min="0" placeholder="0.00" step="0.01" type="number"/></div><div class="hidden" id="globalCommissionContainer"><label class="block text-gray-700 font-semibold mb-2" for="globalCommissionRate"><i class="fas fa-receipt text-blue-600 mr-2"></i>Commission per lot</label><input class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" id="globalCommissionRate" placeholder="e.g., 7" step="any" type="number"/><p class="text-gray-500 text-sm mt-1">Commission per order = Lots × Commission per lot</p></div><!-- 订单管理按钮 (默认隐藏) --><div class="hidden" id="orderManagement"><div class="flex justify-between items-center"><h3 class="text-lg font-semibold text-gray-800"><i class="fas fa-list-alt text-blue-600 mr-2"></i>Order List</h3><button class="bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-lg transition-all" id="addOrderBtn" type="button"><i class="fas fa-plus mr-1"></i>Add Order</button></div></div><!-- 订单容器 --><div id="ordersContainer"><!-- 默认订单表单 --><div class="order-form bg-gray-50 p-6 rounded-xl mb-6" data-order-id="1"><div class="flex justify-between items-center mb-4"><h4 class="font-semibold text-gray-800">Order #1</h4><button class="remove-order-btn text-red-500 hover:text-red-700 transition-colors hidden" data-order-id="1" type="button"><i class="fas fa-trash"></i>Remove</button></div><!-- 产品搜索和选择 --><div class="relative mb-6"><label class="block text-gray-700 font-semibold mb-2" for="productSearch_1"><i class="fas fa-search text-blue-600 mr-2"></i>Product Search</label><div class="relative"><input class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" id="productSearch_1" placeholder="Search by product code or name..." type="text"/><div class="absolute w-full bg-white rounded-lg shadow-lg mt-1 z-10 max-h-60 overflow-y-auto hidden" id="searchResults_1"><!-- 搜索结果将动态显示在这里 --></div></div><div class="mt-2 p-3 bg-blue-50 rounded-lg hidden" id="selectedProduct_1"><div class="flex justify-between items-center"><div><span class="font-bold text-blue-800" id="productCode_1"></span><span class="text-gray-600 ml-2" id="productName_1"></span></div><button class="clear-product-btn text-red-500 hover:text-red-700" data-order-id="1" type="button"><i class="fas fa-times"></i></button></div></div></div><!-- 产品信息显示 --><div class="grid grid-cols-1 md:grid-cols-3 gap-4 p-4 bg-white rounded-lg hidden mb-6" id="productInfo_1"><div><p class="text-sm text-gray-600">Contract Size</p><p class="font-semibold" id="contractSize_1"></p></div><div><p class="text-sm text-gray-600">Pip Value per Lot</p><p class="font-semibold" id="pipValue_1"></p></div><div><p class="text-sm text-gray-600">Pricing Currency</p><p class="font-semibold" id="pricingCurrency_1"></p></div><div><p class="text-sm text-gray-600">Base Currency</p><p class="font-semibold" id="baseCurrency_1"></p></div><div><p class="text-sm text-gray-600">Margin Type</p><p class="font-semibold capitalize" id="marginType_1"></p></div><div><p class="text-sm text-gray-600">Margin per Lot (for selected leverage)</p><p class="font-semibold" id="perLotMargin_1"></p></div></div><!-- 交易详情 --><div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"><div><label class="block text-gray-700 font-semibold mb-2" for="tradeType_1"><i class="fas fa-exchange-alt text-green-600 mr-2"></i>Trade Type</label><select class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" disabled="" id="tradeType_1"><option value="buy">Buy</option><option value="sell">Sell</option></select></div><div><label class="block text-gray-700 font-semibold mb-2" for="leverage_1"><i class="fas fa-percentage text-purple-600 mr-2"></i>Select Leverage</label><select class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all leverage-select" disabled="" id="leverage_1"><option value="400">1:400</option><option value="200">1:200</option><option value="100">1:100</option></select></div></div><div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6"><div><label class="block text-gray-700 font-semibold mb-2" for="lots_1"><i class="fas fa-layer-group text-orange-600 mr-2"></i>Lots</label><input class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" disabled="" id="lots_1" min="0.01" placeholder="0.01" step="0.01" type="number"/></div><div><label class="block text-gray-700 font-semibold mb-2" for="openPrice_1"><i class="fas fa-arrow-up text-green-600 mr-2"></i>Open Price</label><input class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" disabled="" id="openPrice_1" min="0" placeholder="0.00000" step="0.00001" type="number"/></div><div><label class="block text-gray-700 font-semibold mb-2" for="closePrice_1"><i class="fas fa-arrow-down text-red-600 mr-2"></i>Close Price</label><input class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" disabled="" id="closePrice_1" min="0" placeholder="0.00000" step="0.00001" type="number"/></div></div><!-- 汇率输入 --><div class="mb-4 hidden" id="exchangeRateContainer_1"><label class="block text-gray-700 font-semibold mb-2" for="exchangeRate_1"><i class="fas fa-money-bill-wave text-teal-600 mr-2"></i>Exchange Rate Required</label><input class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" id="exchangeRate_1" min="0.00001" placeholder="Enter exchange rate" step="0.00001" type="number"/><p class="text-xs text-amber-600 mt-1 font-medium" id="exchangeRateHint_1">Please enter the exchange rate</p></div><!-- EURUSD汇率输入 (仅特定产品显示) --><div class="hidden" id="eurusdRateContainer_1"><label class="block text-gray-700 font-semibold mb-2" for="eurusdRate_1"><i class="fas fa-money-bill-wave text-purple-600 mr-2"></i>EURUSD Exchange Rate Required</label><input class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all" id="eurusdRate_1" min="0.00001" placeholder="Enter EURUSD rate" step="0.00001" type="number"/><p class="text-xs text-amber-600 mt-1 font-medium">Please enter the EURUSD exchange rate for margin conversion to USD</p></div></div></div><!-- 计算按钮 --><div class="text-center"><button class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg transition-all transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed" disabled="" id="calculateBtn" type="button"><i class="fas fa-calculator mr-2"></i>Calculate PnL &amp; Margin</button></div></form></div><!-- 结果显示区域 --><div class="bg-gradient-to-r from-blue-600 to-indigo-700 text-white p-8 hidden" id="resultsSection"><h2 class="text-2xl font-bold mb-6 text-center"><i class="fas fa-chart-line mr-2"></i>Calculation Results</h2><!-- 汇率提示 --><div class="bg-yellow-500 bg-opacity-20 rounded-xl p-4 backdrop-blur-sm mb-6 hidden" id="exchangeRateNote"><p class="text-sm flex items-center"><i class="fas fa-info-circle mr-2"></i>Please be advised that due to exchange rate fluctuations, the final amount may differ slightly from the actual order total.</p></div><!-- 对冲仓位提示 --><div class="bg-yellow-500 bg-opacity-20 rounded-xl p-4 backdrop-blur-sm mb-6 hidden" id="hedgeNotice"><h3 class="text-lg font-semibold flex items-center"><i class="fas fa-info-circle mr-2"></i>Hedge Position Detected</h3><p class="text-sm mt-2" id="hedgeDetails"></p></div><!-- 多订单汇总结果 --><div class="bg-white bg-opacity-10 rounded-xl p-6 backdrop-blur-sm mb-8 hidden" id="summaryResults"><h3 class="text-lg font-semibold mb-4"><i class="fas fa-calculator-alt mr-2"></i>Total Summary</h3><div class="grid grid-cols-1 md:grid-cols-3 gap-6"><!-- Total PnL (excl. commission) --><div><div class="text-sm opacity-80">Total PnL (excl. commission)</div><div class="text-3xl font-bold" id="totalPnLNoCommissionInUSD"></div></div><!-- Total PnL (incl. commission) --><div><div class="text-sm opacity-80">Total PnL (incl. commission)</div><div class="text-3xl font-bold" id="totalPnLWithCommissionInUSD"></div></div><!-- Total Margin in USD --><div><p class="text-sm opacity-80">Total Margin in USD</p><p class="text-3xl font-bold" id="totalMarginInUSD"></p></div></div></div><!-- 单个订单结果 --><div class="space-y-6" id="individualResults"><!-- 单个结果将动态插入到这里 --></div><!-- 仓位计算结果 (默认隐藏) --><div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-8 hidden" id="positionResults"><div class="bg-white bg-opacity-10 rounded-xl p-6 backdrop-blur-sm"><h3 class="text-lg font-semibold mb-4"><i class="fas fa-money-check-alt mr-2"></i>Equity</h3><div class="text-3xl font-bold" id="equity"></div><div class="text-sm opacity-80 mt-1">Balance + Total PnL</div></div><div class="bg-white bg-opacity-10 rounded-xl p-6 backdrop-blur-sm"><h3 class="text-lg font-semibold mb-4"><i class="fas fa-wallet mr-2"></i>Free Margin</h3><div class="text-3xl font-bold" id="freeMargin"></div><div class="text-sm opacity-80 mt-1">Equity - Total Margin</div></div><div class="bg-white bg-opacity-10 rounded-xl p-6 backdrop-blur-sm"><h3 class="text-lg font-semibold mb-4"><i class="fas fa-percent mr-2"></i>Margin Ratio</h3><div class="text-3xl font-bold" id="marginRatio"></div><div class="text-sm opacity-80 mt-1">Equity / Total Margin × 100%</div></div></div><!-- 详细计算过程 --><div class="mt-8 bg-white bg-opacity-10 rounded-xl p-6 backdrop-blur-sm"><h3 class="text-lg font-semibold mb-4"><i class="fas fa-calculator mr-2"></i>Calculation Details</h3><div class="space-y-4 text-sm" id="calculationDetails"><!-- 计算过程将动态显示在这里 --></div></div></div></div><!-- 最近计算历史 --><div class="mt-8 bg-white rounded-2xl shadow-xl overflow-hidden"><div class="p-6 border-b border-gray-200"><h2 class="text-xl font-bold text-gray-800"><i class="fas fa-history text-blue-600 mr-2"></i>Recent Calculations</h2></div><div class="p-6 max-h-60 overflow-y-auto" id="historyList"><p class="text-gray-500 text-center italic" id="noHistory">No calculation history yet</p><!-- 历史记录将动态显示在这里 --></div></div><!-- 页脚 --><div class="mt-8 text-center text-gray-600 py-4"><p>This page is developed by ATFX HKCS Team</p></div></div><script>// 全局变量
        let calculationHistory = [];
        let orderCount = 1;
        let currentLeverage = "400"; // 默认杠杆
        
        // 需要EURUSD汇率的产品列表
        const productsNeedingEurusd = ['EURHUF', 'EURPLN', 'XAUEUR'];
            // Futures Products (hedged portion margin = 50%)
            const futuresProducts = ['GOLD_MMMYY','HG_MMMYY','USOIL.MMMYY','UKOIL.MMMYY','NGAS.MMMYY','USDX_MMMYY'];
            // Products whose hedged portion keeps 50% margin
            const fiftyPercentHedgeProducts = ['GOLD_MMMYY','HG_MMMYY','USOIL.MMMYY','UKOIL.MMMYY','NGAS.MMMYY','USDX_MMMYY'];
        
        // 页面加载后初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 绑定事件监听器
            document.getElementById('addOrderBtn').addEventListener('click', addNewOrder);
            document.getElementById('calculateBtn').addEventListener('click', calculateAllOrders);
            document.getElementById('positionCalculation').addEventListener('change', togglePositionCalculation);
            document.getElementById('multipleOrders').addEventListener('change', toggleMultipleOrders);
            
            // 初始化杠杆同步
            document.addEventListener('change', function(e) {
                if (e.target.classList.contains('leverage-select') && !e.target.disabled) {
                    syncLeverageAcrossOrders(e.target.value);
                }
            });
            
            // 初始化第一个订单
            initOrderEvents(1);
            
            // 为删除按钮添加事件委托
            document.getElementById('ordersContainer').addEventListener('click', function(e) {
                if (e.target.closest('.remove-order-btn')) {
                    const btn = e.target.closest('.remove-order-btn');
                    const orderId = parseInt(btn.getAttribute('data-order-id'));
                    removeOrder(orderId);
                }
            });
            
            // 添加输入事件监听器以更新计算按钮状态
            document.addEventListener('input', updateCalculateButtonState);
            document.addEventListener('change', updateCalculateButtonState);
        });
        
        // 在所有订单间同步杠杆
        function syncLeverageAcrossOrders(leverageValue) {
            currentLeverage = leverageValue;
            
            // 更新所有杠杆下拉框
            const leverageSelects = document.querySelectorAll('.leverage-select');
            leverageSelects.forEach(select =>{
                // 如果选择框已设置为此值或禁用，则跳过
                if (select.value !== leverageValue && !select.disabled) {
                    select.value = leverageValue;
                    
                    // 更新此订单的每手保证金显示
                    const orderId = select.id.split('_')[1];
                    updatePerLotMargin(orderId);
                }
            });
        }
        
        // 切换多订单功能
        function toggleMultipleOrders() {
            const multipleOrdersEnabled = this.checked;
            const orderManagement = document.getElementById('orderManagement');
            const removeButtons = document.querySelectorAll('.remove-order-btn');
            
            if (multipleOrdersEnabled) {
                orderManagement.classList.remove('hidden');
                // 显示所有订单的删除按钮，除非只有一个订单
                if (removeButtons.length >1) {
                    removeButtons.forEach(btn =>btn.classList.remove('hidden'));
                } else if (removeButtons.length === 1) {
                    removeButtons[0].classList.add('hidden');
                }
            } else {
                orderManagement.classList.add('hidden');
                // 隐藏所有删除按钮
                removeButtons.forEach(btn =>btn.classList.add('hidden'));
                
                // 移除额外订单，只保留第一个
                const orderForms = document.querySelectorAll('.order-form');
                if (orderForms.length >1) {
                    for (let i = orderForms.length - 1; i >0; i--) {
                        orderForms[i].remove();
                    }
                    orderCount = 1;
                }
            }
            
            updateCalculateButtonState();
        }
        
        // 切换仓位计算部分
        function togglePositionCalculation() {
            const balanceContainer = document.getElementById('balanceContainer');
            if (this.checked) {
                balanceContainer.classList.remove('hidden');
            } else {
                balanceContainer.classList.add('hidden');
            }
            const globalCommission = document.getElementById('globalCommissionContainer');
            if (globalCommission) { if (this.checked) globalCommission.classList.remove('hidden'); else globalCommission.classList.add('hidden'); }
            updateCalculateButtonState();
        }
        
        // 添加新订单表单
	function addNewOrder() {
    	// Keep numbering contiguous after deletions: next order is (current forms count + 1)
    	orderCount = document.querySelectorAll('.order-form').length + 1;
    	const ordersContainer = document.getElementById('ordersContainer');

            
            // 克隆第一个订单表单
            const firstOrder = document.querySelector('.order-form');
            const newOrder = firstOrder.cloneNode(true);
            
            // 更新新订单的ID和属性
            newOrder.setAttribute('data-order-id', orderCount);
            newOrder.querySelector('h4').textContent = `Order #${orderCount}`;
            newOrder.querySelector('.remove-order-btn').setAttribute('data-order-id', orderCount);
            
            // 如果启用了多订单，显示删除按钮
            if (document.getElementById('multipleOrders').checked) {
                newOrder.querySelector('.remove-order-btn').classList.remove('hidden');
            }
            
            // 更新新订单中所有元素的ID
            const elements = newOrder.querySelectorAll('[id]');
            elements.forEach(element =>{
                const id = element.getAttribute('id');
                if (id) {
                    const newId = id.replace(/_\d+$/, `_${orderCount}`);
                    element.setAttribute('id', newId);
                }
            });
            
            // 更新label的for属性
            const labels = newOrder.querySelectorAll('label[for]');
            labels.forEach(label =>{
                const forAttr = label.getAttribute('for');
                if (forAttr) {
                    const newFor = forAttr.replace(/_\d+$/, `_${orderCount}`);
                    label.setAttribute('for', newFor);
                }
            });
            
            // 设置杠杆以匹配当前选择
            const leverageSelect = newOrder.querySelector('.leverage-select');
            leverageSelect.value = currentLeverage;
            
            // 重置表单值
            newOrder.querySelector(`[id^="selectedProduct_"]`).classList.add('hidden');
            newOrder.querySelector(`[id^="productInfo_"]`).classList.add('hidden');
            newOrder.querySelector(`[id^="exchangeRateContainer_"]`).classList.add('hidden');
            newOrder.querySelector(`[id^="eurusdRateContainer_"]`).classList.add('hidden');
            
            // 将新订单添加到容器
            ordersContainer.appendChild(newOrder);
            
            // 初始化新订单的事件
            initOrderEvents(orderCount);
            
            // 重置新订单的表单字段
            resetOrderForm(orderCount);
            
            updateCalculateButtonState();
        }
        
        // 初始化订单表单的事件
        function initOrderEvents(orderId) {
    // limit queries within the current order form and add null-safety
    const orderRoot = document.querySelector(`.order-form[data-order-id="${orderId}"]`);
    if (!orderRoot) return;

    // product search input
    const searchInput = orderRoot.querySelector(`#productSearch_${orderId}`);
    if (!searchInput) return;
    const newSearchInput = searchInput.cloneNode(true);
    searchInput.parentNode.replaceChild(newSearchInput, searchInput);
    newSearchInput.addEventListener('input', function() {
        handleProductSearch(orderId, this.value);
    });

    // clear selected product
    const clearBtn = orderRoot.querySelector(`.clear-product-btn[data-order-id="${orderId}"]`);
    if (clearBtn) {
        const newClearBtn = clearBtn.cloneNode(true);
        clearBtn.parentNode.replaceChild(newClearBtn, clearBtn);
        newClearBtn.addEventListener('click', function() {
            clearSelectedProduct(orderId);
            updateCalculateButtonState();
        });
    }

    // click outside to hide search results (scoped)
    document.addEventListener('click', function(e) {
        const searchBox = orderRoot.querySelector(`#productSearch_${orderId}`);
        const container = searchBox ? searchBox.closest('.relative') : null;
        if (container && !container.contains(e.target)) {
            const list = document.getElementById(`searchResults_${orderId}`);
            if (list) list.classList.add('hidden');
        }
    });
}

        
        // 移除订单
        function removeOrder(orderId) {
            const orderForm = document.querySelector(`.order-form[data-order-id="${orderId}"]`);
            if (orderForm) {
                orderForm.remove();
                
                // 如果启用了多订单，更新订单编号
                if (document.getElementById('multipleOrders').checked) {
                    const remainingOrders = Array.from(document.querySelectorAll('.order-form'));
                    remainingOrders.forEach((order, index) =>{
                        const newOrderId = index + 1;
                        const oldOrderId = order.getAttribute('data-order-id');
                        
                        // 如果已具有正确ID，则跳过
                        if (parseInt(oldOrderId) === newOrderId) return;
                        
                        // 更新数据属性
                        order.setAttribute('data-order-id', newOrderId);
                        
                        // 更新标题
                        order.querySelector('h4').textContent = `Order #${newOrderId}`;
                        
                        // 更新删除按钮
                        const removeBtn = order.querySelector('.remove-order-btn');
                        if (removeBtn) {
                            removeBtn.setAttribute('data-order-id', newOrderId);
                        }
                        
                        // 更新订单中所有元素的ID
                        const elements = order.querySelectorAll('[id]');
                        elements.forEach(element =>{
                            const id = element.getAttribute('id');
                            if (id) {
                                const newId = id.replace(`_${oldOrderId}`, `_${newOrderId}`);
                                element.setAttribute('id', newId);
                            }
                        });
                        
                        // 更新label的for属性
                        const labels = order.querySelectorAll('label[for]');
                        labels.forEach(label =>{
                            const forAttr = label.getAttribute('for');
                            if (forAttr) {
                                const newFor = forAttr.replace(`_${oldOrderId}`, `_${newOrderId}`);
                                label.setAttribute('for', newFor);
                            }
                        });
                        
                        // 使用新ID重新初始化此订单的事件
                        initOrderEvents(newOrderId);
                    });
                    
                    orderCount = remainingOrders.length;
                    
                    // 如果只剩下一个订单，隐藏删除按钮
                    if (remainingOrders.length === 1) {
                        remainingOrders[0].querySelector('.remove-order-btn').classList.add('hidden');
                    }
                }
                
                updateCalculateButtonState();
            }
        }
        
        // 重置订单表单
        function resetOrderForm(orderId) {
            document.getElementById(`productSearch_${orderId}`).value = '';
            document.getElementById(`tradeType_${orderId}`).disabled = true;
            document.getElementById(`leverage_${orderId}`).disabled = true;
            document.getElementById(`lots_${orderId}`).disabled = true;
            document.getElementById(`openPrice_${orderId}`).disabled = true;
            document.getElementById(`closePrice_${orderId}`).disabled = true;
            document.getElementById(`lots_${orderId}`).value = '';
            document.getElementById(`openPrice_${orderId}`).value = '';
            document.getElementById(`closePrice_${orderId}`).value = '';
            document.getElementById(`exchangeRate_${orderId}`).value = '';
            document.getElementById(`eurusdRate_${orderId}`).value = '';
        }
        
        // 处理特定订单的产品搜索
        function handleProductSearch(orderId, searchTerm) {
            const resultsContainer = document.getElementById(`searchResults_${orderId}`);
            resultsContainer.innerHTML = '';
            
            if (searchTerm.length< 1) {
                resultsContainer.classList.add('hidden');
                return;
            }
            
            // 搜索匹配的产品
            const matchingProducts = productsData.filter(product =>{
                return product.product.toLowerCase().includes(searchTerm.toLowerCase()) || 
                       product.name.toLowerCase().includes(searchTerm.toLowerCase());
            });
            
            if (matchingProducts.length === 0) {
                resultsContainer.innerHTML = '<div class="p-3 text-gray-500">No matching products found</div>';
                resultsContainer.classList.remove('hidden');
                return;
            }
            
            // 显示搜索结果
            matchingProducts.forEach(product =>{
                const resultItem = document.createElement('div');
                resultItem.className = 'p-3 hover:bg-blue-50 cursor-pointer transition-colors border-b border-gray-100';
                resultItem.innerHTML = `<div class="font-semibold text-gray-800">${product.product}</div><div class="text-sm text-gray-600">${product.name}</div><div class="text-xs text-gray-500 mt-1">Margin Type: ${product.marginType} | Margin per lot at 1:400 leverage: ${product.leverage400}</div>`;
                resultItem.addEventListener('click', () =>{
                    selectProduct(orderId, product);
                    updateCalculateButtonState();
                });
                resultsContainer.appendChild(resultItem);
            });
            
            resultsContainer.classList.remove('hidden');
        }
        
        // 为特定订单选择产品
        function selectProduct(orderId, product) {
            // 更新UI
            document.getElementById(`productCode_${orderId}`).textContent = product.product;
            document.getElementById(`productName_${orderId}`).textContent = product.name;
            document.getElementById(`selectedProduct_${orderId}`).classList.remove('hidden');
            document.getElementById(`searchResults_${orderId}`).classList.add('hidden');
            document.getElementById(`productSearch_${orderId}`).value = '';
            
            // 在元素上存储产品数据供以后使用
            document.getElementById(`selectedProduct_${orderId}`).setAttribute('data-product', JSON.stringify(product));
            
            // 显示产品信息
            document.getElementById(`contractSize_${orderId}`).textContent = product.contractSize.toLocaleString();
            document.getElementById(`pipValue_${orderId}`).textContent = product.pipValuePerLot;
            document.getElementById(`pricingCurrency_${orderId}`).textContent = product.pricingCurrency;
            document.getElementById(`baseCurrency_${orderId}`).textContent = product.baseCurrency || '-';
            document.getElementById(`marginType_${orderId}`).textContent = product.marginType;
            
            // 根据当前杠杆更新每手保证金
            updatePerLotMargin(orderId);
            
            document.getElementById(`productInfo_${orderId}`).classList.remove('hidden');
            
            // 确定是否显示汇率输入
            const pricingCurrency = product.pricingCurrency;
            const exchangeRateContainer = document.getElementById(`exchangeRateContainer_${orderId}`);
            const exchangeRateHint = document.getElementById(`exchangeRateHint_${orderId}`);
            
            if (pricingCurrency !== 'USD') {
                exchangeRateContainer.classList.remove('hidden');
                exchangeRateHint.textContent = `Required: 1 ${pricingCurrency} = ? USD`;
                document.getElementById(`exchangeRate_${orderId}`).setAttribute('placeholder', `1 ${pricingCurrency} = X USD`);
            } else {
                exchangeRateContainer.classList.add('hidden');
            }
            
            // 对于特定产品，显示EURUSD汇率输入
            const eurusdRateContainer = document.getElementById(`eurusdRateContainer_${orderId}`);
            if (productsNeedingEurusd.includes(product.product)) {
                eurusdRateContainer.classList.remove('hidden');
            } else {
                eurusdRateContainer.classList.add('hidden');
            }
            
            // 启用表单字段
            document.getElementById(`tradeType_${orderId}`).disabled = false;
            document.getElementById(`leverage_${orderId}`).disabled = false;
            document.getElementById(`lots_${orderId}`).disabled = false;
            document.getElementById(`openPrice_${orderId}`).disabled = false;
            document.getElementById(`closePrice_${orderId}`).disabled = false;
        }
        
        // 清除特定订单的选定产品
        function clearSelectedProduct(orderId) {
            document.getElementById(`selectedProduct_${orderId}`).classList.add('hidden');
            document.getElementById(`productInfo_${orderId}`).classList.add('hidden');
            document.getElementById(`exchangeRateContainer_${orderId}`).classList.add('hidden');
            document.getElementById(`eurusdRateContainer_${orderId}`).classList.add('hidden');
            
            // 禁用表单字段
            document.getElementById(`tradeType_${orderId}`).disabled = true;
            document.getElementById(`leverage_${orderId}`).disabled = true;
            document.getElementById(`lots_${orderId}`).disabled = true;
            document.getElementById(`openPrice_${orderId}`).disabled = true;
            document.getElementById(`closePrice_${orderId}`).disabled = true;
        }
        
        // 当杠杆变化时更新"每手保证金"显示
        function updatePerLotMargin(orderId) {
            const productElement = document.getElementById(`selectedProduct_${orderId}`);
            if (!productElement || productElement.classList.contains('hidden')) return;
            
            const product = JSON.parse(productElement.getAttribute('data-product'));
            const selectedLeverage = document.getElementById(`leverage_${orderId}`).value;
            let perLotMargin = '';
            
            switch(selectedLeverage) {
                case '400':
                    perLotMargin = product.leverage400;
                    break;
                case '200':
                    perLotMargin = product.leverage200;
                    break;
                case '100':
                    perLotMargin = product.leverage100;
                    break;
            }
            
            document.getElementById(`perLotMargin_${orderId}`).textContent = perLotMargin;
        }
        
        // 根据表单有效性更新计算按钮状态
        function updateCalculateButtonState() {
            const calculateBtn = document.getElementById('calculateBtn');
            const orderForms = document.querySelectorAll('.order-form');
            let allOrdersValid = true;
            
            // 检查每个订单的有效数据
            orderForms.forEach(orderForm =>{
                const orderId = orderForm.getAttribute('data-order-id');
                const productSelected = !document.getElementById(`selectedProduct_${orderId}`).classList.contains('hidden');
                
                // 检查是否选择了产品
                if (!productSelected) {
                    allOrdersValid = false;
                    return; // 退出当前订单的循环
                }
                
                // 获取产品数据
                const productElement = document.getElementById(`selectedProduct_${orderId}`);
                const product = JSON.parse(productElement.getAttribute('data-product'));
                
                // 获取表单值
                const lotsInput = document.getElementById(`lots_${orderId}`);
                const openPriceInput = document.getElementById(`openPrice_${orderId}`);
                const closePriceInput = document.getElementById(`closePrice_${orderId}`);
                
                // 检查必填字段是否有值
                if (!lotsInput.value || !openPriceInput.value || !closePriceInput.value) {
                    allOrdersValid = false;
                    return;
                }
                
                // 验证数值
                const lotsNum = parseFloat(lotsInput.value);
                const openPriceNum = parseFloat(openPriceInput.value);
                const closePriceNum = parseFloat(closePriceInput.value);
                
                if (isNaN(lotsNum) || isNaN(openPriceNum) || isNaN(closePriceNum) || 
                    lotsNum<= 0 || openPriceNum<= 0 || closePriceNum<= 0) {
                    allOrdersValid = false;
                    return;
                }
                
                // 检查是否需要汇率且有效
                if (product.pricingCurrency !== 'USD') {
                    const exchangeRateInput = document.getElementById(`exchangeRate_${orderId}`);
                    if (!exchangeRateInput.value) {
                        allOrdersValid = false;
                        return;
                    }
                    
                    const exchangeRateNum = parseFloat(exchangeRateInput.value);
                    if (isNaN(exchangeRateNum) || exchangeRateNum<= 0) {
                        allOrdersValid = false;
                        return;
                    }
                }
                
                // 对于特定产品，检查EURUSD汇率是否有效
                if (productsNeedingEurusd.includes(product.product)) {
                    const eurusdRateInput = document.getElementById(`eurusdRate_${orderId}`);
                    if (!eurusdRateInput.value) {
                        allOrdersValid = false;
                        return;
                    }
                    
                    const eurusdRateNum = parseFloat(eurusdRateInput.value);
                    if (isNaN(eurusdRateNum) || eurusdRateNum<= 0) {
                        allOrdersValid = false;
                        return;
                    }
                }
            });
            
            // 如果启用了仓位计算，检查账户余额
            const positionCalculationEnabled = document.getElementById('positionCalculation').checked;
            if (positionCalculationEnabled) {
                const balanceInput = document.getElementById('balance');
                if (!balanceInput.value) {
                    allOrdersValid = false;
                } else {
                    const balanceNum = parseFloat(balanceInput.value);
                    if (isNaN(balanceNum) || balanceNum<= 0) {
                        allOrdersValid = false;
                    }
                }
            }
            
            // 更新按钮状态
            calculateBtn.disabled = !allOrdersValid;
        }
        
        // 使用对冲仓位逻辑计算所有订单
        function calculateAllOrders() {
            const orderForms = document.querySelectorAll('.order-form');
            const multipleOrdersEnabled = document.getElementById('multipleOrders').checked;
            const positionCalculationEnabled = document.getElementById('positionCalculation').checked;
            
            // 检查是否有任何订单使用汇率转换
            let usesExchangeRate = false;
            
            // 首先，计算所有单个订单
            let allOrderResults = [];
            orderForms.forEach(orderForm =>{
                const orderId = parseInt(orderForm.getAttribute('data-order-id'));
                const result = calculateSingleOrder(orderId);
                
                if (result) {
                    allOrderResults.push(result);
                    
                    // 检查此订单是否使用汇率
                    if (result.product.pricingCurrency !== 'USD' || 
                        productsNeedingEurusd.includes(result.product.product)) {
                        usesExchangeRate = true;
                    }
                }
            });
            
            // 按产品分组订单以进行对冲计算
            const products = {};
            allOrderResults.forEach(order =>{
                const productCode = order.product.product;
                if (!products[productCode]) {
                    products[productCode] = {
                        product: order.product,
                        buyOrders: [],
                        sellOrders: [],
                        totalBuyLots: 0,
                        totalSellLots: 0
                    };
                }
                
                if (order.tradeType === 'buy') {
                    products[productCode].buyOrders.push(order);
                    products[productCode].totalBuyLots += order.lots;
                } else {
                    products[productCode].sellOrders.push(order);
                    products[productCode].totalSellLots += order.lots;
                }
            });
            
            // 计算对冲仓位并调整保证金
            let hasHedgePositions = false;
            let hedgeDetails = [];
            
            Object.values(products).forEach(productData =>{
                // 检查此产品是否同时有买入和卖出订单
                if (productData.totalBuyLots >0 && productData.totalSellLots >0) {
                    hasHedgePositions = true;
                    
                    // 计算对冲金额（买入和卖出的最小值）
                    const hedgedLots = Math.min(productData.totalBuyLots, productData.totalSellLots);
                    const remainingBuyLots = productData.totalBuyLots - hedgedLots;
                    const remainingSellLots = productData.totalSellLots - hedgedLots;
                    
                    // 添加到对冲详情
                    hedgeDetails.push(`${productData.product.product}: ${hedgedLots} lots hedged (${productData.totalBuyLots} buy / ${productData.totalSellLots} sell)`);
                    
                    // 计算此产品的每手保证金
                    const leverage = productData.buyOrders.length >0 
                        ? productData.buyOrders[0].selectedLeverage 
                        : productData.sellOrders[0].selectedLeverage;
                    
                    const perLotMarginMatch = productData.product[`leverage${leverage}`].match(/^(\d+\.?\d*) ([A-Z]{3})$/);
                    if (perLotMarginMatch) {
                        const perLotMarginAmount = parseFloat(perLotMarginMatch[1]);
                        const marginCurrency = perLotMarginMatch[2];
                        
                        // 调整买入订单的保证金
                        let remainingBuyToAllocate = remainingBuyLots;
                        productData.buyOrders.forEach(order =>{
                            if (remainingBuyToAllocate<= 0) {
                                // 此订单完全对冲
                                order.originalMarginInUSD = order.marginInUSD;
                                order.marginInUSD = 0;
                                order.isHedged = true;
                                order.hedgedLots = order.lots;
                            } else {
                                // 部分对冲
                                const hedgedInThisOrder = Math.max(0, order.lots - remainingBuyToAllocate);
                                if (hedgedInThisOrder >0) {
                                    order.originalMarginInUSD = order.marginInUSD;
                                    const hedgedPercentage = hedgedInThisOrder / order.lots;
                                    order.marginInUSD *= (1 - hedgedPercentage);
                                    order.isHedged = true;
                                    order.hedgedLots = hedgedInThisOrder;
                                    remainingBuyToAllocate -= (order.lots - hedgedInThisOrder);
                                } else {
                                    order.isHedged = false;
                                    order.hedgedLots = 0;
                                }
                            }
                        });
                        
                        // 调整卖出订单的保证金
                        let remainingSellToAllocate = remainingSellLots;
                        productData.sellOrders.forEach(order =>{
                            if (remainingSellToAllocate<= 0) {
                                // 此订单完全对冲
                                order.originalMarginInUSD = order.marginInUSD;
                                order.marginInUSD = 0;
                                order.isHedged = true;
                                order.hedgedLots = order.lots;
                            } else {
                                // 部分对冲
                                const hedgedInThisOrder = Math.max(0, order.lots - remainingSellToAllocate);
                                if (hedgedInThisOrder >0) {
                                    order.originalMarginInUSD = order.marginInUSD;
                                    const hedgedPercentage = hedgedInThisOrder / order.lots;
                                    order.marginInUSD *= (1 - hedgedPercentage);
                                    order.isHedged = true;
                                    order.hedgedLots = hedgedInThisOrder;
                                    remainingSellToAllocate -= (order.lots - hedgedInThisOrder);
                                } else {
                                    order.isHedged = false;
                                    order.hedgedLots = 0;
                                }
                            }
                        });
                    } else {
                        // Apply hedging margin adjustments for floating margin products as well
                        // 调整买入订单的保证金（浮动保证金）
                        let remainingBuyToAllocate = remainingBuyLots;
                        productData.buyOrders.forEach(order =>{
                            order.originalMarginInUSD = order.marginInUSD;
                            const perLotUSD = (order.lots > 0) ? (order.originalMarginInUSD / order.lots) : 0;

                            if (remainingBuyToAllocate<= 0) {
                                order.marginInUSD = order.lots * (0.5 * perLotUSD);
                                order.isHedged = true;
                                order.hedgedLots = order.lots;
                            } else {
                                const hedgedInThisOrder = Math.max(0, order.lots - remainingBuyToAllocate);
                                if (hedgedInThisOrder >0) {
                                    const nonHedgedLots = order.lots - hedgedInThisOrder;
                                    order.marginInUSD = nonHedgedLots * perLotUSD + hedgedInThisOrder * (0.5 * perLotUSD);
                                    order.isHedged = true;
                                    order.hedgedLots = hedgedInThisOrder;
                                    remainingBuyToAllocate -= (order.lots - hedgedInThisOrder);
                                } else {
                                    order.isHedged = false;
                                    order.hedgedLots = 0;
                                }
                            }
                        });

                        // 调整卖出订单的保证金（浮动保证金）
                        let remainingSellToAllocate = remainingSellLots;
                        productData.sellOrders.forEach(order =>{
                            order.originalMarginInUSD = order.marginInUSD;
                            const perLotUSD = (order.lots > 0) ? (order.originalMarginInUSD / order.lots) : 0;

                            if (remainingSellToAllocate<= 0) {
                                order.marginInUSD = order.lots * (0.5 * perLotUSD);
                                order.isHedged = true;
                                order.hedgedLots = order.lots;
                            } else {
                                const hedgedInThisOrder = Math.max(0, order.lots - remainingSellToAllocate);
                                if (hedgedInThisOrder >0) {
                                    const nonHedgedLots = order.lots - hedgedInThisOrder;
                                    order.marginInUSD = nonHedgedLots * perLotUSD + hedgedInThisOrder * (0.5 * perLotUSD);
                                    order.isHedged = true;
                                    order.hedgedLots = hedgedInThisOrder;
                                    remainingSellToAllocate -= (order.lots - hedgedInThisOrder);
                                } else {
                                    order.isHedged = false;
                                    order.hedgedLots = 0;
                                }
                            }
                        });
                    }
                } else {
                    // 此产品没有对冲
                    [...productData.buyOrders, ...productData.sellOrders].forEach(order =>{
                        order.isHedged = false;
                        order.hedgedLots = 0;
                        order.originalMarginInUSD = order.marginInUSD;
                    });
                }
            });
            
            // 使用调整后的保证金计算总计
            let totalPnLInUSD = 0;
            let totalMarginInUSD = 0;
            let totalOriginalMarginInUSD = 0;
            
            allOrderResults.forEach(order =>{
                totalPnLInUSD += order.pnlInUSD;
                totalMarginInUSD += order.marginInUSD;
                totalOriginalMarginInUSD += order.originalMarginInUSD;
            });
            
            // Preserve total PnL before commission and prepare after-commission value
            const totalPnLNoCommissionInUSD = totalPnLInUSD;
            let totalPnLWithCommissionInUSD = totalPnLInUSD;
            
            
            // 显示包含对冲信息的结果
            
            // Deduct commissions using global commission rate and attach per-order commission to details
            const positionOn = document.getElementById('positionCalculation').checked;
            const globalRateEl = document.getElementById('globalCommissionRate');
            const globalRate = globalRateEl ? (parseFloat(globalRateEl.value) || 0) : 0;
            let totalCommissionUSD = 0;
            if (positionOn) {
                allOrderResults.forEach(order =>{
                    const commissionUSD = (parseFloat(order.lots) || 0) * globalRate;
                    order.commissionUSD = commissionUSD;
                    totalCommissionUSD += commissionUSD;
                });
                totalPnLInUSD -= totalCommissionUSD;
                totalPnLWithCommissionInUSD = totalPnLInUSD;
            } else {
                allOrderResults.forEach(order =>{ order.commissionUSD = 0; });
            }
            displayResults(
                allOrderResults, 
                totalPnLInUSD, 
                totalMarginInUSD, 
                totalOriginalMarginInUSD,
                multipleOrdersEnabled, 
                positionCalculationEnabled,
                hasHedgePositions,
                hedgeDetails,
                usesExchangeRate,
                totalPnLNoCommissionInUSD,
                totalPnLWithCommissionInUSD
            );
            
            // 添加到历史记录
            addToHistory(allOrderResults, totalPnLInUSD, totalMarginInUSD, positionCalculationEnabled);
        }
        
        // 计算单个订单
        function calculateSingleOrder(orderId) {
            const productElement = document.getElementById(`selectedProduct_${orderId}`);
            if (!productElement || productElement.classList.contains('hidden')) return null;
            
            const product = JSON.parse(productElement.getAttribute('data-product'));
            
            // 获取表单值
            const tradeType = document.getElementById(`tradeType_${orderId}`).value;
            const selectedLeverage = document.getElementById(`leverage_${orderId}`).value;
            const lots = parseFloat(document.getElementById(`lots_${orderId}`).value);
            const openPrice = parseFloat(document.getElementById(`openPrice_${orderId}`).value);
            const closePrice = parseFloat(document.getElementById(`closePrice_${orderId}`).value);
            const contractSize = product.contractSize;
            const pricingCurrency = product.pricingCurrency;
            
            // 输入验证
            if (isNaN(lots) || isNaN(openPrice) || isNaN(closePrice) || lots<= 0 || openPrice<= 0 || closePrice<= 0) {
                alert(`Please enter valid positive numbers for Order #${orderId}`);
                return null;
            }
            
            // 汇率处理
            let exchangeRate = 1.0;
            if (pricingCurrency !== 'USD') {
                exchangeRate = parseFloat(document.getElementById(`exchangeRate_${orderId}`).value) || 0;
                if (exchangeRate<= 0) {
                    alert(`Please enter a valid exchange rate for Order #${orderId}`);
                    return null;
                }
            }
            
            // 对于特定产品，获取EURUSD汇率
            let eurusdRate = 1.0;
            if (productsNeedingEurusd.includes(product.product)) {
                eurusdRate = parseFloat(document.getElementById(`eurusdRate_${orderId}`).value) || 0;
                if (eurusdRate<= 0) {
                    alert(`Please enter a valid EURUSD exchange rate for Order #${orderId}`);
                    return null;
                }
            }
            
            // 盈亏计算
            const priceChange = closePrice - openPrice;
            const directionFactor = tradeType === 'buy' ? 1 : -1;
            const pnl = priceChange * contractSize * lots * directionFactor;
            let pnlInUSD = pnl;
if (pricingCurrency === 'USD') {
  pnlInUSD = pnl;
} else if (pricingCurrency === 'EUR' && productsNeedingEurusd.includes(product.product) && eurusdRate > 0) {
  pnlInUSD = pnl * eurusdRate;
} else {
  pnlInUSD = pnl * exchangeRate;
}
            const pnlCurrency = product.pipValuePerLot.match(/[A-Z]{3}$/)?.[0] || pricingCurrency;
            
            // 基于保证金类型的保证金计算
            let marginRequired = 0;
            let marginCurrency = '';
            let marginCalculationDesc = '';
            const perLotMarginValue = product[`leverage${selectedLeverage}`];
            
            if (product.marginType === 'Fixed') {
                const fixedMarginMatch = perLotMarginValue.match(/^(\d+\.?\d*) ([A-Z]{3})$/);
                if (!fixedMarginMatch) {
                    alert(`Invalid fixed margin format for ${product.product} (${perLotMarginValue})`);
                    return null;
                }
                const perLotMarginAmount = parseFloat(fixedMarginMatch[1]);
                marginCurrency = fixedMarginMatch[2];
                marginRequired = perLotMarginAmount * lots;
                marginCalculationDesc = `Fixed margin per lot (${perLotMarginAmount} ${marginCurrency}) × number of lots (${lots})`;
            
            } else if (product.marginType === 'Floating') {
                const leverageRatioMatch = perLotMarginValue.match(/^1:(\d+)$/);
                if (!leverageRatioMatch) {
                    alert(`Invalid leverage format for floating margin product ${product.product} (${perLotMarginValue})`);
                    return null;
                }
                const leverageRatio = parseInt(leverageRatioMatch[1]);
                marginCurrency = pricingCurrency;
                marginRequired = (openPrice * lots * contractSize) / leverageRatio;
                marginCalculationDesc = `Open price (${openPrice}) × lots (${lots}) × contract size (${contractSize.toLocaleString()}) ÷ leverage ratio (1:${leverageRatio})`;
            
            } else {
                alert(`Unknown margin type: ${product.marginType} (Product: ${product.product})`);
                return null;
            }
            
            // 保证金美元转换 - 对于EUR保证金产品，使用EURUSD汇率
            let marginInUSD = marginRequired;
if (marginCurrency === 'USD') {
  marginInUSD = marginRequired;
} else if (marginCurrency === 'EUR' && productsNeedingEurusd.includes(product.product) && eurusdRate > 0) {
  marginInUSD = marginRequired * eurusdRate;
} else {
  // Fallback to general exchangeRate for all non-USD (including EUR non-whitelist)
  marginInUSD = marginRequired * exchangeRate;
}
            
            // 盈亏百分比计算
            const pnlPercentage = (pnl / marginRequired) * 100;
            
            return {
                orderId,
                product,
                tradeType,
                selectedLeverage,
                lots,
                openPrice,
                closePrice,
                pnl,
                pnlCurrency,
                pnlInUSD,
                marginRequired,
                marginCurrency,
                marginInUSD,
                pnlPercentage,
                marginCalculationDesc,
                exchangeRate,
                eurusdRate: productsNeedingEurusd.includes(product.product) ? eurusdRate : null
            };
        }
        
        // 显示所有结果
        function displayResults(
            orderResults, 
            totalPnLInUSD, 
            totalMarginInUSD,
            totalOriginalMarginInUSD,
            multipleOrdersEnabled, 
            positionCalculationEnabled,
            hasHedgePositions,
            hedgeDetails,
            usesExchangeRate
        , totalPnLNoCommissionInUSD, totalPnLWithCommissionInUSD) {
            const resultsSection = document.getElementById('resultsSection');
            const individualResults = document.getElementById('individualResults');
            const summaryResults = document.getElementById('summaryResults');
            const calculationDetails = document.getElementById('calculationDetails');
            const hedgeNotice = document.getElementById('hedgeNotice');
            const hedgeDetailsEl = document.getElementById('hedgeDetails');
            const exchangeRateNote = document.getElementById('exchangeRateNote');
            
            // 清除先前的结果
            individualResults.innerHTML = '';
            calculationDetails.innerHTML = '';
            
            // 显示或隐藏汇率提示
            if (usesExchangeRate) {
                exchangeRateNote.classList.remove('hidden');
            } else {
                exchangeRateNote.classList.add('hidden');
            }
            
            // 显示或隐藏对冲提示
            if (hasHedgePositions) {
                hedgeNotice.classList.remove('hidden');
                hedgeDetailsEl.innerHTML = `Hedged positions detected: ${hedgeDetails.join('; ')}.`;
            } else {
                hedgeNotice.classList.add('hidden');
            }
            
            // 为多订单显示汇总
            if (multipleOrdersEnabled && orderResults.length >1) {
                summaryResults.classList.remove('hidden');
                
                const elNo = document.getElementById('totalPnLNoCommissionInUSD');
                const elWith = document.getElementById('totalPnLWithCommissionInUSD');
                if (elNo)  elNo.textContent  = `${(totalPnLNoCommissionInUSD ?? totalPnLInUSD).toFixed(2)} USD`;
                if (elWith) elWith.textContent = `${(totalPnLWithCommissionInUSD ?? totalPnLInUSD).toFixed(2)} USD`;
              
                
                // 如果有对冲，显示原始与调整后的保证金
                if (hasHedgePositions) {
                    document.getElementById('totalMarginInUSD').innerHTML = `
                        ${totalMarginInUSD.toFixed(2)} USD<div class="text-sm opacity-80">(Original: ${totalOriginalMarginInUSD.toFixed(2)} USD)</div>`;
                } else {
                    document.getElementById('totalMarginInUSD').textContent = `${totalMarginInUSD.toFixed(2)} USD`;
                }
            } else {
                summaryResults.classList.add('hidden');
            }
            
            // 显示单个订单结果
            orderResults.forEach(result =>{
                // 创建单个结果卡片
                const resultCard = document.createElement('div');
                resultCard.className = 'bg-white bg-opacity-10 rounded-xl p-6 backdrop-blur-sm';
                
                const isProfit = result.pnl >= 0;
                const pnlClass = isProfit ? 'text-green-400' : 'text-red-400';
                const pnlIcon = isProfit ? 'fas fa-arrow-up' : 'fas fa-arrow-down';
                
                // 准备包含对冲信息的保证金显示（如适用）
                let marginDisplay = `${result.marginInUSD.toFixed(2)} USD`;
                if (result.isHedged && result.hedgedLots >0) {
                    marginDisplay += `<div class="text-sm opacity-80">(Original: ${result.originalMarginInUSD.toFixed(2)} USD)</div><div class="text-xs bg-yellow-500 bg-opacity-20 px-2 py-1 rounded mt-1"><i class="fas fa-info-circle mr-1"></i>${result.hedgedLots} lots hedged ${futuresProducts.includes(result.product.product) ? '(hedged portion margin = 50%)' : '(margin reduced to 0)'}</div>`;
                } else {
                    marginDisplay += `<div class="text-sm opacity-80">(${result.marginRequired.toFixed(2)} ${result.marginCurrency})</div>`;
                }
                
                resultCard.innerHTML = `<div class="flex justify-between items-center mb-4"><h3 class="text-lg font-semibold">${multipleOrdersEnabled ? `Order #${result.orderId}: ` : ''}${result.product.product} - ${result.product.name}</h3><span class="text-sm font-medium px-3 py-1 rounded-full ${isProfit ? 'bg-green-500 bg-opacity-20' : 'bg-red-500 bg-opacity-20'}">${result.tradeType === 'buy' ? 'Buy' : 'Sell'} | ${result.lots} lots | Leverage: 1:${result.selectedLeverage}</span></div><div class="grid grid-cols-1 md:grid-cols-2 gap-6"><div><h4 class="text-sm opacity-80 mb-1">Profit/Loss</h4><div class="font-bold text-xl ${pnlClass}"><i class="${pnlIcon} mr-1"></i>${result.pnlInUSD.toFixed(2)} USD</div><div class="text-sm opacity-80">(${result.pnl.toFixed(2)} ${result.pnlCurrency})</div><div class="text-xs opacity-80 mt-1">(Relative to margin: ${result.pnlPercentage.toFixed(2)}%)</div><div class="text-xs opacity-80 mt-1">Commission (USD): ${ (result.commissionUSD || 0).toFixed(2) }</div></div><div><h4 class="text-sm opacity-80 mb-1">Used Margin</h4><div class="font-bold text-xl">${marginDisplay}</div><div class="text-xs opacity-80 mt-1">${result.marginCalculationDesc}</div></div></div>`;
                
                individualResults.appendChild(resultCard);
                
                // 添加到计算详情
                const product = result.product;
                let hedgeInfo = '';
                if (result.isHedged && result.hedgedLots >0) {
                    hedgeInfo = `
                        ${futuresProducts.includes(product.product) ? `<div><strong>Hedged:</strong>${result.hedgedLots} lots (hedged portion margin = 50%)</div>` : `<div><strong>Hedged:</strong>${result.hedgedLots} lots (margin reduced to 0)</div>`}<div><strong>Original Margin:</strong>${result.originalMarginInUSD.toFixed(2)} USD</div>`;
                }
                
                let exchangeRateInfo = '';
                if (product.pricingCurrency !== 'USD') {
                    exchangeRateInfo = `<div><strong>Exchange Rate Used:</strong>1 ${product.pricingCurrency} = ${result.exchangeRate} USD</div>`;
                }
                
                // 添加EURUSD汇率信息（如适用）
                let eurusdRateInfo = '';
                if (productsNeedingEurusd.includes(product.product)) {
                    eurusdRateInfo = `<div><strong>EURUSD Rate Used:</strong>${result.eurusdRate}</div>`;
                }
                
                let orderDetails = `<div class="p-3 bg-white bg-opacity-5 rounded-lg"><div class="font-medium mb-2">${multipleOrdersEnabled ? `Order #${result.orderId}: ` : ''}${product.product} - ${product.name}</div><div class="grid grid-cols-1 md:grid-cols-2 gap-x-4 gap-y-1 text-xs"><div><strong>Trade:</strong>${result.tradeType === 'buy' ? 'Buy' : 'Sell'} | ${result.lots} lots</div><div><strong>Leverage:</strong>1:${result.selectedLeverage}</div><div><strong>Open Price:</strong>${result.openPrice}</div><div><strong>Close Price:</strong>${result.closePrice}</div><div><strong>Price Change:</strong>${(result.closePrice - result.openPrice).toFixed(5)}</div><div><strong>Contract Size:</strong>${product.contractSize.toLocaleString()}</div><div><strong>PnL:</strong>${result.pnl.toFixed(2)} ${result.pnlCurrency} (${result.pnlInUSD.toFixed(2)} USD)</div><div><strong>Used Margin:</strong>${result.marginInUSD.toFixed(2)} USD (${result.marginRequired.toFixed(2)} ${result.marginCurrency})</div>${positionCalculationEnabled ? `<div><strong>Commission Deducted:</strong>$${(result.commissionUSD || 0).toFixed(2)}</div>` : ''}
                            ${exchangeRateInfo}
                            ${eurusdRateInfo}
                            ${hedgeInfo}</div></div>`;
                
                calculationDetails.innerHTML += orderDetails;
            });
            
            // 为多订单添加汇总计算
            if (multipleOrdersEnabled && orderResults.length >1) {
                let hedgeSummary = '';
                if (hasHedgePositions) {
                    hedgeSummary = `<div><strong>Original Total Margin:</strong>${totalOriginalMarginInUSD.toFixed(2)} USD</div><div><strong>Margin Reduction Due to Hedging:</strong>${(totalOriginalMarginInUSD - totalMarginInUSD).toFixed(2)} USD</div>`;
                }
                
                calculationDetails.innerHTML += `<div class="p-3 bg-white bg-opacity-10 rounded-lg mt-4"><div class="font-medium mb-2">Total Summary</div><div class="grid grid-cols-1 md:grid-cols-2 gap-x-4 gap-y-1 text-xs"><div><strong>Total PnL in USD:</strong>${totalPnLInUSD.toFixed(2)} USD</div><div><strong>Total Margin in USD:</strong>${totalMarginInUSD.toFixed(2)} USD</div><div><strong>Total Orders:</strong>${orderResults.length}</div><div><strong>Used Leverage:</strong>1:${currentLeverage}</div>${hedgeSummary}</div></div>`;
            }
            
            // 如果启用，计算并显示仓位指标
            const positionResults = document.getElementById('positionResults');
            if (positionCalculationEnabled) {
                const balance = parseFloat(document.getElementById('balance').value) || 0;
                const equity = balance + totalPnLInUSD;
                const freeMargin = equity - totalMarginInUSD;
                const marginRatio = (equity / totalMarginInUSD) * 100;
                
                document.getElementById('equity').textContent = `${equity.toFixed(2)} USD`;
                document.getElementById('freeMargin').textContent = `${freeMargin.toFixed(2)} USD`;
                document.getElementById('marginRatio').textContent = `${marginRatio.toFixed(2)}%`;
                
                positionResults.classList.remove('hidden');
                
                // 将仓位详情添加到计算详情
                calculationDetails.innerHTML += `<div class="p-3 bg-white bg-opacity-10 rounded-lg mt-4"><div class="font-medium mb-2">Position Calculations</div><div class="grid grid-cols-1 md:grid-cols-3 gap-x-4 gap-y-1 text-xs"><div><strong>Balance:</strong>${balance.toFixed(2)} USD</div><div><strong>Equity:</strong>${equity.toFixed(2)} USD (Balance + Total PnL)</div><div><strong>Free Margin:</strong>${freeMargin.toFixed(2)} USD (Equity - Total Margin)</div><div><strong>Margin Ratio:</strong>${marginRatio.toFixed(2)}% (Equity / Total Margin × 100%)</div></div></div>`;
            } else {
                positionResults.classList.add('hidden');
            }
            
            // 显示结果部分
            resultsSection.classList.remove('hidden');
        }
        
        // 添加到历史记录
        function addToHistory(orderResults, totalPnLInUSD, totalMarginInUSD, positionCalculationEnabled) {
            let balance = null;
            let equity = null;
            let freeMargin = null;
            let marginRatio = null;
            
            if (positionCalculationEnabled) {
                balance = parseFloat(document.getElementById('balance').value) || 0;
                equity = balance + totalPnLInUSD;
                freeMargin = equity - totalMarginInUSD;
                marginRatio = (equity / totalMarginInUSD) * 100;
            }
            
            const historyItem = {
                orders: orderResults,
                totalPnLInUSD,
                totalMarginInUSD,
                positionCalculation: positionCalculationEnabled,
                balance,
                equity,
                freeMargin,
                marginRatio,
                leverage: currentLeverage,
                timestamp: new Date()
            };
            
            calculationHistory.unshift(historyItem);
            if (calculationHistory.length >5) {
                calculationHistory.pop();
            }
            
            updateHistoryDisplay();
        }
        
        // 更新历史记录显示
        function updateHistoryDisplay() {
            const historyList = document.getElementById('historyList');
            const noHistory = document.getElementById('noHistory');
            
            if (calculationHistory.length === 0) {
                noHistory.classList.remove('hidden');
                historyList.innerHTML = '';
                return;
            }
            
            noHistory.classList.add('hidden');
            historyList.innerHTML = '';
            
            calculationHistory.forEach((item, index) =>{
                const historyItem = document.createElement('div');
                historyItem.className = 'p-4 border-b border-gray-100 hover:bg-gray-50 transition-colors';
                
                const isProfit = item.totalPnLInUSD >= 0;
                const pnlClass = isProfit ? 'text-green-600' : 'text-red-600';
                const pnlIcon = isProfit ? 'fas fa-arrow-up' : 'fas fa-arrow-down';
                
                // 创建订单摘要文本
                let orderSummary = '';
                if (item.orders.length === 1) {
                    const order = item.orders[0];
                    orderSummary = `${order.product.product} (${order.lots} lots)`;
                } else {
                    orderSummary = `${item.orders.length} orders`;
                }
                
                // 检查是否有对冲订单
                const hasHedgedOrders = item.orders.some(order =>order.isHedged);
                const hedgeIndicator = hasHedgedOrders ? 
                    '<span class="inline-block text-xs bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded ml-2">Hedged</span>' : '';
                
                // 格式化时间戳
                const formattedTime = item.timestamp.toLocaleString();
                
                // 仓位详情
                let positionDetails = '';
                if (item.positionCalculation) {
                    positionDetails = `<div class="text-xs text-gray-500 mt-1">Equity: ${item.equity.toFixed(2)} USD | Margin Ratio: ${item.marginRatio.toFixed(2)}%</div>`;
                }
                
                historyItem.innerHTML = `<div class="flex justify-between items-start"><div><div class="font-medium">${formattedTime}</div><div class="text-sm text-gray-600 mt-1">${orderSummary} ${hedgeIndicator}</div></div><div class="text-right"><div class="font-medium ${pnlClass}"><i class="${pnlIcon}"></i>${item.totalPnLInUSD.toFixed(2)} USD</div><div class="text-xs text-gray-500 mt-1">Margin: ${item.totalMarginInUSD.toFixed(2)} USD</div></div></div>${positionDetails}
                `;
                
                historyList.appendChild(historyItem);
            });
        }</script></body>
</template>

<script>
// Mapping: if a template exists and has non-empty innerHTML (beyond comment/whitespace) we prefer it.
const TEMPLATES = {
  cn: document.getElementById('page-cn'),
  sea: document.getElementById('page-sea'),
  latam: document.getElementById('page-latam'),
  uae: document.getElementById('page-uae')
};

// fallback filenames (if you prefer to keep files externally)
const PAGE_FILES = {
  cn: 'ATFX_pnl_calculator_CN.html',
  sea: 'ATFX_pnl_calculator_SEA.html',
  latam: 'ATFX_pnl_calculator_LATAM.html',
  uae: 'ATFX_pnl_calculator_UAE.html'
};

// DOM refs
const chooser = document.getElementById('chooser');
const viewer = document.getElementById('viewer');
const frame = document.getElementById('frame');
const backBtn = document.getElementById('back');
const currentPill = document.getElementById('current');
const rememberCheckbox = document.getElementById('remember');
const regionButtons = Array.from(document.querySelectorAll('button.region'));

function isTemplatePopulated(tmpl) {
  if (!tmpl) return false;
  // strip HTML comments and whitespace
  const text = tmpl.innerHTML.replace(/<!--([\s\S]*?)-->/g, '').trim();
  return text.length > 0;
}

function showViewerFor(region) {
  if (!region) return;
  chooser.classList.add('hide');
  viewer.classList.remove('hide');
  currentPill.textContent = ({cn:'China Mainland', sea:'Southeast Asia', latam:'Latin America', uae:'UAE / MENA'})[region] || region;

  const tmpl = TEMPLATES[region];
  if (tmpl && isTemplatePopulated(tmpl)) {
    // use srcdoc from template — the template should contain a full HTML document or fragment
    try { frame.removeAttribute('src'); } catch (e) {}
    frame.srcdoc = tmpl.innerHTML;
  } else {
    // attempt fetch of external file, otherwise fallback to direct src
    const pagePath = PAGE_FILES[region];
    fetch(pagePath).then(r => {
      if (!r.ok) throw new Error('fetch failed');
      return r.text();
    }).then(html => {
      frame.removeAttribute('src');
      frame.srcdoc = html;
    }).catch(() => {
      frame.srcdoc = '';
      frame.src = pagePath;
    });
  }

  // remember preference
  try {
    if (rememberCheckbox.checked) localStorage.setItem('atfx_region', region);
    else localStorage.removeItem('atfx_region');
  } catch (e) {}
}

function showChooser() {
  viewer.classList.add('hide');
  chooser.classList.remove('hide');
  try { frame.srcdoc = ''; frame.removeAttribute('src'); } catch (e) {}
  if (location.hash) history.replaceState(null, '', location.pathname + location.search);
}

regionButtons.forEach(btn => {
  btn.addEventListener('click', () => {
    const r = btn.dataset.region;
    showViewerFor(r);
    regionButtons.forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    try { location.hash = r; } catch (e) {}
  });
});

backBtn.addEventListener('click', () => showChooser());

function tryOpenFromHashOrRemember() {
  const h = (location.hash || '').replace('#','').trim();
  let remembered = null;
  try { remembered = localStorage.getItem('atfx_region'); } catch (e) {}
  if (h && (TEMPLATES[h] || PAGE_FILES[h])) {
    const btn = regionButtons.find(b => b.dataset.region === h);
    if (btn) btn.classList.add('active');
    showViewerFor(h);
    return;
  }
  if (remembered && (TEMPLATES[remembered] || PAGE_FILES[remembered])) {
    const btn = regionButtons.find(b => b.dataset.region === remembered);
    if (btn) btn.classList.add('active');
    rememberCheckbox.checked = true;
    showViewerFor(remembered);
  }
}

document.addEventListener('DOMContentLoaded', () => {
  try {
    const r = localStorage.getItem('atfx_region');
    if (r) rememberCheckbox.checked = true;
  } catch (e) {}
  regionButtons.forEach(b => b.addEventListener('keydown', ev => { if (ev.key === 'Enter') b.click(); }));
  tryOpenFromHashOrRemember();
});

window.addEventListener('hashchange', () => {
  const h = (location.hash || '').replace('#','').trim();
  if (h && (TEMPLATES[h] || PAGE_FILES[h])) {
    const btn = regionButtons.find(b => b.dataset.region === h);
    regionButtons.forEach(b => b.classList.remove('active'));
    if (btn) btn.classList.add('active');
    showViewerFor(h);
  }
});

// debug
window.ATFX = { TEMPLATES, PAGE_FILES, showViewerFor, showChooser };
</script>

</body>
</html>
